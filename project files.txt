Here I have all my project files , the files will start with their respective names and end when the sentence says "END OF CODE."

1. database_helper.dart:
import 'dart:async';
import 'dart:io';
import 'package:sqflite/sqflite.dart';
import 'package:sqflite_common_ffi/sqflite_ffi.dart';
import 'package:path/path.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/models/vehicle_model.dart';
import 'package:a_one_bakeries_app/models/order_model.dart';
import 'package:a_one_bakeries_app/models/finance_model.dart';
import 'package:a_one_bakeries_app/models/supplier_model.dart';

/// Database Helper - Complete Working Version
/// 
/// Singleton class that manages all database operations.
/// Version 1: Clean start with all tables properly structured.

class DatabaseHelper {
  static final DatabaseHelper _instance = DatabaseHelper._internal();
  factory DatabaseHelper() => _instance;
  DatabaseHelper._internal();

  static Database? _database;

  Future<Database> get database async {
    if (_database != null) return _database!;
    _database = await _initDatabase();
    return _database!;
  }

  Future<Database> _initDatabase() async {
    if (Platform.isWindows || Platform.isLinux || Platform.isMacOS) {
      sqfliteFfiInit();
      databaseFactory = databaseFactoryFfi;
    }
    
    String path = join(await getDatabasesPath(), 'a_one_bakeries.db');
    
    return await openDatabase(
      path,
      version: 2,
      onCreate: _onCreate,
      onUpgrade: _onUpgrade,  // <-- Add this
    );
  }

  Future<void> _onCreate(Database db, int version) async {
  Future<void> _onUpgrade(Database db, int oldVersion, int newVersion) async {
  if (oldVersion < 2) {
    // Add supplier tables
    await db.execute('''
      CREATE TABLE suppliers(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        contactPerson TEXT NOT NULL,
        phoneNumber TEXT NOT NULL,
        email TEXT,
        address TEXT,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL
      )
    ''');

    await db.execute('''
      CREATE TABLE supplier_invoices(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        supplierId INTEGER NOT NULL,
        supplierName TEXT NOT NULL,
        invoiceNumber TEXT NOT NULL,
        amount REAL NOT NULL,
        invoiceDate TEXT NOT NULL,
        dueDate TEXT,
        notes TEXT,
        createdAt TEXT NOT NULL,
        FOREIGN KEY (supplierId) REFERENCES suppliers(id) ON DELETE CASCADE
      )
    ''');

    await db.execute('''
      CREATE TABLE supplier_payments(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        supplierId INTEGER NOT NULL,
        supplierName TEXT NOT NULL,
        amount REAL NOT NULL,
        paymentMethod TEXT NOT NULL,
        reference TEXT,
        notes TEXT,
        paymentDate TEXT NOT NULL,
        createdAt TEXT NOT NULL,
        FOREIGN KEY (supplierId) REFERENCES suppliers(id) ON DELETE CASCADE
      )
    ''');

    // Add supplierName column to stock_movements
    await db.execute('ALTER TABLE stock_movements ADD COLUMN supplierName TEXT');

    // Add indexes
    await db.execute('CREATE INDEX idx_supplier_invoices_supplierId ON supplier_invoices(supplierId)');
    await db.execute('CREATE INDEX idx_supplier_payments_supplierId ON supplier_payments(supplierId)');
  }
} 
    // Stock Items
    await db.execute('''
      CREATE TABLE stock_items(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        unit TEXT NOT NULL,
        quantityOnHand REAL NOT NULL DEFAULT 0,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL
      )
    ''');

    // Stock Movements
    await db.execute('''
      CREATE TABLE stock_movements(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        stockItemId INTEGER NOT NULL,
        stockItemName TEXT NOT NULL,
        movementType TEXT NOT NULL,
        quantity REAL NOT NULL,
        employeeName TEXT,
        supplierName TEXT,
        notes TEXT,
        createdAt TEXT NOT NULL,
        FOREIGN KEY (stockItemId) REFERENCES stock_items(id) ON DELETE CASCADE
      )
    ''');

    // Employees
    await db.execute('''
      CREATE TABLE employees(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        firstName TEXT NOT NULL,
        lastName TEXT NOT NULL,
        idNumber TEXT NOT NULL UNIQUE,
        idType TEXT NOT NULL,
        birthDate TEXT NOT NULL,
        role TEXT NOT NULL,
        photoPath TEXT,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL
      )
    ''');

    // Credit Transactions
    await db.execute('''
      CREATE TABLE credit_transactions(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        employeeId INTEGER NOT NULL,
        employeeName TEXT NOT NULL,
        transactionType TEXT NOT NULL,
        amount REAL NOT NULL,
        reason TEXT NOT NULL,
        createdAt TEXT NOT NULL,
        FOREIGN KEY (employeeId) REFERENCES employees(id) ON DELETE CASCADE
      )
    ''');

    // Employee Documents
    await db.execute('''
      CREATE TABLE employee_documents(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        employeeId INTEGER NOT NULL,
        documentType TEXT NOT NULL,
        fileName TEXT NOT NULL,
        filePath TEXT NOT NULL,
        uploadedAt TEXT NOT NULL,
        FOREIGN KEY (employeeId) REFERENCES employees(id) ON DELETE CASCADE
      )
    ''');

    // Vehicles
    await db.execute('''
      CREATE TABLE vehicles(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        make TEXT NOT NULL,
        model TEXT NOT NULL,
        year INTEGER NOT NULL,
        registrationNumber TEXT NOT NULL UNIQUE,
        assignedDriverId INTEGER,
        assignedDriverName TEXT,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL,
        FOREIGN KEY (assignedDriverId) REFERENCES employees(id) ON DELETE SET NULL
      )
    ''');

    // Orders
    await db.execute('''
      CREATE TABLE orders(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        driverId INTEGER,
        driverName TEXT,
        vehicleId INTEGER,
        vehicleInfo TEXT,
        totalQuantity INTEGER NOT NULL,
        createdAt TEXT NOT NULL,
        FOREIGN KEY (driverId) REFERENCES employees(id) ON DELETE SET NULL,
        FOREIGN KEY (vehicleId) REFERENCES vehicles(id) ON DELETE SET NULL
      )
    ''');

    // Order Items
    await db.execute('''
      CREATE TABLE order_items(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        orderId INTEGER NOT NULL,
        itemType TEXT NOT NULL,
        trolliesOrQty INTEGER NOT NULL,
        quantity INTEGER NOT NULL,
        FOREIGN KEY (orderId) REFERENCES orders(id) ON DELETE CASCADE
      )
    ''');

    // Income (with description column from start)
    await db.execute('''
      CREATE TABLE income(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        description TEXT,
        notes REAL NOT NULL,
        coins REAL NOT NULL,
        total REAL NOT NULL,
        createdAt TEXT NOT NULL
      )
    ''');

    // Expenses
    await db.execute('''
      CREATE TABLE expenses(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        description TEXT NOT NULL,
        amount REAL NOT NULL,
        createdAt TEXT NOT NULL
      )
    ''');
    

    // Suppliers
await db.execute('''
  CREATE TABLE suppliers(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    contactPerson TEXT NOT NULL,
    phoneNumber TEXT NOT NULL,
    email TEXT,
    address TEXT,
    createdAt TEXT NOT NULL,
    updatedAt TEXT NOT NULL
  )
''');

// Supplier Invoices
await db.execute('''
  CREATE TABLE supplier_invoices(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    supplierId INTEGER NOT NULL,
    supplierName TEXT NOT NULL,
    invoiceNumber TEXT NOT NULL,
    amount REAL NOT NULL,
    invoiceDate TEXT NOT NULL,
    dueDate TEXT,
    notes TEXT,
    createdAt TEXT NOT NULL,
    FOREIGN KEY (supplierId) REFERENCES suppliers(id) ON DELETE CASCADE
  )
''');

// Supplier Payments
await db.execute('''
  CREATE TABLE supplier_payments(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    supplierId INTEGER NOT NULL,
    supplierName TEXT NOT NULL,
    amount REAL NOT NULL,
    paymentMethod TEXT NOT NULL,
    reference TEXT,
    notes TEXT,
    paymentDate TEXT NOT NULL,
    createdAt TEXT NOT NULL,
    FOREIGN KEY (supplierId) REFERENCES suppliers(id) ON DELETE CASCADE
  )
''');

    // Create all indexes
    await db.execute('CREATE INDEX idx_stock_movements_stockItemId ON stock_movements(stockItemId)');
    await db.execute('CREATE INDEX idx_stock_movements_createdAt ON stock_movements(createdAt)');
    await db.execute('CREATE INDEX idx_credit_transactions_employeeId ON credit_transactions(employeeId)');
    await db.execute('CREATE INDEX idx_employee_documents_employeeId ON employee_documents(employeeId)');
    await db.execute('CREATE INDEX idx_vehicles_assignedDriverId ON vehicles(assignedDriverId)');
    await db.execute('CREATE INDEX idx_orders_driverId ON orders(driverId)');
    await db.execute('CREATE INDEX idx_orders_vehicleId ON orders(vehicleId)');
    await db.execute('CREATE INDEX idx_orders_createdAt ON orders(createdAt)');
    await db.execute('CREATE INDEX idx_order_items_orderId ON order_items(orderId)');
    await db.execute('CREATE INDEX idx_income_createdAt ON income(createdAt)');
    await db.execute('CREATE INDEX idx_expenses_createdAt ON expenses(createdAt)');
    await db.execute('CREATE INDEX idx_supplier_invoices_supplierId ON supplier_invoices(supplierId)');
await db.execute('CREATE INDEX idx_supplier_payments_supplierId ON supplier_payments(supplierId)');
  }

  // ==================== STOCK OPERATIONS ====================

  Future<int> insertStockItem(StockItem item) async {
    final db = await database;
    return await db.insert('stock_items', item.toMap());
  }

  Future<int> updateStockItem(StockItem item) async {
    final db = await database;
    return await db.update('stock_items', item.toMap(), where: 'id = ?', whereArgs: [item.id]);
  }

  Future<int> deleteStockItem(int id) async {
    final db = await database;
    return await db.delete('stock_items', where: 'id = ?', whereArgs: [id]);
  }

  Future<List<StockItem>> getAllStockItems() async {
    final db = await database;
    final maps = await db.query('stock_items', orderBy: 'name ASC');
    return List.generate(maps.length, (i) => StockItem.fromMap(maps[i]));
  }

  Future<StockItem?> getStockItemById(int id) async {
    final db = await database;
    final maps = await db.query('stock_items', where: 'id = ?', whereArgs: [id]);
    if (maps.isEmpty) return null;
    return StockItem.fromMap(maps.first);
  }

  Future<int> insertStockMovement(StockMovement movement) async {
    final db = await database;
    
    int movementId = 0;
    await db.transaction((txn) async {
      movementId = await txn.insert('stock_movements', movement.toMap());
      
      final stockMaps = await txn.query('stock_items', where: 'id = ?', whereArgs: [movement.stockItemId]);
      if (stockMaps.isNotEmpty) {
        final stockItem = StockItem.fromMap(stockMaps.first);
        double newQuantity = (movement.movementType == 'RECEIVED'
            ? stockItem.quantityOnHand + movement.quantity
            : stockItem.quantityOnHand - movement.quantity) as double;
        
        await txn.update(
          'stock_items',
          {'quantityOnHand': newQuantity, 'updatedAt': DateTime.now().toIso8601String()},
          where: 'id = ?',
          whereArgs: [movement.stockItemId],
        );
      }
    });
    
    return movementId;
  }

  Future<List<StockMovement>> getAllStockMovements() async {
    final db = await database;
    final maps = await db.query('stock_movements', orderBy: 'createdAt DESC');
    return List.generate(maps.length, (i) => StockMovement.fromMap(maps[i]));
  }

  Future<List<StockMovement>> getStockMovementsByDateRange(DateTime startDate, DateTime endDate) async {
    final db = await database;
    final maps = await db.query(
      'stock_movements',
      where: 'createdAt BETWEEN ? AND ?',
      whereArgs: [startDate.toIso8601String(), endDate.toIso8601String()],
      orderBy: 'createdAt DESC',
    );
    return List.generate(maps.length, (i) => StockMovement.fromMap(maps[i]));
  }

  // ==================== EMPLOYEE OPERATIONS ====================

  Future<int> insertEmployee(Employee employee) async {
    final db = await database;
    return await db.insert('employees', employee.toMap());
  }

  Future<int> updateEmployee(Employee employee) async {
    final db = await database;
    return await db.update('employees', employee.toMap(), where: 'id = ?', whereArgs: [employee.id]);
  }

  Future<int> deleteEmployee(int id) async {
    final db = await database;
    return await db.delete('employees', where: 'id = ?', whereArgs: [id]);
  }

  Future<List<Employee>> getAllEmployees() async {
    final db = await database;
    final maps = await db.query('employees', orderBy: 'firstName ASC, lastName ASC');
    return List.generate(maps.length, (i) => Employee.fromMap(maps[i]));
  }

  Future<Employee?> getEmployeeById(int id) async {
    final db = await database;
    final maps = await db.query('employees', where: 'id = ?', whereArgs: [id]);
    if (maps.isEmpty) return null;
    return Employee.fromMap(maps.first);
  }

  Future<List<Employee>> getEmployeesByRole(String role) async {
    final db = await database;
    final maps = await db.query('employees', where: 'role = ?', whereArgs: [role], orderBy: 'firstName ASC');
    return List.generate(maps.length, (i) => Employee.fromMap(maps[i]));
  }

  Future<int> insertCreditTransaction(CreditTransaction transaction) async {
    final db = await database;
    return await db.insert('credit_transactions', transaction.toMap());
  }

  Future<List<CreditTransaction>> getCreditTransactionsByEmployeeId(int employeeId) async {
    final db = await database;
    final maps = await db.query('credit_transactions', where: 'employeeId = ?', whereArgs: [employeeId], orderBy: 'createdAt DESC');
    return List.generate(maps.length, (i) => CreditTransaction.fromMap(maps[i]));
  }

  Future<double> getEmployeeCreditBalance(int employeeId) async {
    final transactions = await getCreditTransactionsByEmployeeId(employeeId);
    double balance = 0;
    for (var t in transactions) {
      balance += t.transactionType == 'BORROW' ? t.amount : -t.amount;
    }
    return balance;
  }

  Future<int> insertEmployeeDocument(EmployeeDocument document) async {
    final db = await database;
    return await db.insert('employee_documents', document.toMap());
  }

  Future<List<EmployeeDocument>> getEmployeeDocuments(int employeeId) async {
    final db = await database;
    final maps = await db.query('employee_documents', where: 'employeeId = ?', whereArgs: [employeeId], orderBy: 'uploadedAt DESC');
    return List.generate(maps.length, (i) => EmployeeDocument.fromMap(maps[i]));
  }

  Future<int> deleteEmployeeDocument(int id) async {
  final db = await database;
  return await db.delete('employee_documents', where: 'id = ?', whereArgs: [id]);
}

  // ==================== VEHICLE OPERATIONS ====================

  Future<int> insertVehicle(Vehicle vehicle) async {
    final db = await database;
    return await db.insert('vehicles', vehicle.toMap());
  }

  Future<int> updateVehicle(Vehicle vehicle) async {
    final db = await database;
    return await db.update('vehicles', vehicle.toMap(), where: 'id = ?', whereArgs: [vehicle.id]);
  }

  Future<int> deleteVehicle(int id) async {
    final db = await database;
    return await db.delete('vehicles', where: 'id = ?', whereArgs: [id]);
  }

  Future<List<Vehicle>> getAllVehicles() async {
    final db = await database;
    final maps = await db.query('vehicles', orderBy: 'make ASC, model ASC');
    return List.generate(maps.length, (i) => Vehicle.fromMap(maps[i]));
  }

  Future<int> assignVehicleToDriver(int vehicleId, int driverId, String driverName) async {
    final db = await database;
    return await db.update(
      'vehicles',
      {'assignedDriverId': driverId, 'assignedDriverName': driverName, 'updatedAt': DateTime.now().toIso8601String()},
      where: 'id = ?',
      whereArgs: [vehicleId],
    );
  }

  Future<int> unassignVehicle(int vehicleId) async {
    final db = await database;
    return await db.update(
      'vehicles',
      {'assignedDriverId': null, 'assignedDriverName': null, 'updatedAt': DateTime.now().toIso8601String()},
      where: 'id = ?',
      whereArgs: [vehicleId],
    );
  }

  // ==================== ORDER OPERATIONS ====================

  Future<int> insertOrder(Order order, List<OrderItem> items) async {
    final db = await database;
    
    int orderId = 0;
    await db.transaction((txn) async {
      orderId = await txn.insert('orders', order.toMap());
      for (var item in items) {
        await txn.insert('order_items', item.copyWith(orderId: orderId).toMap());
      }
    });
    
    return orderId;
  }

  Future<int> updateOrder(Order order, List<OrderItem> items) async {
    final db = await database;
    
    await db.transaction((txn) async {
      await txn.update('orders', order.toMap(), where: 'id = ?', whereArgs: [order.id]);
      await txn.delete('order_items', where: 'orderId = ?', whereArgs: [order.id]);
      for (var item in items) {
        await txn.insert('order_items', item.toMap());
      }
    });
    
    return order.id!;
  }

  Future<int> deleteOrder(int id) async {
    final db = await database;
    return await db.delete('orders', where: 'id = ?', whereArgs: [id]);
  }

  Future<List<Order>> getAllOrders() async {
    final db = await database;
    final maps = await db.query('orders', orderBy: 'createdAt DESC');
    return List.generate(maps.length, (i) => Order.fromMap(maps[i]));
  }

  Future<Order?> getOrderById(int id) async {
    final db = await database;
    final maps = await db.query('orders', where: 'id = ?', whereArgs: [id]);
    if (maps.isEmpty) return null;
    return Order.fromMap(maps.first);
  }

  Future<List<OrderItem>> getOrderItems(int orderId) async {
    final db = await database;
    final maps = await db.query('order_items', where: 'orderId = ?', whereArgs: [orderId]);
    return List.generate(maps.length, (i) => OrderItem.fromMap(maps[i]));
  }

  Future<int> getTodayBreadQuantity() async {
    final db = await database;
    final today = DateTime.now();
    final startOfDay = DateTime(today.year, today.month, today.day);
    final endOfDay = startOfDay.add(const Duration(days: 1));
    
    final ordersResult = await db.rawQuery(
      'SELECT id FROM orders WHERE createdAt BETWEEN ? AND ?',
      [startOfDay.toIso8601String(), endOfDay.toIso8601String()],
    );
    
    if (ordersResult.isEmpty) return 0;
    
    final orderIds = ordersResult.map((row) => row['id'] as int).toList();
    final placeholders = List.filled(orderIds.length, '?').join(',');
    
    final result = await db.rawQuery(
      'SELECT SUM(quantity) as totalQty FROM order_items WHERE orderId IN ($placeholders) AND (itemType = ? OR itemType = ?)',
      [...orderIds, OrderItemTypes.brownBread, OrderItemTypes.whiteBread],
    );
    
    return result.first['totalQty'] as int? ?? 0;
  }

  // ==================== FINANCE OPERATIONS ====================

  Future<int> insertIncome(Income income) async {
    final db = await database;
    return await db.insert('income', income.toMap());
  }

  Future<int> insertExpense(Expense expense) async {
    final db = await database;
    return await db.insert('expenses', expense.toMap());
  }

  Future<int> deleteIncome(int id) async {
    final db = await database;
    return await db.delete('income', where: 'id = ?', whereArgs: [id]);
  }

  Future<int> deleteExpense(int id) async {
    final db = await database;
    return await db.delete('expenses', where: 'id = ?', whereArgs: [id]);
  }

  Future<List<Income>> getAllIncome() async {
    final db = await database;
    final maps = await db.query('income', orderBy: 'createdAt DESC');
    return List.generate(maps.length, (i) => Income.fromMap(maps[i]));
  }

  Future<List<Expense>> getAllExpenses() async {
    final db = await database;
    final maps = await db.query('expenses', orderBy: 'createdAt DESC');
    return List.generate(maps.length, (i) => Expense.fromMap(maps[i]));
  }

  Future<double> getTotalIncome() async {
    final db = await database;
    final result = await db.rawQuery('SELECT SUM(total) as totalIncome FROM income');
    return result.first['totalIncome'] as double? ?? 0.0;
  }

  Future<double> getTotalExpenses() async {
    final db = await database;
    final result = await db.rawQuery('SELECT SUM(amount) as totalExpenses FROM expenses');
    return result.first['totalExpenses'] as double? ?? 0.0;
  }

  Future<double> getMoneyOnHand() async {
    final totalIncome = await getTotalIncome();
    final totalExpenses = await getTotalExpenses();
    return totalIncome - totalExpenses;
  }

  Future<double> getTodayIncome() async {
    final db = await database;
    final today = DateTime.now();
    final startOfDay = DateTime(today.year, today.month, today.day);
    final endOfDay = startOfDay.add(const Duration(days: 1));
    
    final result = await db.rawQuery(
      'SELECT SUM(total) as todayIncome FROM income WHERE createdAt BETWEEN ? AND ?',
      [startOfDay.toIso8601String(), endOfDay.toIso8601String()],
    );
    return result.first['todayIncome'] as double? ?? 0.0;
  }

  Future<double> getTodayExpenses() async {
    final db = await database;
    final today = DateTime.now();
    final startOfDay = DateTime(today.year, today.month, today.day);
    final endOfDay = startOfDay.add(const Duration(days: 1));
    
    final result = await db.rawQuery(
      'SELECT SUM(amount) as todayExpenses FROM expenses WHERE createdAt BETWEEN ? AND ?',
      [startOfDay.toIso8601String(), endOfDay.toIso8601String()],
    );
    return result.first['todayExpenses'] as double? ?? 0.0;
  }

  Future<void> close() async {
    final db = await database;
    await db.close();
  }

  // ==================== SUPPLIER OPERATIONS ====================

Future<int> insertSupplier(Supplier supplier) async {
  final db = await database;
  return await db.insert('suppliers', supplier.toMap());
}

Future<int> updateSupplier(Supplier supplier) async {
  final db = await database;
  return await db.update('suppliers', supplier.toMap(), 
      where: 'id = ?', whereArgs: [supplier.id]);
}

Future<int> deleteSupplier(int id) async {
  final db = await database;
  return await db.delete('suppliers', where: 'id = ?', whereArgs: [id]);
}

Future<List<Supplier>> getAllSuppliers() async {
  final db = await database;
  final maps = await db.query('suppliers', orderBy: 'name ASC');
  return List.generate(maps.length, (i) => Supplier.fromMap(maps[i]));
}

Future<Supplier?> getSupplierById(int id) async {
  final db = await database;
  final maps = await db.query('suppliers', where: 'id = ?', whereArgs: [id]);
  if (maps.isEmpty) return null;
  return Supplier.fromMap(maps.first);
}

// Supplier Invoices
Future<int> insertSupplierInvoice(SupplierInvoice invoice) async {
  final db = await database;
  return await db.insert('supplier_invoices', invoice.toMap());
}

Future<List<SupplierInvoice>> getSupplierInvoices(int supplierId) async {
  final db = await database;
  final maps = await db.query('supplier_invoices', 
      where: 'supplierId = ?', 
      whereArgs: [supplierId],
      orderBy: 'invoiceDate DESC');
  return List.generate(maps.length, (i) => SupplierInvoice.fromMap(maps[i]));
}

Future<double> getTotalInvoices(int supplierId) async {
  final db = await database;
  final result = await db.rawQuery(
    'SELECT SUM(amount) as total FROM supplier_invoices WHERE supplierId = ?',
    [supplierId],
  );
  return result.first['total'] as double? ?? 0.0;
}

// Supplier Payments
Future<int> insertSupplierPayment(SupplierPayment payment) async {
  final db = await database;
  return await db.insert('supplier_payments', payment.toMap());
}

Future<List<SupplierPayment>> getSupplierPayments(int supplierId) async {
  final db = await database;
  final maps = await db.query('supplier_payments', 
      where: 'supplierId = ?', 
      whereArgs: [supplierId],
      orderBy: 'paymentDate DESC');
  return List.generate(maps.length, (i) => SupplierPayment.fromMap(maps[i]));
}

Future<double> getTotalPayments(int supplierId) async {
  final db = await database;
  final result = await db.rawQuery(
    'SELECT SUM(amount) as total FROM supplier_payments WHERE supplierId = ?',
    [supplierId],
  );
  return result.first['total'] as double? ?? 0.0;
}

Future<double> getSupplierBalance(int supplierId) async {
  final totalInvoices = await getTotalInvoices(supplierId);
  final totalPayments = await getTotalPayments(supplierId);
  return totalInvoices - totalPayments;
}


  FutureOr<void> _onUpgrade(Database db, int oldVersion, int newVersion) {
  }
}

END OF CODE.

2. employee_model.dart:
/// Employee Model
/// 
/// Represents an employee in the bakery business.
/// Stores personal info, role, and employment details.

class Employee {
  final int? id;
  final String firstName;
  final String lastName;
  final String idNumber;           // SA ID or Passport number
  final String idType;             // "ID" or "PASSPORT"
  final DateTime birthDate;
  final String role;               // Baker, Driver, General Worker, Supervisor, Manager
  final String? photoPath;         // Path to employee photo (local file path)
  final DateTime createdAt;
  final DateTime updatedAt;

  Employee({
    this.id,
    required this.firstName,
    required this.lastName,
    required this.idNumber,
    required this.idType,
    required this.birthDate,
    required this.role,
    this.photoPath,
    DateTime? createdAt,
    DateTime? updatedAt,
  })  : createdAt = createdAt ?? DateTime.now(),
        updatedAt = updatedAt ?? DateTime.now();

  /// Get full name
  String get fullName => '$firstName $lastName';

  /// Calculate age
  int get age {
    final now = DateTime.now();
    int age = now.year - birthDate.year;
    if (now.month < birthDate.month ||
        (now.month == birthDate.month && now.day < birthDate.day)) {
      age--;
    }
    return age;
  }

  /// Check if employee has photo
  bool get hasPhoto => photoPath != null && photoPath!.isNotEmpty;
  
  /// Get photo file widget helper
  /// Returns a widget showing the employee photo or default avatar

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'firstName': firstName,
      'lastName': lastName,
      'idNumber': idNumber,
      'idType': idType,
      'birthDate': birthDate.toIso8601String(),
      'role': role,
      'photoPath': photoPath,
      'createdAt': createdAt.toIso8601String(),
      'updatedAt': updatedAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Employee.fromMap(Map<String, dynamic> map) {
    return Employee(
      id: map['id'] as int?,
      firstName: map['firstName'] as String,
      lastName: map['lastName'] as String,
      idNumber: map['idNumber'] as String,
      idType: map['idType'] as String,
      birthDate: DateTime.parse(map['birthDate'] as String),
      role: map['role'] as String,
      photoPath: map['photoPath'] as String?,
      createdAt: DateTime.parse(map['createdAt'] as String),
      updatedAt: DateTime.parse(map['updatedAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Employee copyWith({
    int? id,
    String? firstName,
    String? lastName,
    String? idNumber,
    String? idType,
    DateTime? birthDate,
    String? role,
    String? photoPath,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return Employee(
      id: id ?? this.id,
      firstName: firstName ?? this.firstName,
      lastName: lastName ?? this.lastName,
      idNumber: idNumber ?? this.idNumber,
      idType: idType ?? this.idType,
      birthDate: birthDate ?? this.birthDate,
      role: role ?? this.role,
      photoPath: photoPath ?? this.photoPath,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }
}

/// Credit Transaction Model
/// 
/// Tracks money borrowed by employees and repayments.

class CreditTransaction {
  final int? id;
  final int employeeId;
  final String employeeName;
  final String transactionType;    // "BORROW" or "REPAY"
  final double amount;
  final String reason;
  final DateTime createdAt;

  CreditTransaction({
    this.id,
    required this.employeeId,
    required this.employeeName,
    required this.transactionType,
    required this.amount,
    required this.reason,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'employeeId': employeeId,
      'employeeName': employeeName,
      'transactionType': transactionType,
      'amount': amount,
      'reason': reason,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory CreditTransaction.fromMap(Map<String, dynamic> map) {
    return CreditTransaction(
      id: map['id'] as int?,
      employeeId: map['employeeId'] as int,
      employeeName: map['employeeName'] as String,
      transactionType: map['transactionType'] as String,
      amount: map['amount'] as double,
      reason: map['reason'] as String,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }
}

/// Employee Document Model
/// 
/// Tracks documents uploaded for employees (contracts, payslips, disciplinary records).

class EmployeeDocument {
  final int? id;
  final int employeeId;
  final String documentType;       // "CONTRACT", "PAYSLIP", "DISCIPLINARY"
  final String fileName;
  final String filePath;
  final DateTime uploadedAt;

  EmployeeDocument({
    this.id,
    required this.employeeId,
    required this.documentType,
    required this.fileName,
    required this.filePath,
    DateTime? uploadedAt,
  }) : uploadedAt = uploadedAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'employeeId': employeeId,
      'documentType': documentType,
      'fileName': fileName,
      'filePath': filePath,
      'uploadedAt': uploadedAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory EmployeeDocument.fromMap(Map<String, dynamic> map) {
    return EmployeeDocument(
      id: map['id'] as int?,
      employeeId: map['employeeId'] as int,
      documentType: map['documentType'] as String,
      fileName: map['fileName'] as String,
      filePath: map['filePath'] as String,
      uploadedAt: DateTime.parse(map['uploadedAt'] as String),
    );
  }
}

/// Employee Roles Constants
class EmployeeRoles {
  static const String baker = 'Baker';
  static const String driver = 'Driver';
  static const String generalWorker = 'General Worker';
  static const String supervisor = 'Supervisor';
  static const String manager = 'Manager';

  static const List<String> allRoles = [
    baker,
    driver,
    generalWorker,
    supervisor,
    manager,
  ];
}

END OF CODE.

3. finance_model.dart:
/// Income Model
/// 
/// Represents daily income recorded.
/// Separated into notes (paper money) and coins.

class Income {
  final int? id;
  final String? description;   // Optional description
  final double notes;           // Paper money amount
  final double coins;           // Coins amount (can be 0)
  final double total;           // Total (notes + coins)
  final DateTime createdAt;

  Income({
    this.id,
    this.description,
    required this.notes,
    required this.coins,
    DateTime? createdAt,
  })  : total = notes + coins,
        createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'description': description,
      'notes': notes,
      'coins': coins,
      'total': total,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Income.fromMap(Map<String, dynamic> map) {
    return Income(
      id: map['id'] as int?,
      description: map['description'] as String?,
      notes: map['notes'] as double,
      coins: map['coins'] as double,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Income copyWith({
    int? id,
    String? description,
    double? notes,
    double? coins,
    DateTime? createdAt,
  }) {
    return Income(
      id: id ?? this.id,
      description: description ?? this.description,
      notes: notes ?? this.notes,
      coins: coins ?? this.coins,
      createdAt: createdAt ?? this.createdAt,
    );
  }
}

/// Expense Model
/// 
/// Represents daily expenses recorded.

class Expense {
  final int? id;
  final String description;     // What the expense was for
  final double amount;          // Expense amount
  final DateTime createdAt;

  Expense({
    this.id,
    required this.description,
    required this.amount,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'description': description,
      'amount': amount,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Expense.fromMap(Map<String, dynamic> map) {
    return Expense(
      id: map['id'] as int?,
      description: map['description'] as String,
      amount: map['amount'] as double,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Expense copyWith({
    int? id,
    String? description,
    double? amount,
    DateTime? createdAt,
  }) {
    return Expense(
      id: id ?? this.id,
      description: description ?? this.description,
      amount: amount ?? this.amount,
      createdAt: createdAt ?? this.createdAt,
    );
  }
}

END OF CODE.

4. order_model.dart:
/// Order Model
/// 
/// Represents a production/delivery order for a driver or vehicle.
/// Tracks quantities only (no pricing).

class Order {
  final int? id;
  final int? driverId;           // Foreign key to Employee (nullable)
  final String? driverName;      // Driver name for display
  final int? vehicleId;          // Foreign key to Vehicle (nullable)
  final String? vehicleInfo;     // Vehicle info for display
  final int totalQuantity;       // Total quantity of all items
  final DateTime createdAt;

  Order({
    this.id,
    this.driverId,
    this.driverName,
    this.vehicleId,
    this.vehicleInfo,
    required this.totalQuantity,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Check if order is for driver or vehicle
  bool get isDriverOrder => driverId != null;
  bool get isVehicleOrder => vehicleId != null;

  /// Get display name (driver or vehicle)
  String get displayName {
    if (driverName != null) return driverName!;
    if (vehicleInfo != null) return vehicleInfo!;
    return 'Unknown';
  }

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'driverId': driverId,
      'driverName': driverName,
      'vehicleId': vehicleId,
      'vehicleInfo': vehicleInfo,
      'totalQuantity': totalQuantity,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Order.fromMap(Map<String, dynamic> map) {
    return Order(
      id: map['id'] as int?,
      driverId: map['driverId'] as int?,
      driverName: map['driverName'] as String?,
      vehicleId: map['vehicleId'] as int?,
      vehicleInfo: map['vehicleInfo'] as String?,
      totalQuantity: map['totalQuantity'] as int,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Order copyWith({
    int? id,
    int? driverId,
    String? driverName,
    int? vehicleId,
    String? vehicleInfo,
    int? totalQuantity,
    DateTime? createdAt,
  }) {
    return Order(
      id: id ?? this.id,
      driverId: driverId ?? this.driverId,
      driverName: driverName ?? this.driverName,
      vehicleId: vehicleId ?? this.vehicleId,
      vehicleInfo: vehicleInfo ?? this.vehicleInfo,
      totalQuantity: totalQuantity ?? this.totalQuantity,
      createdAt: createdAt ?? this.createdAt,
    );
  }
}

/// Order Item Model
/// 
/// Represents individual line items in an order.
/// Tracks quantities only (no pricing).

class OrderItem {
  final int? id;
  final int orderId;             // Foreign key to Order
  final String itemType;         // "Brown Bread", "White Bread", "Bucket Biscuits"
  final int trolliesOrQty;       // Trollies for bread, direct quantity for biscuits
  final int quantity;            // Calculated quantity

  OrderItem({
    this.id,
    required this.orderId,
    required this.itemType,
    required this.trolliesOrQty,
    required this.quantity,
  });

  /// Calculate quantity based on item type
  /// Brown/White Bread: trollies Ã— 180
  /// Bucket Biscuits: direct quantity (1-20)
  static int calculateQuantity(String itemType, int trolliesOrQty) {
    if (itemType == 'Bucket Biscuits') {
      return trolliesOrQty; // Direct quantity
    } else {
      // Brown Bread or White Bread
      return trolliesOrQty * 180;
    }
  }

  /// Create a copy with updated fields
  OrderItem copyWith({
    int? id,
    int? orderId,
    String? itemType,
    int? trolliesOrQty,
    int? quantity,
  }) {
    return OrderItem(
      id: id ?? this.id,
      orderId: orderId ?? this.orderId,
      itemType: itemType ?? this.itemType,
      trolliesOrQty: trolliesOrQty ?? this.trolliesOrQty,
      quantity: quantity ?? this.quantity,
    );
  }

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'orderId': orderId,
      'itemType': itemType,
      'trolliesOrQty': trolliesOrQty,
      'quantity': quantity,
    };
  }

  /// Create from database Map
  factory OrderItem.fromMap(Map<String, dynamic> map) {
    return OrderItem(
      id: map['id'] as int?,
      orderId: map['orderId'] as int,
      itemType: map['itemType'] as String,
      trolliesOrQty: map['trolliesOrQty'] as int,
      quantity: map['quantity'] as int,
    );
  }
}

/// Order Item Types Constants
class OrderItemTypes {
  static const String brownBread = 'Brown Bread';
  static const String whiteBread = 'White Bread';
  static const String bucketBiscuits = 'Bucket Biscuits';

  static const List<String> allTypes = [
    brownBread,
    whiteBread,
    bucketBiscuits,
  ];
}

END OF FILE.

5. stock_model.dart:
/// Stock Model
/// 
/// Represents a stock item in the inventory system.
/// Uses integer quantities (whole numbers only).

class StockItem {
  final int? id;
  final String name;
  final String unit;
  final int quantityOnHand;      // Changed from double to int
  final DateTime createdAt;
  final DateTime updatedAt;

  StockItem({
    this.id,
    required this.name,
    required this.unit,
    required this.quantityOnHand,
    DateTime? createdAt,
    DateTime? updatedAt,
  })  : createdAt = createdAt ?? DateTime.now(),
        updatedAt = updatedAt ?? DateTime.now();

  /// Convert StockItem to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'name': name,
      'unit': unit,
      'quantityOnHand': quantityOnHand,
      'createdAt': createdAt.toIso8601String(),
      'updatedAt': updatedAt.toIso8601String(),
    };
  }

  /// Create StockItem from database Map
  factory StockItem.fromMap(Map<String, dynamic> map) {
    return StockItem(
      id: map['id'] as int?,
      name: map['name'] as String,
      unit: map['unit'] as String,
      quantityOnHand: (map['quantityOnHand'] is double) 
          ? (map['quantityOnHand'] as double).toInt() 
          : map['quantityOnHand'] as int,
      createdAt: DateTime.parse(map['createdAt'] as String),
      updatedAt: DateTime.parse(map['updatedAt'] as String),
    );
  }

  /// Create a copy with updated fields
  StockItem copyWith({
    int? id,
    String? name,
    String? unit,
    int? quantityOnHand,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return StockItem(
      id: id ?? this.id,
      name: name ?? this.name,
      unit: unit ?? this.unit,
      quantityOnHand: quantityOnHand ?? this.quantityOnHand,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }
}

/// Stock Movement Model
/// 
/// Records all stock movements.
/// Uses integer quantities (whole numbers only).

class StockMovement {
  final int? id;
  final int stockItemId;
  final String stockItemName;
  final String movementType;        // "RECEIVED" or "ALLOCATED"
  final int quantity;                // Changed from double to int
  final String? employeeName;
  final String? supplierName;        // NEW: For receiving from suppliers
  final String? notes;
  final DateTime createdAt;

  StockMovement({
    this.id,
    required this.stockItemId,
    required this.stockItemName,
    required this.movementType,
    required this.quantity,
    this.employeeName,
    this.supplierName,
    this.notes,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'stockItemId': stockItemId,
      'stockItemName': stockItemName,
      'movementType': movementType,
      'quantity': quantity,
      'employeeName': employeeName,
      'supplierName': supplierName,
      'notes': notes,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory StockMovement.fromMap(Map<String, dynamic> map) {
    return StockMovement(
      id: map['id'] as int?,
      stockItemId: map['stockItemId'] as int,
      stockItemName: map['stockItemName'] as String,
      movementType: map['movementType'] as String,
      quantity: (map['quantity'] is double) 
          ? (map['quantity'] as double).toInt() 
          : map['quantity'] as int,
      employeeName: map['employeeName'] as String?,
      supplierName: map['supplierName'] as String?,
      notes: map['notes'] as String?,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }
}

END OF CODE.

6. supplier_model.dart:
/// Supplier Model
/// 
/// Represents a supplier in the system.
/// Tracks supplier info and account balance.

class Supplier {
  final int? id;
  final String name;
  final String contactPerson;
  final String phoneNumber;
  final String? email;
  final String? address;
  final DateTime createdAt;
  final DateTime updatedAt;

  Supplier({
    this.id,
    required this.name,
    required this.contactPerson,
    required this.phoneNumber,
    this.email,
    this.address,
    DateTime? createdAt,
    DateTime? updatedAt,
  })  : createdAt = createdAt ?? DateTime.now(),
        updatedAt = updatedAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'name': name,
      'contactPerson': contactPerson,
      'phoneNumber': phoneNumber,
      'email': email,
      'address': address,
      'createdAt': createdAt.toIso8601String(),
      'updatedAt': updatedAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Supplier.fromMap(Map<String, dynamic> map) {
    return Supplier(
      id: map['id'] as int?,
      name: map['name'] as String,
      contactPerson: map['contactPerson'] as String,
      phoneNumber: map['phoneNumber'] as String,
      email: map['email'] as String?,
      address: map['address'] as String?,
      createdAt: DateTime.parse(map['createdAt'] as String),
      updatedAt: DateTime.parse(map['updatedAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Supplier copyWith({
    int? id,
    String? name,
    String? contactPerson,
    String? phoneNumber,
    String? email,
    String? address,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return Supplier(
      id: id ?? this.id,
      name: name ?? this.name,
      contactPerson: contactPerson ?? this.contactPerson,
      phoneNumber: phoneNumber ?? this.phoneNumber,
      email: email ?? this.email,
      address: address ?? this.address,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }
}

/// Supplier Invoice Model
/// 
/// Represents an invoice from a supplier.

class SupplierInvoice {
  final int? id;
  final int supplierId;
  final String supplierName;
  final String invoiceNumber;
  final double amount;
  final DateTime invoiceDate;
  final DateTime? dueDate;
  final String? notes;
  final DateTime createdAt;

  SupplierInvoice({
    this.id,
    required this.supplierId,
    required this.supplierName,
    required this.invoiceNumber,
    required this.amount,
    required this.invoiceDate,
    this.dueDate,
    this.notes,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'supplierId': supplierId,
      'supplierName': supplierName,
      'invoiceNumber': invoiceNumber,
      'amount': amount,
      'invoiceDate': invoiceDate.toIso8601String(),
      'dueDate': dueDate?.toIso8601String(),
      'notes': notes,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory SupplierInvoice.fromMap(Map<String, dynamic> map) {
    return SupplierInvoice(
      id: map['id'] as int?,
      supplierId: map['supplierId'] as int,
      supplierName: map['supplierName'] as String,
      invoiceNumber: map['invoiceNumber'] as String,
      amount: map['amount'] as double,
      invoiceDate: DateTime.parse(map['invoiceDate'] as String),
      dueDate: map['dueDate'] != null 
          ? DateTime.parse(map['dueDate'] as String) 
          : null,
      notes: map['notes'] as String?,
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }
}

/// Supplier Payment Model
/// 
/// Represents a payment made to a supplier.

class SupplierPayment {
  final int? id;
  final int supplierId;
  final String supplierName;
  final double amount;
  final String paymentMethod;  // "CASH", "EFT", "CHEQUE"
  final String? reference;
  final String? notes;
  final DateTime paymentDate;
  final DateTime createdAt;

  SupplierPayment({
    this.id,
    required this.supplierId,
    required this.supplierName,
    required this.amount,
    required this.paymentMethod,
    this.reference,
    this.notes,
    required this.paymentDate,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'supplierId': supplierId,
      'supplierName': supplierName,
      'amount': amount,
      'paymentMethod': paymentMethod,
      'reference': reference,
      'notes': notes,
      'paymentDate': paymentDate.toIso8601String(),
      'createdAt': createdAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory SupplierPayment.fromMap(Map<String, dynamic> map) {
    return SupplierPayment(
      id: map['id'] as int?,
      supplierId: map['supplierId'] as int,
      supplierName: map['supplierName'] as String,
      amount: map['amount'] as double,
      paymentMethod: map['paymentMethod'] as String,
      reference: map['reference'] as String?,
      notes: map['notes'] as String?,
      paymentDate: DateTime.parse(map['paymentDate'] as String),
      createdAt: DateTime.parse(map['createdAt'] as String),
    );
  }
}

/// Payment Method Constants
class PaymentMethods {
  static const String cash = 'CASH';
  static const String eft = 'EFT';
  static const String cheque = 'CHEQUE';

  static const List<String> allMethods = [
    cash,
    eft,
    cheque,
  ];

  static card() => null;
}

END OF FILE.

7. vehicle_model.dart:
/// Vehicle Model
/// 
/// Represents a vehicle in the bakery business.
/// Vehicles can be assigned to employees with "Driver" role.

class Vehicle {
  final int? id;
  final String make;              // e.g., Toyota, Ford
  final String model;             // e.g., Hilux, Ranger
  final int year;                 // Manufacturing year
  final String registrationNumber; // License plate number
  final int? assignedDriverId;    // Foreign key to Employee (nullable)
  final String? assignedDriverName; // Driver name for display
  final DateTime createdAt;
  final DateTime updatedAt;

  Vehicle({
    this.id,
    required this.make,
    required this.model,
    required this.year,
    required this.registrationNumber,
    this.assignedDriverId,
    this.assignedDriverName,
    DateTime? createdAt,
    DateTime? updatedAt,
  })  : createdAt = createdAt ?? DateTime.now(),
        updatedAt = updatedAt ?? DateTime.now();

  /// Get full vehicle name
  String get fullName => '$year $make $model';

  /// Check if vehicle is assigned
  bool get isAssigned => assignedDriverId != null;

  /// Convert to Map for database
  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'make': make,
      'model': model,
      'year': year,
      'registrationNumber': registrationNumber,
      'assignedDriverId': assignedDriverId,
      'assignedDriverName': assignedDriverName,
      'createdAt': createdAt.toIso8601String(),
      'updatedAt': updatedAt.toIso8601String(),
    };
  }

  /// Create from database Map
  factory Vehicle.fromMap(Map<String, dynamic> map) {
    return Vehicle(
      id: map['id'] as int?,
      make: map['make'] as String,
      model: map['model'] as String,
      year: map['year'] as int,
      registrationNumber: map['registrationNumber'] as String,
      assignedDriverId: map['assignedDriverId'] as int?,
      assignedDriverName: map['assignedDriverName'] as String?,
      createdAt: DateTime.parse(map['createdAt'] as String),
      updatedAt: DateTime.parse(map['updatedAt'] as String),
    );
  }

  /// Create a copy with updated fields
  Vehicle copyWith({
    int? id,
    String? make,
    String? model,
    int? year,
    String? registrationNumber,
    int? assignedDriverId,
    String? assignedDriverName,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return Vehicle(
      id: id ?? this.id,
      make: make ?? this.make,
      model: model ?? this.model,
      year: year ?? this.year,
      registrationNumber: registrationNumber ?? this.registrationNumber,
      assignedDriverId: assignedDriverId ?? this.assignedDriverId,
      assignedDriverName: assignedDriverName ?? this.assignedDriverName,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }
}

END OF CODE.

8. create__order_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/order_model.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/models/vehicle_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Create Order Screen
/// 
/// Screen to create a new order for a driver or vehicle.
/// Tracks quantities only (no pricing).

class CreateOrderScreen extends StatefulWidget {
  final Order? existingOrder;
  final List<OrderItem>? existingItems;

  const CreateOrderScreen({
    super.key,
    this.existingOrder,
    this.existingItems,
  });

  @override
  State<CreateOrderScreen> createState() => _CreateOrderScreenState();
}

class _CreateOrderScreenState extends State<CreateOrderScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  final _formKey = GlobalKey<FormState>();
  
  // Order assignment
  String _orderType = 'DRIVER';
  Employee? _selectedDriver;
  Vehicle? _selectedVehicle;
  
  List<Employee> _drivers = [];
  List<Vehicle> _vehicles = [];
  
  // Order items (table rows)
  List<OrderItemRow> _orderItems = [OrderItemRow()];
  
  bool _isLoading = false;
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _loadDriversAndVehicles();
    
    // If editing, load existing data
    if (widget.existingOrder != null && widget.existingItems != null) {
      _loadExistingOrder();
    }
  }

  /// Load existing order for editing
  void _loadExistingOrder() {
    final order = widget.existingOrder!;
    
    setState(() {
      _orderType = order.isDriverOrder ? 'DRIVER' : 'VEHICLE';
      
      // Load items
      _orderItems = widget.existingItems!.map((item) {
        return OrderItemRow(
          itemType: item.itemType,
          trolliesOrQty: item.trolliesOrQty,
        );
      }).toList();
    });
  }

  /// Load drivers and vehicles
  Future<void> _loadDriversAndVehicles() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final drivers = await _dbHelper.getEmployeesByRole(EmployeeRoles.driver);
      final vehicles = await _dbHelper.getAllVehicles();

      setState(() {
        _drivers = drivers;
        _vehicles = vehicles;
        
        // If editing, set selected driver/vehicle
        if (widget.existingOrder != null) {
          if (widget.existingOrder!.driverId != null) {
            _selectedDriver = drivers.firstWhere(
              (d) => d.id == widget.existingOrder!.driverId,
              orElse: () => drivers.first,
            );
          }
          if (widget.existingOrder!.vehicleId != null) {
            _selectedVehicle = vehicles.firstWhere(
              (v) => v.id == widget.existingOrder!.vehicleId,
              orElse: () => vehicles.first,
            );
          }
        }
        
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
    }
  }

  /// Add new row to order items
  void _addRow() {
    setState(() {
      _orderItems.add(OrderItemRow());
    });
  }

  /// Remove row from order items
  void _removeRow(int index) {
    if (_orderItems.length > 1) {
      setState(() {
        _orderItems.removeAt(index);
      });
    }
  }

  /// Calculate total quantity
  int _calculateTotalQuantity() {
    int total = 0;
    for (var item in _orderItems) {
      if (item.isValid) {
        total += item.quantity;
      }
    }
    return total;
  }

  /// Validate and save order
  Future<void> _saveOrder() async {
    if (!_formKey.currentState!.validate()) return;

    // Validate order assignment
    if (_orderType == 'DRIVER' && _selectedDriver == null) {
      _showErrorSnackBar('Please select a driver');
      return;
    }
    if (_orderType == 'VEHICLE' && _selectedVehicle == null) {
      _showErrorSnackBar('Please select a vehicle');
      return;
    }

    // Validate order items
    if (_orderItems.where((item) => item.isValid).isEmpty) {
      _showErrorSnackBar('Please add at least one valid item');
      return;
    }

    setState(() {
      _isSaving = true;
    });

    try {
      // Create order
      final order = Order(
        id: widget.existingOrder?.id,
        driverId: _orderType == 'DRIVER' ? _selectedDriver!.id : null,
        driverName: _orderType == 'DRIVER' ? _selectedDriver!.fullName : null,
        vehicleId: _orderType == 'VEHICLE' ? _selectedVehicle!.id : null,
        vehicleInfo: _orderType == 'VEHICLE' ? _selectedVehicle!.fullName : null,
        totalQuantity: _calculateTotalQuantity(),
        createdAt: widget.existingOrder?.createdAt,
      );

      // Create order items
      final items = _orderItems
          .where((item) => item.isValid)
          .map((item) => OrderItem(
                orderId: widget.existingOrder?.id ?? 0,
                itemType: item.itemType!,
                trolliesOrQty: item.trolliesOrQty!,
                quantity: item.quantity,
              ))
          .toList();

      // Save to database
      if (widget.existingOrder == null) {
        await _dbHelper.insertOrder(order, items);
      } else {
        await _dbHelper.updateOrder(order, items);
      }

      if (mounted) {
        Navigator.pop(context, true);
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(widget.existingOrder == null 
                ? 'Order created successfully!' 
                : 'Order updated successfully!'),
            backgroundColor: AppTheme.successGreen,
          ),
        );
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error saving order: $e');
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final isEditing = widget.existingOrder != null;
    
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: Text(isEditing ? 'Edit Order' : 'Create Order'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : Form(
              key: _formKey,
              child: Column(
                children: [
                  Expanded(
                    child: SingleChildScrollView(
                      padding: const EdgeInsets.all(16),
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          // Order Type Selection
                          _buildOrderTypeSelection(),
                          const SizedBox(height: 24),

                          // Driver/Vehicle Selection
                          _buildAssignmentSelection(),
                          const SizedBox(height: 24),

                          // Order Items Section
                          _buildOrderItemsSection(),
                          const SizedBox(height: 24),

                          // Total Quantity
                          _buildTotalSection(),
                        ],
                      ),
                    ),
                  ),

                  // Save Button
                  _buildBottomBar(),
                ],
              ),
            ),
    );
  }

  /// Build order type selection
  Widget _buildOrderTypeSelection() {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          'Order For',
          style: Theme.of(context).textTheme.titleMedium?.copyWith(
                fontWeight: FontWeight.bold,
              ),
        ),
        const SizedBox(height: 12),
        Row(
          children: [
            Expanded(
              child: RadioListTile<String>(
                title: const Text('Driver'),
                value: 'DRIVER',
                groupValue: _orderType,
                onChanged: (value) {
                  setState(() {
                    _orderType = value!;
                    _selectedDriver = null;
                    _selectedVehicle = null;
                  });
                },
                activeColor: AppTheme.primaryBrown,
              ),
            ),
            Expanded(
              child: RadioListTile<String>(
                title: const Text('Vehicle'),
                value: 'VEHICLE',
                groupValue: _orderType,
                onChanged: (value) {
                  setState(() {
                    _orderType = value!;
                    _selectedDriver = null;
                    _selectedVehicle = null;
                  });
                },
                activeColor: AppTheme.primaryBrown,
              ),
            ),
          ],
        ),
      ],
    );
  }

  /// Build assignment selection
  Widget _buildAssignmentSelection() {
    if (_orderType == 'DRIVER') {
      return DropdownButtonFormField<Employee>(
        value: _selectedDriver,
        decoration: const InputDecoration(
          labelText: 'Select Driver',
          prefixIcon: Icon(Icons.person),
        ),
        items: _drivers
            .map((driver) => DropdownMenuItem(
                  value: driver,
                  child: Text(driver.fullName),
                ))
            .toList(),
        onChanged: (value) {
          setState(() {
            _selectedDriver = value;
          });
        },
        validator: (value) {
          if (value == null) return 'Please select a driver';
          return null;
        },
      );
    } else {
      return DropdownButtonFormField<Vehicle>(
        value: _selectedVehicle,
        decoration: const InputDecoration(
          labelText: 'Select Vehicle',
          prefixIcon: Icon(Icons.local_shipping),
        ),
        items: _vehicles
            .map((vehicle) => DropdownMenuItem(
                  value: vehicle,
                  child: Text('${vehicle.fullName} - ${vehicle.registrationNumber}'),
                ))
            .toList(),
        onChanged: (value) {
          setState(() {
            _selectedVehicle = value;
          });
        },
        validator: (value) {
          if (value == null) return 'Please select a vehicle';
          return null;
        },
      );
    }
  }

  /// Build order items section (the table)
  Widget _buildOrderItemsSection() {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Row(
          mainAxisAlignment: MainAxisAlignment.spaceBetween,
          children: [
            Text(
              'Order Items',
              style: Theme.of(context).textTheme.titleMedium?.copyWith(
                    fontWeight: FontWeight.bold,
                  ),
            ),
            OutlinedButton.icon(
              onPressed: _addRow,
              icon: const Icon(Icons.add, size: 20),
              label: const Text('Add Item'),
            ),
          ],
        ),
        const SizedBox(height: 16),

        // Order items list
        ListView.builder(
          shrinkWrap: true,
          physics: const NeverScrollableScrollPhysics(),
          itemCount: _orderItems.length,
          itemBuilder: (context, index) {
            return _buildOrderItemRow(index);
          },
        ),
      ],
    );
  }

  /// Build single order item row
  Widget _buildOrderItemRow(int index) {
    final item = _orderItems[index];
    final isBiscuits = item.itemType == OrderItemTypes.bucketBiscuits;

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(12),
        child: Column(
          children: [
            // Row header with delete button
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  'Item ${index + 1}',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
                if (_orderItems.length > 1)
                  IconButton(
                    icon: const Icon(Icons.delete, color: AppTheme.errorRed),
                    onPressed: () => _removeRow(index),
                    iconSize: 20,
                  ),
              ],
            ),
            const SizedBox(height: 12),

            // Item Type Dropdown
            DropdownButtonFormField<String>(
              value: item.itemType,
              decoration: const InputDecoration(
                labelText: 'Item',
                isDense: true,
              ),
              items: OrderItemTypes.allTypes
                  .map((type) => DropdownMenuItem(
                        value: type,
                        child: Text(type),
                      ))
                  .toList(),
              onChanged: (value) {
                setState(() {
                  item.itemType = value;
                  item.trolliesOrQty = null; // Reset when type changes
                });
              },
            ),
            const SizedBox(height: 12),

            // Trollies (for Bread) or Quantity (for Biscuits) Dropdown
            DropdownButtonFormField<int>(
              value: item.trolliesOrQty,
              decoration: InputDecoration(
                labelText: isBiscuits ? 'Quantity' : 'Trollies',
                isDense: true,
              ),
              items: List.generate(isBiscuits ? 20 : 10, (i) => i + 1)
                  .map((num) => DropdownMenuItem(
                        value: num,
                        child: Text(num.toString()),
                      ))
                  .toList(),
              onChanged: (value) {
                setState(() {
                  item.trolliesOrQty = value;
                });
              },
            ),
            const SizedBox(height: 12),

            // Quantity Display
            if (item.isValid) ...[
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.primaryBrown.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text(
                      'QUANTITY:',
                      style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                            fontWeight: FontWeight.w600,
                          ),
                    ),
                    Text(
                      item.quantity.toString(),
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            color: AppTheme.primaryBrown,
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
              ),
            ],
          ],
        ),
      ),
    );
  }

  /// Build total section
  Widget _buildTotalSection() {
    return Container(
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        color: AppTheme.primaryBrown,
        borderRadius: BorderRadius.circular(12),
      ),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(
            'Total Quantity:',
            style: Theme.of(context).textTheme.titleLarge?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
          Text(
            _calculateTotalQuantity().toString(),
            style: Theme.of(context).textTheme.displaySmall?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
        ],
      ),
    );
  }

  /// Build bottom bar with save button
  Widget _buildBottomBar() {
    final isEditing = widget.existingOrder != null;
    
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.white,
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 4,
            offset: const Offset(0, -2),
          ),
        ],
      ),
      child: SafeArea(
        child: SizedBox(
          width: double.infinity,
          child: ElevatedButton(
            onPressed: _isSaving ? null : _saveOrder,
            style: ElevatedButton.styleFrom(
              padding: const EdgeInsets.symmetric(vertical: 16),
            ),
            child: _isSaving
                ? const SizedBox(
                    height: 20,
                    width: 20,
                    child: CircularProgressIndicator(
                      strokeWidth: 2,
                      valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                    ),
                  )
                : Text(
                    isEditing ? 'Update Order' : 'Create Order',
                    style: const TextStyle(fontSize: 18),
                  ),
          ),
        ),
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

/// Order Item Row Helper Class
class OrderItemRow {
  String? itemType;
  int? trolliesOrQty;

  OrderItemRow({
    this.itemType,
    this.trolliesOrQty,
  });

  bool get isValid => itemType != null && trolliesOrQty != null;

  int get quantity {
    if (!isValid) return 0;
    return OrderItem.calculateQuantity(itemType!, trolliesOrQty!);
  }
}

END OF CODE.

9. dashnoard_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/widgets/summary_card.dart';
import 'package:a_one_bakeries_app/widgets/add_income_dialog.dart';
import 'package:a_one_bakeries_app/widgets/add_expense_dialog.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_stock_dialog.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_employee_dialog.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/screens/vehicle_screen.dart';
import 'package:a_one_bakeries_app/screens/stock_screen.dart';
import 'package:a_one_bakeries_app/screens/employee_screen.dart';
import 'package:a_one_bakeries_app/screens/orders_screen.dart';
import 'package:a_one_bakeries_app/screens/finance_screen.dart';
import 'package:a_one_bakeries_app/screens/create_order_screen.dart';
import 'package:a_one_bakeries_app/screens/notifications_screen.dart';
import 'package:intl/intl.dart';

/// Dashboard Screen
/// 
/// Main screen with overview, quick actions, and navigation.
/// Enhanced with clickable cards and working action buttons.

class DashboardScreen extends StatefulWidget {
  const DashboardScreen({super.key});

  @override
  State<DashboardScreen> createState() => _DashboardScreenState();
}

class _DashboardScreenState extends State<DashboardScreen> {
  final DateFormat _dateFormat = DateFormat('EEEE, MMMM d, yyyy');
  final DatabaseHelper _dbHelper = DatabaseHelper();
  final NumberFormat _currencyFormat = NumberFormat.currency(symbol: 'R ');
  
  // Dashboard data
  int _stockItemsCount = 0;
  int _employeesCount = 0;
  int _todayBreadQuantity = 0;
  double _todayIncome = 0.0;
  double _todayExpenses = 0.0;
  int _notificationCount = 3; // Mock notification count
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    _loadDashboardData();
  }

  /// Load dashboard data from database
  Future<void> _loadDashboardData() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final stockItems = await _dbHelper.getAllStockItems();
      final employees = await _dbHelper.getAllEmployees();
      final breadQty = await _dbHelper.getTodayBreadQuantity();
      final todayIncome = await _dbHelper.getTodayIncome();
      final todayExpenses = await _dbHelper.getTodayExpenses();

      setState(() {
        _stockItemsCount = stockItems.length;
        _employeesCount = employees.length;
        _todayBreadQuantity = breadQty;
        _todayIncome = todayIncome;
        _todayExpenses = todayExpenses;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
    }
  }

  /// Navigate to Stock Screen
  void _navigateToStock() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const StockScreen()),
    ).then((_) => _loadDashboardData());
  }

  /// Navigate to Employee Screen
  void _navigateToEmployees() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const EmployeeScreen()),
    ).then((_) => _loadDashboardData());
  }

  /// Navigate to Orders Screen
  void _navigateToOrders() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const OrdersScreen()),
    ).then((_) => _loadDashboardData());
  }

  /// Navigate to Finance Screen
  void _navigateToFinance() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const FinanceScreen()),
    ).then((_) => _loadDashboardData());
  }

  /// Navigate to Notifications Screen
  void _navigateToNotifications() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const NotificationsScreen()),
    ).then((_) {
      // Reset notification count after viewing
      setState(() {
        _notificationCount = 0;
      });
    });
  }

  /// Show New Order Screen
  void _showNewOrderScreen() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const CreateOrderScreen()),
    ).then((result) {
      if (result == true) {
        _loadDashboardData();
        _showSuccessSnackBar('Order created successfully!');
      }
    });
  }

  /// Show Add Stock Dialog
  Future<void> _showAddStockDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditStockDialog(),
    );

    if (result == true) {
      _loadDashboardData();
      _showSuccessSnackBar('Stock item added successfully!');
    }
  }

  /// Show Add Employee Dialog
  Future<void> _showAddEmployeeDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditEmployeeDialog(),
    );

    if (result == true) {
      _loadDashboardData();
      _showSuccessSnackBar('Employee registered successfully!');
    }
  }

  /// Show Add Vehicle Screen
  void _showAddVehicleScreen() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const VehicleScreen()),
    ).then((_) => _loadDashboardData());
  }

  /// Show Record Income Dialog
  Future<void> _showRecordIncomeDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddIncomeDialog(),
    );

    if (result == true) {
      _loadDashboardData();
      _showSuccessSnackBar('Income recorded successfully!');
    }
  }

  /// Show Record Expense Dialog
  Future<void> _showRecordExpenseDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddExpenseDialog(),
    );

    if (result == true) {
      _loadDashboardData();
      _showSuccessSnackBar('Expense recorded successfully!');
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      
      // App Bar with notifications
      appBar: AppBar(
        title: const Text('A-One Bakeries PTY Ltd'),
        actions: [
          // Notification icon with badge
          Stack(
            children: [
              IconButton(
                icon: const Icon(Icons.notifications_outlined),
                onPressed: _navigateToNotifications,
              ),
              if (_notificationCount > 0)
                Positioned(
                  right: 8,
                  top: 8,
                  child: Container(
                    padding: const EdgeInsets.all(4),
                    decoration: BoxDecoration(
                      color: AppTheme.errorRed,
                      borderRadius: BorderRadius.circular(10),
                    ),
                    constraints: const BoxConstraints(
                      minWidth: 20,
                      minHeight: 20,
                    ),
                    child: Text(
                      _notificationCount > 9 ? '9+' : '$_notificationCount',
                      style: const TextStyle(
                        color: Colors.white,
                        fontSize: 10,
                        fontWeight: FontWeight.bold,
                      ),
                      textAlign: TextAlign.center,
                    ),
                  ),
                ),
            ],
          ),
        ],
      ),
      
      body: RefreshIndicator(
        onRefresh: _loadDashboardData,
        color: AppTheme.primaryBrown,
        child: SingleChildScrollView(
          physics: const AlwaysScrollableScrollPhysics(),
          child: Padding(
            padding: const EdgeInsets.all(16.0),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                // Welcome Section
                _buildWelcomeSection(),
                const SizedBox(height: 24),
                
                // Date Display
                _buildDateSection(),
                const SizedBox(height: 24),
                
                // Summary Cards Section
                _buildSummarySection(),
                const SizedBox(height: 24),
                
                // Quick Actions Section
                _buildQuickActionsSection(),
                const SizedBox(height: 16),
              ],
            ),
          ),
        ),
      ),
    );
  }

  /// Welcome Section Widget
  Widget _buildWelcomeSection() {
    return Container(
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        gradient: LinearGradient(
          colors: [
            AppTheme.primaryBrown,
            AppTheme.primaryBrown.withOpacity(0.8),
          ],
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
        ),
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: AppTheme.primaryBrown.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Row(
        children: [
          // Bakery Icon
          Container(
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(
              color: Colors.white.withOpacity(0.2),
              borderRadius: BorderRadius.circular(12),
            ),
            child: const Icon(
              Icons.bakery_dining,
              size: 40,
              color: Colors.white,
            ),
          ),
          const SizedBox(width: 16),
          
          // Welcome Text
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  'Welcome Back Shahid!',
                  style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                    color: Colors.white,
                    fontWeight: FontWeight.bold,
                  ),
                ),
                const SizedBox(height: 4),
                Text(
                  'Here\'s your business overview',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                    color: Colors.white.withOpacity(0.9),
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  /// Date Section Widget
  Widget _buildDateSection() {
    return Row(
      children: [
        Icon(
          Icons.calendar_today,
          size: 20,
          color: AppTheme.darkBrown.withOpacity(0.7),
        ),
        const SizedBox(width: 8),
        Text(
          _dateFormat.format(DateTime.now()),
          style: Theme.of(context).textTheme.bodyMedium?.copyWith(
            color: AppTheme.darkBrown.withOpacity(0.7),
            fontWeight: FontWeight.w500,
          ),
        ),
      ],
    );
  }

  /// Summary Section with Clickable Cards
  Widget _buildSummarySection() {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          'Today\'s Overview',
          style: Theme.of(context).textTheme.headlineSmall,
        ),
        const SizedBox(height: 16),
        
        // Stock Summary Card (CLICKABLE)
        SummaryCard(
          title: 'Stock on Hand',
          value: _isLoading ? '...' : '$_stockItemsCount',
          subtitle: 'Total items in stock',
          icon: Icons.inventory_2,
          color: AppTheme.primaryBrown,
          onTap: _navigateToStock,
        ),
        
        // Employees Summary Card (CLICKABLE)
        SummaryCard(
          title: 'Total Employees',
          value: _isLoading ? '...' : '$_employeesCount',
          subtitle: 'Registered staff members',
          icon: Icons.people,
          color: Colors.blue,
          onTap: _navigateToEmployees,
        ),
        
        // Orders Summary Card (CLICKABLE)
        SummaryCard(
          title: 'Today\'s Bread',
          value: _isLoading ? '...' : '$_todayBreadQuantity',
          subtitle: 'Total bread quantity',
          icon: Icons.shopping_cart,
          color: AppTheme.secondaryOrange,
          onTap: _navigateToOrders,
        ),
        
        // Income Summary Card (CLICKABLE)
        SummaryCard(
          title: 'Today\'s Income',
          value: _isLoading ? '...' : _currencyFormat.format(_todayIncome),
          subtitle: 'Total income today',
          icon: Icons.trending_up,
          color: AppTheme.successGreen,
          onTap: _navigateToFinance,
        ),
        
        // Expenses Summary Card (CLICKABLE)
        SummaryCard(
          title: 'Today\'s Expenses',
          value: _isLoading ? '...' : _currencyFormat.format(_todayExpenses),
          subtitle: 'Total expenses today',
          icon: Icons.trending_down,
          color: AppTheme.errorRed,
          onTap: _navigateToFinance,
        ),
      ],
    );
  }

  /// Quick Actions Section (ALL WORKING)
  Widget _buildQuickActionsSection() {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          'Quick Actions',
          style: Theme.of(context).textTheme.headlineSmall,
        ),
        const SizedBox(height: 16),
        
        // Quick action buttons in a 2x3 grid
        GridView.count(
          crossAxisCount: 3,
          shrinkWrap: true,
          physics: const NeverScrollableScrollPhysics(),
          crossAxisSpacing: 12,
          mainAxisSpacing: 12,
          childAspectRatio: 1.0,
          children: [
            _buildQuickActionButton(
              icon: Icons.add_shopping_cart,
              label: 'New Order',
              onTap: _showNewOrderScreen,
            ),
            _buildQuickActionButton(
              icon: Icons.inventory,
              label: 'Add Stock',
              onTap: _showAddStockDialog,
            ),
            _buildQuickActionButton(
              icon: Icons.person_add,
              label: 'Add Employee',
              onTap: _showAddEmployeeDialog,
            ),
            _buildQuickActionButton(
              icon: Icons.local_shipping,
              label: 'Add Vehicle',
              onTap: _showAddVehicleScreen,
            ),
            _buildQuickActionButton(
              icon: Icons.attach_money,
              label: 'Record Income',
              onTap: _showRecordIncomeDialog,
            ),
            _buildQuickActionButton(
              icon: Icons.money_off,
              label: 'Record Expense',
              onTap: _showRecordExpenseDialog,
            ),
          ],
        ),
      ],
    );
  }

  /// Quick Action Button Widget
  Widget _buildQuickActionButton({
    required IconData icon,
    required String label,
    required VoidCallback onTap,
  }) {
    return InkWell(
      onTap: onTap,
      borderRadius: BorderRadius.circular(12),
      child: Container(
        decoration: BoxDecoration(
          color: AppTheme.lightCream,
          borderRadius: BorderRadius.circular(12),
          border: Border.all(
            color: AppTheme.primaryBrown.withOpacity(0.2),
            width: 1,
          ),
        ),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              icon,
              size: 32,
              color: AppTheme.primaryBrown,
            ),
            const SizedBox(height: 8),
            Text(
              label,
              style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                fontWeight: FontWeight.w600,
                color: AppTheme.darkBrown,
              ),
              textAlign: TextAlign.center,
            ),
          ],
        ),
      ),
    );
  }

  /// Show success snackbar
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }
}

END OF CODE.

10. employee_details_screen.dart:
import 'dart:math';
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/services/photo_picker_service.dart';
import 'package:a_one_bakeries_app/widgets/employee_photo_widget.dart';
import 'package:a_one_bakeries_app/widgets/upload_document_dialog.dart';
import 'dart:io';
import 'package:intl/intl.dart';

/// Employee Details Screen
/// 
/// Shows comprehensive employee information including:
/// - Personal details
/// - Credit account with transaction history
/// - Uploaded documents (contracts, payslips, disciplinary)

class EmployeeDetailsScreen extends StatefulWidget {
  final Employee employee;

  const EmployeeDetailsScreen({
    super.key,
    required this.employee,
  });

  @override
  State<EmployeeDetailsScreen> createState() => _EmployeeDetailsScreenState();
}

class _EmployeeDetailsScreenState extends State<EmployeeDetailsScreen>
    with SingleTickerProviderStateMixin {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  late TabController _tabController;

  // Current employee (can be updated)
  late Employee _currentEmployee;

  // Credit account data
  double _creditBalance = 0.0;
  List<CreditTransaction> _transactions = [];
  bool _isLoadingCredit = true;

  // Documents data
  List<EmployeeDocument> _documents = [];
  bool _isLoadingDocuments = true;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy HH:mm');
  final NumberFormat _currencyFormat = NumberFormat.currency(symbol: 'R ');

  @override
  void initState() {
    super.initState();
    _currentEmployee = widget.employee;
    _tabController = TabController(length: 3, vsync: this);
    _loadCreditData();
    _loadDocuments();
  }

  @override
  void dispose() {
    _tabController.dispose();
    super.dispose();
  }

  /// Load credit account data
  Future<void> _loadCreditData() async {
    setState(() {
      _isLoadingCredit = true;
    });

    try {
      final balance =
          await _dbHelper.getEmployeeCreditBalance(_currentEmployee.id!);
      final transactions = await _dbHelper
          .getCreditTransactionsByEmployeeId(_currentEmployee.id!);

      setState(() {
        _creditBalance = balance;
        _transactions = transactions;
        _isLoadingCredit = false;
      });
    } catch (e) {
      setState(() {
        _isLoadingCredit = false;
      });
    }
  }

  /// Load employee documents
  Future<void> _loadDocuments() async {
    setState(() {
      _isLoadingDocuments = true;
    });

    try {
      final documents =
          await _dbHelper.getEmployeeDocuments(_currentEmployee.id!);

      setState(() {
        _documents = documents;
        _isLoadingDocuments = false;
      });
    } catch (e) {
      setState(() {
        _isLoadingDocuments = false;
      });
    }
  }

  /// Show add credit transaction dialog
  Future<void> _showAddTransactionDialog(String type) async {
    final amountController = TextEditingController();
    final reasonController = TextEditingController();
    final formKey = GlobalKey<FormState>();

    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: Text(type == 'BORROW' ? 'Record Borrowed Money' : 'Record Repayment'),
        content: Form(
          key: formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              TextFormField(
                controller: amountController,
                decoration: const InputDecoration(
                  labelText: 'Amount',
                  prefixText: 'R ',
                  prefixIcon: Icon(Icons.money),
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                autofocus: true,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter amount';
                  }
                  final amount = double.tryParse(value.trim());
                  if (amount == null || amount <= 0) {
                    return 'Please enter valid amount';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),
              TextFormField(
                controller: reasonController,
                decoration: const InputDecoration(
                  labelText: 'Reason',
                  hintText: 'e.g., Emergency, Advance payment',
                  prefixIcon: Icon(Icons.note),
                ),
                textCapitalization: TextCapitalization.sentences,
                maxLines: 2,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter reason';
                  }
                  return null;
                },
              ),
            ],
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () async {
              if (formKey.currentState!.validate()) {
                try {
                  final transaction = CreditTransaction(
                    employeeId: _currentEmployee.id!,
                    employeeName: _currentEmployee.fullName,
                    transactionType: type,
                    amount: double.parse(amountController.text.trim()),
                    reason: reasonController.text.trim(),
                  );

                  await _dbHelper.insertCreditTransaction(transaction);
                  Navigator.pop(context, true);
                } catch (e) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(
                      content: Text('Error: $e'),
                      backgroundColor: AppTheme.errorRed,
                    ),
                  );
                }
              }
            },
            child: const Text('Save'),
          ),
        ],
      ),
    );

    if (result == true) {
      _loadCreditData();
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(type == 'BORROW'
                ? 'Borrowed amount recorded'
                : 'Repayment recorded'),
            backgroundColor: AppTheme.successGreen,
          ),
        );
      }
    }
  }

  /// Show upload document dialog
  Future<void> _showUploadDocumentDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => UploadDocumentDialog(
        employeeId: _currentEmployee.id!,
      ),
    );

    if (result == true) {
      _loadDocuments();
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(
            content: Text('Document uploaded successfully!'),
            backgroundColor: AppTheme.successGreen,
            duration: Duration(seconds: 2),
          ),
        );
      }
    }
  }

  /// Handle photo tap - show options to add/change/remove
  Future<void> _handlePhotoTap() async {
    final photoService = PhotoPickerService();
    final newPhotoPath = await photoService.showPhotoOptions(
      context,
      _currentEmployee.photoPath,
    );

    // If null, user cancelled
    if (newPhotoPath == null) return;

    // Update employee in database
    final updatedEmployee = _currentEmployee.copyWith(
      photoPath: newPhotoPath.isEmpty ? null : newPhotoPath,
    );

    try {
      await _dbHelper.updateEmployee(updatedEmployee);
      
      // Update local state
      setState(() {
        _currentEmployee = updatedEmployee;
      });

      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(newPhotoPath.isEmpty 
                ? 'Photo removed' 
                : 'Photo updated successfully!'),
            backgroundColor: AppTheme.successGreen,
          ),
        );
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error updating photo: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: Text(_currentEmployee.fullName),
      ),
      body: Column(
        children: [
          // Employee Header Card
          _buildEmployeeHeader(),

          // Tabs
          TabBar(
            controller: _tabController,
            labelColor: AppTheme.primaryBrown,
            unselectedLabelColor: AppTheme.darkBrown.withOpacity(0.5),
            indicatorColor: AppTheme.primaryBrown,
            tabs: const [
              Tab(text: 'Details'),
              Tab(text: 'Credit'),
              Tab(text: 'Documents'),
            ],
          ),

          // Tab Views
          Expanded(
            child: TabBarView(
              controller: _tabController,
              children: [
                _buildDetailsTab(),
                _buildCreditTab(),
                _buildDocumentsTab(),
              ],
            ),
          ),
        ],
      ),
    );
  }

  /// Build employee header
  Widget _buildEmployeeHeader() {
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        gradient: LinearGradient(
          colors: [
            AppTheme.primaryBrown,
            AppTheme.primaryBrown.withOpacity(0.8),
          ],
        ),
        borderRadius: BorderRadius.circular(16),
      ),
      child: Row(
        children: [
          // Employee Photo with edit option
          GestureDetector(
            onTap: _handlePhotoTap,
            child: Stack(
              children: [
                EmployeePhotoWidget(
                  photoPath: _currentEmployee.photoPath,
                  radius: 40,
                  backgroundColor: Colors.white.withOpacity(0.2),
                ),
                Positioned(
                  right: 0,
                  bottom: 0,
                  child: Container(
                    padding: const EdgeInsets.all(6),
                    decoration: BoxDecoration(
                      color: Colors.white,
                      shape: BoxShape.circle,
                      border: Border.all(
                        color: AppTheme.primaryBrown,
                        width: 2,
                      ),
                    ),
                    child: Icon(
                      _currentEmployee.photoPath == null || _currentEmployee.photoPath!.isEmpty
                          ? Icons.add_a_photo
                          : Icons.edit,
                      size: 16,
                      color: AppTheme.primaryBrown,
                    ),
                  ),
                ),
              ],
            ),
          ),
          const SizedBox(width: 16),

          // Employee Info
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  _currentEmployee.fullName,
                  style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                        color: Colors.white,
                        fontWeight: FontWeight.bold,
                      ),
                ),
                const SizedBox(height: 4),
                Text(
                  _currentEmployee.role,
                  style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                        color: Colors.white.withOpacity(0.9),
                      ),
                ),
                const SizedBox(height: 4),
                Text(
                  '${_currentEmployee.age} years old',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        color: Colors.white.withOpacity(0.8),
                      ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  /// Build details tab
  Widget _buildDetailsTab() {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          _buildDetailRow('ID Type', _currentEmployee.idType),
          _buildDetailRow('ID Number', _currentEmployee.idNumber),
          _buildDetailRow(
              'Birth Date', DateFormat('dd MMM yyyy').format(_currentEmployee.birthDate)),
          _buildDetailRow('Age', '${_currentEmployee.age} years'),
          _buildDetailRow('Role', _currentEmployee.role),
          _buildDetailRow('Registered',
              DateFormat('dd MMM yyyy').format(_currentEmployee.createdAt)),
        ],
      ),
    );
  }

  /// Build detail row
  Widget _buildDetailRow(String label, String value) {
    return Container(
      margin: const EdgeInsets.only(bottom: 16),
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: AppTheme.lightCream,
        borderRadius: BorderRadius.circular(12),
      ),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(
            label,
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.7),
                ),
          ),
          Text(
            value,
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  fontWeight: FontWeight.w600,
                ),
          ),
        ],
      ),
    );
  }

  /// Build credit tab
  Widget _buildCreditTab() {
    return Column(
      children: [
        // Credit Balance Card
        Container(
          margin: const EdgeInsets.all(16),
          padding: const EdgeInsets.all(20),
          decoration: BoxDecoration(
            color: _creditBalance > 0 ? AppTheme.errorRed : AppTheme.successGreen,
            borderRadius: BorderRadius.circular(16),
          ),
          child: Column(
            children: [
              Text(
                'Current Balance',
                style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                      color: Colors.white.withOpacity(0.9),
                    ),
              ),
              const SizedBox(height: 8),
              Text(
                _currencyFormat.format(_creditBalance),
                style: Theme.of(context).textTheme.displayMedium?.copyWith(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                    ),
              ),
              const SizedBox(height: 16),
              Row(
                children: [
                  Expanded(
                    child: ElevatedButton.icon(
                      onPressed: () => _showAddTransactionDialog('BORROW'),
                      style: ElevatedButton.styleFrom(
                        backgroundColor: Colors.white,
                        foregroundColor: AppTheme.errorRed,
                      ),
                      icon: const Icon(Icons.add),
                      label: const Text('Borrow'),
                    ),
                  ),
                  const SizedBox(width: 12),
                  Expanded(
                    child: ElevatedButton.icon(
                      onPressed: () => _showAddTransactionDialog('REPAY'),
                      style: ElevatedButton.styleFrom(
                        backgroundColor: Colors.white,
                        foregroundColor: AppTheme.successGreen,
                      ),
                      icon: const Icon(Icons.remove),
                      label: const Text('Repay'),
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),

        // Transactions List
        Expanded(
          child: _isLoadingCredit
              ? const Center(child: CircularProgressIndicator())
              : _transactions.isEmpty
                  ? Center(
                      child: Text(
                        'No transactions yet',
                        style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                              color: AppTheme.darkBrown.withOpacity(0.5),
                            ),
                      ),
                    )
                  : ListView.builder(
                      padding: const EdgeInsets.symmetric(horizontal: 16),
                      itemCount: _transactions.length,
                      itemBuilder: (context, index) {
                        return _buildTransactionCard(_transactions[index]);
                      },
                    ),
        ),
      ],
    );
  }

  /// Build transaction card
  Widget _buildTransactionCard(CreditTransaction transaction) {
    final isBorrow = transaction.transactionType == 'BORROW';
    final color = isBorrow ? AppTheme.errorRed : AppTheme.successGreen;

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  isBorrow ? 'Borrowed' : 'Repaid',
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: color,
                        fontWeight: FontWeight.w600,
                      ),
                ),
                Text(
                  '${isBorrow ? '+' : '-'}${_currencyFormat.format(transaction.amount)}',
                  style: Theme.of(context).textTheme.titleMedium?.copyWith(
                        color: color,
                        fontWeight: FontWeight.bold,
                      ),
                ),
              ],
            ),
            const SizedBox(height: 8),
            Text(
              transaction.reason,
              style: Theme.of(context).textTheme.bodyMedium,
            ),
            const SizedBox(height: 8),
            Text(
              _dateFormat.format(transaction.createdAt),
              style: Theme.of(context).textTheme.bodySmall?.copyWith(
                    color: AppTheme.darkBrown.withOpacity(0.6),
                  ),
            ),
          ],
        ),
      ),
    );
  }

  /// Build documents tab
  Widget _buildDocumentsTab() {
    return Column(
      children: [
        // Upload Button
        Padding(
          padding: const EdgeInsets.all(16),
          child: ElevatedButton.icon(
            onPressed: _showUploadDocumentDialog,
            icon: const Icon(Icons.upload_file),
            label: const Text('Upload Document'),
          ),
        ),

        // Documents List
        Expanded(
          child: _isLoadingDocuments
              ? const Center(child: CircularProgressIndicator())
              : _documents.isEmpty
                  ? Center(
                      child: Column(
                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [
                          Icon(
                            Icons.folder_open,
                            size: 80,
                            color: AppTheme.darkBrown.withOpacity(0.3),
                          ),
                          const SizedBox(height: 16),
                          Text(
                            'No documents yet',
                            style: Theme.of(context)
                                .textTheme
                                .bodyLarge
                                ?.copyWith(
                                  color: AppTheme.darkBrown.withOpacity(0.5),
                                ),
                          ),
                        ],
                      ),
                    )
                  : ListView.builder(
                      padding: const EdgeInsets.symmetric(horizontal: 16),
                      itemCount: _documents.length,
                      itemBuilder: (context, index) {
                        return _buildDocumentCard(_documents[index]);
                      },
                    ),
        ),
      ],
    );
  }

/// Build document card
Widget _buildDocumentCard(EmployeeDocument document) {
  IconData icon;
  Color color;

  switch (document.documentType) {
    case 'CONTRACT':
      icon = Icons.description;
      color = Colors.blue;
      break;
    case 'PAYSLIP':
      icon = Icons.receipt;
      color = Colors.green;
      break;
    case 'DISCIPLINARY':
      icon = Icons.warning;
      color = Colors.orange;
      break;
    case 'ID':
      icon = Icons.badge;
      color = Colors.purple;
      break;
    case 'OTHER':
      icon = Icons.insert_drive_file;
      color = Colors.grey;
      break;
    default:
      icon = Icons.insert_drive_file;
      color = AppTheme.primaryBrown;
  }

  return Card(
    margin: const EdgeInsets.only(bottom: 12),
    child: ListTile(
      leading: CircleAvatar(
        backgroundColor: color.withOpacity(0.1),
        child: Icon(icon, color: color),
      ),
      title: Text(document.fileName),
      subtitle: Text(
        '${_formatDocumentType(document.documentType)} â€¢ ${_dateFormat.format(document.uploadedAt)}',
      ),
      trailing: PopupMenuButton<String>(
        onSelected: (value) {
          if (value == 'view') {
            _viewDocument(document);
          } else if (value == 'delete') {
            _deleteDocument(document);
          }
        },
        itemBuilder: (context) => [
          const PopupMenuItem(
            value: 'view',
            child: Row(
              children: [
                Icon(Icons.visibility, size: 20),
                SizedBox(width: 8),
                Text('View'),
              ],
            ),
          ),
          const PopupMenuItem(
            value: 'delete',
            child: Row(
              children: [
                Icon(Icons.delete, size: 20, color: AppTheme.errorRed),
                SizedBox(width: 8),
                Text('Delete', style: TextStyle(color: AppTheme.errorRed)),
              ],
            ),
          ),
        ],
      ),
    ),
  );
}

/// Format document type for display
String _formatDocumentType(String type) {
  switch (type) {
    case 'CONTRACT':
      return 'Contract';
    case 'PAYSLIP':
      return 'Payslip';
    case 'DISCIPLINARY':
      return 'Disciplinary';
    case 'ID':
      return 'ID Document';  
    case 'OTHER':
      return 'Other';
    default:
      return type;
  }
}

/// View document
void _viewDocument(EmployeeDocument document) {
  // We'll show the file path for now
  // In a production app, you'd open the PDF viewer here
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: const Text('Document Location'),
      content: Column(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            'File: ${document.fileName}',
            style: const TextStyle(fontWeight: FontWeight.bold),
          ),
          const SizedBox(height: 8),
          Text(
            'Path: ${document.filePath}',
            style: const TextStyle(fontSize: 12),
          ),
          const SizedBox(height: 16),
          Container(
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(
              color: AppTheme.primaryBrown.withOpacity(0.1),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Row(
              children: [
                Icon(
                  Icons.info_outline,
                  size: 20,
                  color: AppTheme.primaryBrown,
                ),
                const SizedBox(width: 8),
                Expanded(
                  child: Text(
                    'Open this file using your device\'s PDF viewer',
                    style: Theme.of(context).textTheme.bodySmall,
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: const Text('Close'),
        ),
      ],
    ),
  );
}

/// Delete document
Future<void> _deleteDocument(EmployeeDocument document) async {
  final confirm = await showDialog<bool>(
    context: context,
    builder: (context) => AlertDialog(
      title: const Text('Delete Document'),
      content: Text('Are you sure you want to delete "${document.fileName}"?'),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context, false),
          child: const Text('Cancel'),
        ),
        ElevatedButton(
          onPressed: () => Navigator.pop(context, true),
          style: ElevatedButton.styleFrom(
            backgroundColor: AppTheme.errorRed,
          ),
          child: const Text('Delete'),
        ),
      ],
    ),
  );

  if (confirm == true) {
    try {
      // Delete from database
      await _dbHelper.deleteEmployeeDocument(document.id!);
      
      // Optionally delete the actual file
      try {
        final file = File(document.filePath);
        if (await file.exists()) {
          await file.delete();
        }
      } catch (e) {
        // File deletion failed, but database record is deleted
        debugPrint('Failed to delete file: $e');
      }

      _loadDocuments();
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(
            content: Text('Document deleted successfully!'),
            backgroundColor: AppTheme.successGreen,
            duration: Duration(seconds: 2),
          ),
        );
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error deleting document: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }
}
}

END OF CODE.

11. employee_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/screens/employee_details_screen.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_employee_dialog.dart';
import 'package:a_one_bakeries_app/widgets/employee_photo_widget.dart';
import 'package:intl/intl.dart';

/// Employee Screen
/// 
/// Main screen for employee management.
/// Displays all employees with their roles and basic info.
/// Allows adding, editing, deleting, and viewing employee details.

class EmployeeScreen extends StatefulWidget {
  const EmployeeScreen({super.key});

  @override
  State<EmployeeScreen> createState() => _EmployeeScreenState();
}

class _EmployeeScreenState extends State<EmployeeScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<Employee> _employees = [];
  List<Employee> _filteredEmployees = [];
  bool _isLoading = true;
  final TextEditingController _searchController = TextEditingController();
  String _selectedRole = 'ALL';

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy');

  @override
  void initState() {
    super.initState();
    _loadEmployees();
  }

  @override
  void dispose() {
    _searchController.dispose();
    super.dispose();
  }

  /// Load all employees from database
  Future<void> _loadEmployees() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final employees = await _dbHelper.getAllEmployees();
      setState(() {
        _employees = employees;
        _applyFilters();
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading employees: $e');
      }
    }
  }

  /// Apply search and role filters
  void _applyFilters() {
    List<Employee> filtered = _employees;

    // Filter by role
    if (_selectedRole != 'ALL') {
      filtered = filtered.where((e) => e.role == _selectedRole).toList();
    }

    // Filter by search query
    final query = _searchController.text.toLowerCase();
    if (query.isNotEmpty) {
      filtered = filtered
          .where((e) =>
              e.firstName.toLowerCase().contains(query) ||
              e.lastName.toLowerCase().contains(query) ||
              e.idNumber.toLowerCase().contains(query))
          .toList();
    }

    setState(() {
      _filteredEmployees = filtered;
    });
  }

  /// Show add employee dialog
  Future<void> _showAddEmployeeDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditEmployeeDialog(),
    );

    if (result == true) {
      _loadEmployees();
      if (mounted) {
        _showSuccessSnackBar('Employee registered successfully!');
      }
    }
  }

  /// Show edit employee dialog
  Future<void> _showEditEmployeeDialog(Employee employee) async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AddEditEmployeeDialog(employee: employee),
    );

    if (result == true) {
      _loadEmployees();
      if (mounted) {
        _showSuccessSnackBar('Employee updated successfully!');
      }
    }
  }

  /// Delete employee
  Future<void> _deleteEmployee(Employee employee) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Employee'),
        content: Text(
            'Are you sure you want to delete ${employee.fullName}? This will also delete all related records.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteEmployee(employee.id!);
        _loadEmployees();
        if (mounted) {
          _showSuccessSnackBar('Employee deleted successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting employee: $e');
        }
      }
    }
  }

  /// Navigate to employee details
  void _navigateToEmployeeDetails(Employee employee) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => EmployeeDetailsScreen(employee: employee),
      ),
    ).then((_) => _loadEmployees()); // Refresh on return
  }

  /// Get role icon
  IconData _getRoleIcon(String role) {
    switch (role) {
      case 'Baker':
        return Icons.bakery_dining;
      case 'Driver':
        return Icons.local_shipping;
      case 'General Worker':
        return Icons.construction;
      case 'Supervisor':
        return Icons.supervisor_account;
      case 'Manager':
        return Icons.business_center;
      default:
        return Icons.person;
    }
  }

  /// Get role color
  Color _getRoleColor(String role) {
    switch (role) {
      case 'Baker':
        return AppTheme.primaryBrown;
      case 'Driver':
        return AppTheme.secondaryOrange;
      case 'General Worker':
        return Colors.blue;
      case 'Supervisor':
        return Colors.purple;
      case 'Manager':
        return Colors.green;
      default:
        return AppTheme.darkBrown;
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Employees'),
      ),
      body: Column(
        children: [
          // Search Bar
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: TextField(
              controller: _searchController,
              onChanged: (_) => _applyFilters(),
              decoration: InputDecoration(
                hintText: 'Search employees...',
                prefixIcon: const Icon(Icons.search),
                suffixIcon: _searchController.text.isNotEmpty
                    ? IconButton(
                        icon: const Icon(Icons.clear),
                        onPressed: () {
                          _searchController.clear();
                          _applyFilters();
                        },
                      )
                    : null,
              ),
            ),
          ),

          // Role Filter Chips
          _buildRoleFilters(),

          // Employee Count
          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
            child: Row(
              children: [
                Text(
                  '${_filteredEmployees.length} ${_filteredEmployees.length == 1 ? 'Employee' : 'Employees'}',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.7),
                        fontWeight: FontWeight.w600,
                      ),
                ),
              ],
            ),
          ),

          // Employees List
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _filteredEmployees.isEmpty
                    ? _buildEmptyState()
                    : RefreshIndicator(
                        onRefresh: _loadEmployees,
                        color: AppTheme.primaryBrown,
                        child: ListView.builder(
                          padding: const EdgeInsets.symmetric(horizontal: 16),
                          itemCount: _filteredEmployees.length,
                          itemBuilder: (context, index) {
                            return _buildEmployeeCard(
                                _filteredEmployees[index]);
                          },
                        ),
                      ),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _showAddEmployeeDialog,
        child: const Icon(Icons.person_add),
      ),
    );
  }

  /// Build role filter chips
  Widget _buildRoleFilters() {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16),
      height: 50,
      child: ListView(
        scrollDirection: Axis.horizontal,
        children: [
          _buildRoleChip('ALL', 'All'),
          ...EmployeeRoles.allRoles.map((role) => _buildRoleChip(role, role)),
        ],
      ),
    );
  }

  /// Build single role filter chip
  Widget _buildRoleChip(String value, String label) {
    final isSelected = _selectedRole == value;
    return Padding(
      padding: const EdgeInsets.only(right: 8),
      child: FilterChip(
        label: Text(label),
        selected: isSelected,
        onSelected: (selected) {
          setState(() {
            _selectedRole = value;
            _applyFilters();
          });
        },
        selectedColor: AppTheme.primaryBrown,
        checkmarkColor: Colors.white,
        labelStyle: TextStyle(
          color: isSelected ? Colors.white : AppTheme.darkBrown,
          fontWeight: isSelected ? FontWeight.w600 : FontWeight.w400,
        ),
      ),
    );
  }

  /// Build employee card
  Widget _buildEmployeeCard(Employee employee) {
    final roleColor = _getRoleColor(employee.role);
    final roleIcon = _getRoleIcon(employee.role);

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: InkWell(
        onTap: () => _navigateToEmployeeDetails(employee),
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Row(
            children: [
              // Employee Photo using custom widget
              EmployeePhotoWidget(
                photoPath: employee.photoPath,
                radius: 30,
                backgroundColor: roleColor.withOpacity(0.1),
              ),
              const SizedBox(width: 16),

              // Employee Info
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    // Name
                    Text(
                      employee.fullName,
                      style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                    const SizedBox(height: 4),

                    // Role with icon
                    Row(
                      children: [
                        Icon(
                          roleIcon,
                          size: 16,
                          color: roleColor,
                        ),
                        const SizedBox(width: 4),
                        Text(
                          employee.role,
                          style:
                              Theme.of(context).textTheme.bodySmall?.copyWith(
                                    color: roleColor,
                                    fontWeight: FontWeight.w600,
                                  ),
                        ),
                      ],
                    ),
                    const SizedBox(height: 4),

                    // ID Number
                    Text(
                      '${employee.idType}: ${employee.idNumber}',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: AppTheme.darkBrown.withOpacity(0.6),
                          ),
                    ),
                  ],
                ),
              ),

              // Actions Menu
              PopupMenuButton<String>(
                onSelected: (value) {
                  if (value == 'edit') {
                    _showEditEmployeeDialog(employee);
                  } else if (value == 'delete') {
                    _deleteEmployee(employee);
                  } else if (value == 'details') {
                    _navigateToEmployeeDetails(employee);
                  }
                },
                itemBuilder: (context) => [
                  const PopupMenuItem(
                    value: 'details',
                    child: Row(
                      children: [
                        Icon(Icons.info, size: 20),
                        SizedBox(width: 8),
                        Text('View Details'),
                      ],
                    ),
                  ),
                  const PopupMenuItem(
                    value: 'edit',
                    child: Row(
                      children: [
                        Icon(Icons.edit, size: 20),
                        SizedBox(width: 8),
                        Text('Edit'),
                      ],
                    ),
                  ),
                  const PopupMenuItem(
                    value: 'delete',
                    child: Row(
                      children: [
                        Icon(Icons.delete, size: 20, color: AppTheme.errorRed),
                        SizedBox(width: 8),
                        Text('Delete',
                            style: TextStyle(color: AppTheme.errorRed)),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.people_outline,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            _searchController.text.isEmpty && _selectedRole == 'ALL'
                ? 'No employees yet'
                : 'No employees found',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            _searchController.text.isEmpty && _selectedRole == 'ALL'
                ? 'Tap + to register your first employee'
                : 'Try adjusting your filters',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Show success snackbar
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

12. finance_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/finance_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/widgets/add_income_dialog.dart';
import 'package:a_one_bakeries_app/widgets/add_expense_dialog.dart';
import 'package:intl/intl.dart';

/// Finance Screen
/// 
/// Main screen for income and expense management.
/// Shows summary, income tab, and expenses tab.

class FinanceScreen extends StatefulWidget {
  const FinanceScreen({super.key});

  @override
  State<FinanceScreen> createState() => _FinanceScreenState();
}

class _FinanceScreenState extends State<FinanceScreen>
    with SingleTickerProviderStateMixin {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  late TabController _tabController;

  // Summary data
  double _totalIncome = 0.0;
  double _totalExpenses = 0.0;
  double _moneyOnHand = 0.0;

  // Income and Expenses lists
  List<Income> _incomeList = [];
  List<Expense> _expensesList = [];

  bool _isLoading = true;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy HH:mm');
  final NumberFormat _currencyFormat = NumberFormat.currency(symbol: 'R ');

  @override
  void initState() {
    super.initState();
    _tabController = TabController(length: 2, vsync: this);
    _loadFinanceData();
  }

  @override
  void dispose() {
    _tabController.dispose();
    super.dispose();
  }

  /// Load all finance data
  Future<void> _loadFinanceData() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final income = await _dbHelper.getAllIncome();
      final expenses = await _dbHelper.getAllExpenses();
      final totalIncome = await _dbHelper.getTotalIncome();
      final totalExpenses = await _dbHelper.getTotalExpenses();
      final moneyOnHand = await _dbHelper.getMoneyOnHand();

      setState(() {
        _incomeList = income;
        _expensesList = expenses;
        _totalIncome = totalIncome;
        _totalExpenses = totalExpenses;
        _moneyOnHand = moneyOnHand;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading finance data: $e');
      }
    }
  }

  /// Show add income dialog
  Future<void> _showAddIncomeDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddIncomeDialog(),
    );

    if (result == true) {
      _loadFinanceData();
      if (mounted) {
        _showSuccessSnackBar('Income recorded successfully!');
      }
    }
  }

  /// Show add expense dialog
  Future<void> _showAddExpenseDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddExpenseDialog(),
    );

    if (result == true) {
      _loadFinanceData();
      if (mounted) {
        _showSuccessSnackBar('Expense recorded successfully!');
      }
    }
  }

  /// Delete income
  Future<void> _deleteIncome(Income income) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Income'),
        content: Text('Delete income record of ${_currencyFormat.format(income.total)}?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteIncome(income.id!);
        _loadFinanceData();
        if (mounted) {
          _showSuccessSnackBar('Income deleted!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting income: $e');
        }
      }
    }
  }

  /// Delete expense
  Future<void> _deleteExpense(Expense expense) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Expense'),
        content: Text('Delete expense: ${expense.description}?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteExpense(expense.id!);
        _loadFinanceData();
        if (mounted) {
          _showSuccessSnackBar('Expense deleted!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting expense: $e');
        }
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Income & Expenses'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : Column(
              children: [
                // Summary Section
                _buildSummarySection(),

                // Tabs
                TabBar(
                  controller: _tabController,
                  labelColor: AppTheme.primaryBrown,
                  unselectedLabelColor: AppTheme.darkBrown.withOpacity(0.5),
                  indicatorColor: AppTheme.primaryBrown,
                  tabs: const [
                    Tab(text: 'Income'),
                    Tab(text: 'Expenses'),
                  ],
                ),

                // Tab Views
                Expanded(
                  child: TabBarView(
                    controller: _tabController,
                    children: [
                      _buildIncomeTab(),
                      _buildExpensesTab(),
                    ],
                  ),
                ),
              ],
            ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          if (_tabController.index == 0) {
            _showAddIncomeDialog();
          } else {
            _showAddExpenseDialog();
          }
        },
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build summary section
  Widget _buildSummarySection() {
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        gradient: LinearGradient(
          colors: [
            AppTheme.primaryBrown,
            AppTheme.primaryBrown.withOpacity(0.8),
          ],
        ),
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: AppTheme.primaryBrown.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        children: [
          // Money on Hand
          Text(
            'Money on Hand',
            style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                  color: Colors.white.withOpacity(0.9),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            _currencyFormat.format(_moneyOnHand),
            style: Theme.of(context).textTheme.displayMedium?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
          const Divider(height: 32, color: Colors.white24),

          // Income and Expenses Row
          Row(
            children: [
              Expanded(
                child: Column(
                  children: [
                    Text(
                      'Total Income',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: Colors.white.withOpacity(0.8),
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      _currencyFormat.format(_totalIncome),
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            color: AppTheme.successGreen,
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
              ),
              Container(
                height: 40,
                width: 1,
                color: Colors.white24,
              ),
              Expanded(
                child: Column(
                  children: [
                    Text(
                      'Total Expenses',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: Colors.white.withOpacity(0.8),
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      _currencyFormat.format(_totalExpenses),
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            color: AppTheme.errorRed,
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ],
      ),
    );
  }

  /// Build income tab
  Widget _buildIncomeTab() {
    return _incomeList.isEmpty
        ? _buildEmptyState('No income recorded yet', Icons.attach_money)
        : RefreshIndicator(
            onRefresh: _loadFinanceData,
            color: AppTheme.primaryBrown,
            child: ListView.builder(
              padding: const EdgeInsets.all(16),
              itemCount: _incomeList.length,
              itemBuilder: (context, index) {
                return _buildIncomeCard(_incomeList[index]);
              },
            ),
          );
  }

  /// Build expenses tab
  Widget _buildExpensesTab() {
    return _expensesList.isEmpty
        ? _buildEmptyState('No expenses recorded yet', Icons.money_off)
        : RefreshIndicator(
            onRefresh: _loadFinanceData,
            color: AppTheme.primaryBrown,
            child: ListView.builder(
              padding: const EdgeInsets.all(16),
              itemCount: _expensesList.length,
              itemBuilder: (context, index) {
                return _buildExpenseCard(_expensesList[index]);
              },
            ),
          );
  }

  /// Build income card
  Widget _buildIncomeCard(Income income) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              children: [
                Container(
                  padding: const EdgeInsets.all(8),
                  decoration: BoxDecoration(
                    color: AppTheme.successGreen.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                  ),
                  child: const Icon(
                    Icons.attach_money,
                    color: AppTheme.successGreen,
                    size: 24,
                  ),
                ),
                const SizedBox(width: 12),
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        income.description ?? 'Income',
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        _dateFormat.format(income.createdAt),
                        style: Theme.of(context).textTheme.bodySmall?.copyWith(
                              color: AppTheme.darkBrown.withOpacity(0.6),
                            ),
                      ),
                    ],
                  ),
                ),
                IconButton(
                  icon: const Icon(Icons.delete, color: AppTheme.errorRed),
                  onPressed: () => _deleteIncome(income),
                  iconSize: 20,
                ),
              ],
            ),
            const Divider(height: 16),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text('Notes:', style: Theme.of(context).textTheme.bodyMedium),
                Text(
                  _currencyFormat.format(income.notes),
                  style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
              ],
            ),
            const SizedBox(height: 8),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text('Coins:', style: Theme.of(context).textTheme.bodyMedium),
                Text(
                  _currencyFormat.format(income.coins),
                  style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
              ],
            ),
            const Divider(height: 16),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  'TOTAL:',
                  style: Theme.of(context).textTheme.titleMedium?.copyWith(
                        fontWeight: FontWeight.bold,
                      ),
                ),
                Text(
                  _currencyFormat.format(income.total),
                  style: Theme.of(context).textTheme.titleLarge?.copyWith(
                        color: AppTheme.successGreen,
                        fontWeight: FontWeight.bold,
                      ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  /// Build expense card
  Widget _buildExpenseCard(Expense expense) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Row(
          children: [
            Container(
              padding: const EdgeInsets.all(8),
              decoration: BoxDecoration(
                color: AppTheme.errorRed.withOpacity(0.1),
                borderRadius: BorderRadius.circular(8),
              ),
              child: const Icon(
                Icons.money_off,
                color: AppTheme.errorRed,
                size: 24,
              ),
            ),
            const SizedBox(width: 12),
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    expense.description,
                    style: Theme.of(context).textTheme.titleMedium?.copyWith(
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                  const SizedBox(height: 4),
                  Text(
                    _dateFormat.format(expense.createdAt),
                    style: Theme.of(context).textTheme.bodySmall?.copyWith(
                          color: AppTheme.darkBrown.withOpacity(0.6),
                        ),
                  ),
                ],
              ),
            ),
            Column(
              crossAxisAlignment: CrossAxisAlignment.end,
              children: [
                Text(
                  _currencyFormat.format(expense.amount),
                  style: Theme.of(context).textTheme.titleLarge?.copyWith(
                        color: AppTheme.errorRed,
                        fontWeight: FontWeight.bold,
                      ),
                ),
                IconButton(
                  icon: const Icon(Icons.delete, color: AppTheme.errorRed),
                  onPressed: () => _deleteExpense(expense),
                  iconSize: 20,
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState(String message, IconData icon) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            icon,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            message,
            style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Tap + to add',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Show success snackbar
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

13. main_navigation.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/screens/dashboard_screen.dart';
import 'package:a_one_bakeries_app/screens/stock_screen.dart';
import 'package:a_one_bakeries_app/screens/employee_screen.dart';
import 'package:a_one_bakeries_app/screens/orders_screen.dart';
import 'package:a_one_bakeries_app/screens/finance_screen.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';

/// Main Navigation Controller
/// 
/// This widget manages the bottom navigation bar and switches between
/// different screens based on the selected tab.
/// 
/// It uses setState to track which screen is currently active.

class MainNavigation extends StatefulWidget {
  const MainNavigation({super.key});

  @override
  State<MainNavigation> createState() => _MainNavigationState();
}

class _MainNavigationState extends State<MainNavigation> {
  // Current selected index (0 = Dashboard, 1 = Stock, etc.)
  int _currentIndex = 0;

  // List of screens corresponding to each navigation item
  final List<Widget> _screens = [
    const DashboardScreen(),      // Index 0 - Dashboard
    const StockScreen(),          // Index 1 - Stock
    const EmployeeScreen(),       // Index 2 - Employees
    const OrdersScreen(),         // Index 3 - Orders
    const FinanceScreen(),        // Index 4 - Finance
  ];

  /// Handle navigation tap
  void _onNavItemTapped(int index) {
    setState(() {
      _currentIndex = index;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // Display the current screen based on selected index
      body: _screens[_currentIndex],
      
      // Custom Bottom Navigation Bar
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: _onNavItemTapped,
        type: BottomNavigationBarType.fixed,
        
        // Navigation Items
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.dashboard),
            label: 'Dashboard',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.inventory_2),
            label: 'Stock',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.people),
            label: 'Employees',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.shopping_cart),
            label: 'Orders',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.account_balance_wallet),
            label: 'Finance',
          ),
        ],
      ),
    );
  }
}

END OF CODE.

14. multi_item_allocation_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Multi-Item Allocation Screen
/// 
/// Allows allocating multiple stock items at once.
/// User selects items, enters quantities, and employee name.

class MultiItemAllocationScreen extends StatefulWidget {
  const MultiItemAllocationScreen({super.key});

  @override
  State<MultiItemAllocationScreen> createState() => _MultiItemAllocationScreenState();
}

class _MultiItemAllocationScreenState extends State<MultiItemAllocationScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  final _formKey = GlobalKey<FormState>();
  final TextEditingController _employeeController = TextEditingController();
  final TextEditingController _notesController = TextEditingController();

  List<StockItem> _allStockItems = [];
  List<AllocationItem> _allocationItems = [];
  bool _isLoading = true;
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _loadStockItems();
  }

  @override
  void dispose() {
    _employeeController.dispose();
    _notesController.dispose();
    super.dispose();
  }

  /// Load all stock items
  Future<void> _loadStockItems() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final items = await _dbHelper.getAllStockItems();
      setState(() {
        _allStockItems = items;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading stock items: $e');
      }
    }
  }

  /// Add item to allocation list
  void _addItem(StockItem stockItem) {
    // Check if already added
    if (_allocationItems.any((item) => item.stockItem.id == stockItem.id)) {
      _showErrorSnackBar('${stockItem.name} is already in the list');
      return;
    }

    setState(() {
      _allocationItems.add(AllocationItem(stockItem: stockItem));
    });
  }

  /// Remove item from allocation list
  void _removeItem(int index) {
    setState(() {
      _allocationItems.removeAt(index);
    });
  }

  /// Calculate total items
  int get _totalItems => _allocationItems.length;

  /// Calculate total quantity
  int get _totalQuantity {
    int total = 0;
    for (var item in _allocationItems) {
      total += item.quantity;
    }
    return total;
  }

  /// Save all allocations
  Future<void> _saveAllocations() async {
    if (!_formKey.currentState!.validate()) return;

    if (_allocationItems.isEmpty) {
      _showErrorSnackBar('Please add at least one item');
      return;
    }

    // Validate all items have quantity
    bool allValid = true;
    for (var item in _allocationItems) {
      if (item.quantity <= 0) {
        allValid = false;
        break;
      }
      if (item.quantity > item.stockItem.quantityOnHand) {
        _showErrorSnackBar(
            '${item.stockItem.name}: Insufficient stock (Available: ${item.stockItem.quantityOnHand})');
        return;
      }
    }

    if (!allValid) {
      _showErrorSnackBar('Please enter quantity for all items');
      return;
    }

    setState(() {
      _isSaving = true;
    });

    try {
      // Create movements for each item
      for (var item in _allocationItems) {
        final movement = StockMovement(
          stockItemId: item.stockItem.id!,
          stockItemName: item.stockItem.name,
          movementType: 'ALLOCATED',
          quantity: item.quantity,
          employeeName: _employeeController.text.trim(),
          notes: _notesController.text.trim().isEmpty
              ? null
              : _notesController.text.trim(),
        );

        await _dbHelper.insertStockMovement(movement);
      }

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error saving allocations: $e');
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Allocate Stock'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : Form(
              key: _formKey,
              child: Column(
                children: [
                  // Header Section
                  _buildHeaderSection(),

                  // Allocated Items List
                  Expanded(
                    child: _allocationItems.isEmpty
                        ? _buildEmptyState()
                        : ListView.builder(
                            padding: const EdgeInsets.all(16),
                            itemCount: _allocationItems.length,
                            itemBuilder: (context, index) {
                              return _buildAllocationItemCard(index);
                            },
                          ),
                  ),

                  // Bottom Bar with Save Button
                  _buildBottomBar(),
                ],
              ),
            ),
      floatingActionButton: FloatingActionButton(
        onPressed: _showAddItemDialog,
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build header section
  Widget _buildHeaderSection() {
    return Container(
      padding: const EdgeInsets.all(16),
      color: Colors.white,
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // Employee Name
          TextFormField(
            controller: _employeeController,
            decoration: const InputDecoration(
              labelText: 'Employee Name',
              hintText: 'Who is receiving this stock?',
              prefixIcon: Icon(Icons.person),
            ),
            textCapitalization: TextCapitalization.words,
            validator: (value) {
              if (value == null || value.trim().isEmpty) {
                return 'Please enter employee name';
              }
              return null;
            },
          ),
          const SizedBox(height: 16),

          // Notes
          TextFormField(
            controller: _notesController,
            decoration: const InputDecoration(
              labelText: 'Notes (Optional)',
              hintText: 'e.g., Order details',
              prefixIcon: Icon(Icons.note),
            ),
            maxLines: 2,
            textCapitalization: TextCapitalization.sentences,
          ),
          const SizedBox(height: 16),

          // Summary
          Container(
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(
              color: AppTheme.primaryBrown.withOpacity(0.1),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  'Items: $_totalItems',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
                Text(
                  'Total Qty: $_totalQuantity',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                        color: AppTheme.primaryBrown,
                      ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  /// Build allocation item card
  Widget _buildAllocationItemCard(int index) {
    final item = _allocationItems[index];

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Header
            Row(
              children: [
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        item.stockItem.name,
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        'Available: ${item.stockItem.quantityOnHand} ${item.stockItem.unit}',
                        style: Theme.of(context).textTheme.bodySmall?.copyWith(
                              color: AppTheme.darkBrown.withOpacity(0.6),
                            ),
                      ),
                    ],
                  ),
                ),
                IconButton(
                  icon: const Icon(Icons.delete, color: AppTheme.errorRed),
                  onPressed: () => _removeItem(index),
                ),
              ],
            ),
            const SizedBox(height: 12),

            // Quantity Input
            Row(
              children: [
                // Decrease Button
                IconButton(
                  icon: const Icon(Icons.remove_circle_outline),
                  onPressed: () {
                    if (item.quantity > 0) {
                      setState(() {
                        item.quantity--;
                      });
                    }
                  },
                ),

                // Quantity Display
                Expanded(
                  child: Container(
                    padding: const EdgeInsets.symmetric(vertical: 12),
                    decoration: BoxDecoration(
                      color: AppTheme.lightCream,
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: Text(
                      '${item.quantity} ${item.stockItem.unit}',
                      textAlign: TextAlign.center,
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            fontWeight: FontWeight.bold,
                            color: AppTheme.primaryBrown,
                          ),
                    ),
                  ),
                ),

                // Increase Button
                IconButton(
                  icon: const Icon(Icons.add_circle_outline),
                  onPressed: () {
                    if (item.quantity < item.stockItem.quantityOnHand) {
                      setState(() {
                        item.quantity++;
                      });
                    } else {
                      _showErrorSnackBar('Maximum quantity reached');
                    }
                  },
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.inbox,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No items added',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Tap + to add stock items',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Build bottom bar
  Widget _buildBottomBar() {
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.white,
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 4,
            offset: const Offset(0, -2),
          ),
        ],
      ),
      child: SafeArea(
        child: SizedBox(
          width: double.infinity,
          child: ElevatedButton(
            onPressed: _isSaving ? null : _saveAllocations,
            style: ElevatedButton.styleFrom(
              padding: const EdgeInsets.symmetric(vertical: 16),
            ),
            child: _isSaving
                ? const SizedBox(
                    height: 20,
                    width: 20,
                    child: CircularProgressIndicator(
                      strokeWidth: 2,
                      valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                    ),
                  )
                : Text(
                    'Allocate ${_allocationItems.length} Items',
                    style: const TextStyle(fontSize: 18),
                  ),
          ),
        ),
      ),
    );
  }

  /// Show add item dialog
  Future<void> _showAddItemDialog() async {
    StockItem? selectedItem;

    await showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Add Stock Item'),
        content: SizedBox(
          width: double.maxFinite,
          child: StatefulBuilder(
            builder: (context, setState) {
              return Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  DropdownButtonFormField<StockItem>(
                    value: selectedItem,
                    decoration: const InputDecoration(
                      labelText: 'Select Item',
                      prefixIcon: Icon(Icons.inventory_2),
                    ),
                    items: _allStockItems
                        .where((item) => !_allocationItems
                            .any((ai) => ai.stockItem.id == item.id))
                        .map((item) => DropdownMenuItem(
                              value: item,
                              child: Text(
                                  '${item.name} (${item.quantityOnHand} ${item.unit})'),
                            ))
                        .toList(),
                    onChanged: (value) {
                      setState(() {
                        selectedItem = value;
                      });
                    },
                  ),
                ],
              );
            },
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () {
              if (selectedItem != null) {
                _addItem(selectedItem!);
                Navigator.pop(context);
              }
            },
            child: const Text('Add'),
          ),
        ],
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

/// Allocation Item Helper Class
class AllocationItem {
  final StockItem stockItem;
  int quantity;

  AllocationItem({
    required this.stockItem,
    this.quantity = 0,
  });
}

END OF CODE.

15. multi_item_receiving_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/models/supplier_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Multi-Item Receiving Screen
/// 
/// Allows receiving multiple stock items at once from a supplier.

class MultiItemReceivingScreen extends StatefulWidget {
  const MultiItemReceivingScreen({super.key});

  @override
  State<MultiItemReceivingScreen> createState() => _MultiItemReceivingScreenState();
}

class _MultiItemReceivingScreenState extends State<MultiItemReceivingScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  final _formKey = GlobalKey<FormState>();
  final TextEditingController _notesController = TextEditingController();

  List<StockItem> _allStockItems = [];
  List<Supplier> _suppliers = [];
  List<ReceivingItem> _receivingItems = [];
  Supplier? _selectedSupplier;
  bool _isLoading = true;
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _loadData();
  }

  @override
  void dispose() {
    _notesController.dispose();
    super.dispose();
  }

  /// Load stock items and suppliers
  Future<void> _loadData() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final items = await _dbHelper.getAllStockItems();
      final suppliers = await _dbHelper.getAllSuppliers();
      setState(() {
        _allStockItems = items;
        _suppliers = suppliers;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading data: $e');
      }
    }
  }

  /// Add item to receiving list
  void _addItem(StockItem stockItem) {
    if (_receivingItems.any((item) => item.stockItem.id == stockItem.id)) {
      _showErrorSnackBar('${stockItem.name} is already in the list');
      return;
    }

    setState(() {
      _receivingItems.add(ReceivingItem(stockItem: stockItem));
    });
  }

  /// Remove item from receiving list
  void _removeItem(int index) {
    setState(() {
      _receivingItems.removeAt(index);
    });
  }

  /// Calculate totals
  int get _totalItems => _receivingItems.length;
  int get _totalQuantity {
    int total = 0;
    for (var item in _receivingItems) {
      total += item.quantity;
    }
    return total;
  }

  /// Save all receiving
  Future<void> _saveReceiving() async {
    if (!_formKey.currentState!.validate()) return;

    if (_selectedSupplier == null) {
      _showErrorSnackBar('Please select a supplier');
      return;
    }

    if (_receivingItems.isEmpty) {
      _showErrorSnackBar('Please add at least one item');
      return;
    }

    // Validate all items have quantity
    for (var item in _receivingItems) {
      if (item.quantity <= 0) {
        _showErrorSnackBar('Please enter quantity for all items');
        return;
      }
    }

    setState(() {
      _isSaving = true;
    });

    try {
      // Create movements for each item
      for (var item in _receivingItems) {
        final movement = StockMovement(
          stockItemId: item.stockItem.id!,
          stockItemName: item.stockItem.name,
          movementType: 'RECEIVED',
          quantity: item.quantity.toDouble(),
          supplierName: _selectedSupplier!.name,
          notes: _notesController.text.trim().isEmpty
              ? null
              : _notesController.text.trim(),
        );

        await _dbHelper.insertStockMovement(movement);
      }

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error saving: $e');
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Receive Stock'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : Form(
              key: _formKey,
              child: Column(
                children: [
                  _buildHeaderSection(),
                  Expanded(
                    child: _receivingItems.isEmpty
                        ? _buildEmptyState()
                        : ListView.builder(
                            padding: const EdgeInsets.all(16),
                            itemCount: _receivingItems.length,
                            itemBuilder: (context, index) {
                              return _buildReceivingItemCard(index);
                            },
                          ),
                  ),
                  _buildBottomBar(),
                ],
              ),
            ),
      floatingActionButton: FloatingActionButton(
        onPressed: _showAddItemDialog,
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build header section
  Widget _buildHeaderSection() {
    return Container(
      padding: const EdgeInsets.all(16),
      color: Colors.white,
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // Supplier Selection
          DropdownButtonFormField<Supplier>(
            value: _selectedSupplier,
            decoration: const InputDecoration(
              labelText: 'Select Supplier',
              prefixIcon: Icon(Icons.business),
            ),
            items: _suppliers
                .map((supplier) => DropdownMenuItem(
                      value: supplier,
                      child: Text(supplier.name),
                    ))
                .toList(),
            onChanged: (value) {
              setState(() {
                _selectedSupplier = value;
              });
            },
            validator: (value) {
              if (value == null) return 'Please select a supplier';
              return null;
            },
          ),
          const SizedBox(height: 16),

          // Notes
          TextFormField(
            controller: _notesController,
            decoration: const InputDecoration(
              labelText: 'Notes (Optional)',
              hintText: 'e.g., Invoice number, delivery details',
              prefixIcon: Icon(Icons.note),
            ),
            maxLines: 2,
            textCapitalization: TextCapitalization.sentences,
          ),
          const SizedBox(height: 16),

          // Summary
          Container(
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(
              color: AppTheme.successGreen.withOpacity(0.1),
              borderRadius: BorderRadius.circular(8),
            ),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text(
                  'Items: $_totalItems',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
                Text(
                  'Total Qty: $_totalQuantity',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                        color: AppTheme.successGreen,
                      ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  /// Build receiving item card
  Widget _buildReceivingItemCard(int index) {
    final item = _receivingItems[index];

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Row(
              children: [
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        item.stockItem.name,
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        'Current: ${item.stockItem.quantityOnHand} ${item.stockItem.unit}',
                        style: Theme.of(context).textTheme.bodySmall?.copyWith(
                              color: AppTheme.darkBrown.withOpacity(0.6),
                            ),
                      ),
                    ],
                  ),
                ),
                IconButton(
                  icon: const Icon(Icons.delete, color: AppTheme.errorRed),
                  onPressed: () => _removeItem(index),
                ),
              ],
            ),
            const SizedBox(height: 12),

            // Quantity Input
            Row(
              children: [
                IconButton(
                  icon: const Icon(Icons.remove_circle_outline),
                  onPressed: () {
                    if (item.quantity > 0) {
                      setState(() {
                        item.quantity--;
                      });
                    }
                  },
                ),
                Expanded(
                  child: Container(
                    padding: const EdgeInsets.symmetric(vertical: 12),
                    decoration: BoxDecoration(
                      color: AppTheme.lightCream,
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: Text(
                      '${item.quantity} ${item.stockItem.unit}',
                      textAlign: TextAlign.center,
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            fontWeight: FontWeight.bold,
                            color: AppTheme.successGreen,
                          ),
                    ),
                  ),
                ),
                IconButton(
                  icon: const Icon(Icons.add_circle_outline),
                  onPressed: () {
                    setState(() {
                      item.quantity++;
                    });
                  },
                ),
              ],
            ),

            // New quantity preview
            if (item.quantity > 0) ...[
              const SizedBox(height: 12),
              Container(
                padding: const EdgeInsets.all(8),
                decoration: BoxDecoration(
                  color: AppTheme.successGreen.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(6),
                ),
                child: Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text(
                      'New Stock:',
                      style: Theme.of(context).textTheme.bodySmall,
                    ),
                    Text(
                      '${item.stockItem.quantityOnHand + item.quantity} ${item.stockItem.unit}',
                      style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                            color: AppTheme.successGreen,
                            fontWeight: FontWeight.w600,
                          ),
                    ),
                  ],
                ),
              ),
            ],
          ],
        ),
      ),
    );
  }

  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.inbox,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No items added',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Tap + to add stock items',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  Widget _buildBottomBar() {
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.white,
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 4,
            offset: const Offset(0, -2),
          ),
        ],
      ),
      child: SafeArea(
        child: SizedBox(
          width: double.infinity,
          child: ElevatedButton(
            onPressed: _isSaving ? null : _saveReceiving,
            style: ElevatedButton.styleFrom(
              padding: const EdgeInsets.symmetric(vertical: 16),
              backgroundColor: AppTheme.successGreen,
            ),
            child: _isSaving
                ? const SizedBox(
                    height: 20,
                    width: 20,
                    child: CircularProgressIndicator(
                      strokeWidth: 2,
                      valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                    ),
                  )
                : Text(
                    'Receive ${_receivingItems.length} Items',
                    style: const TextStyle(fontSize: 18),
                  ),
          ),
        ),
      ),
    );
  }

  Future<void> _showAddItemDialog() async {
    StockItem? selectedItem;

    await showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Add Stock Item'),
        content: SizedBox(
          width: double.maxFinite,
          child: StatefulBuilder(
            builder: (context, setState) {
              return Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  DropdownButtonFormField<StockItem>(
                    value: selectedItem,
                    decoration: const InputDecoration(
                      labelText: 'Select Item',
                      prefixIcon: Icon(Icons.inventory_2),
                    ),
                    items: _allStockItems
                        .where((item) => !_receivingItems
                            .any((ri) => ri.stockItem.id == item.id))
                        .map((item) => DropdownMenuItem(
                              value: item,
                              child: Text('${item.name} (${item.unit})'),
                            ))
                        .toList(),
                    onChanged: (value) {
                      setState(() {
                        selectedItem = value;
                      });
                    },
                  ),
                ],
              );
            },
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () {
              if (selectedItem != null) {
                _addItem(selectedItem!);
                Navigator.pop(context);
              }
            },
            child: const Text('Add'),
          ),
        ],
      ),
    );
  }

  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

class ReceivingItem {
  final StockItem stockItem;
  int quantity;

  ReceivingItem({
    required this.stockItem,
    this.quantity = 0,
  });
}

END OF CODE.

16. notification_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:intl/intl.dart';

/// Notifications Screen
/// 
/// Displays system notifications like low stock alerts,
/// pending tasks, upcoming expiry dates, etc.

class NotificationsScreen extends StatefulWidget {
  const NotificationsScreen({super.key});

  @override
  State<NotificationsScreen> createState() => _NotificationsScreenState();
}

class _NotificationsScreenState extends State<NotificationsScreen> {
  final DateFormat _dateFormat = DateFormat('dd MMM yyyy, HH:mm');

  // Mock notifications (you can replace with real data from database later)
  final List<NotificationItem> _notifications = [
    NotificationItem(
      id: 1,
      type: 'info',
      title: 'Welcome to A-One Bakeries!',
      message: 'Your business management app is ready to use.',
      timestamp: DateTime.now().subtract(const Duration(hours: 2)),
      isRead: false,
    ),
    NotificationItem(
      id: 2,
      type: 'success',
      title: 'Order Completed',
      message: 'Driver John completed delivery for 5 trollies of bread.',
      timestamp: DateTime.now().subtract(const Duration(hours: 5)),
      isRead: false,
    ),
    NotificationItem(
      id: 3,
      type: 'warning',
      title: 'Low Stock Alert',
      message: 'Flour stock is running low. Consider restocking soon.',
      timestamp: DateTime.now().subtract(const Duration(days: 1)),
      isRead: false,
    ),
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Notifications'),
        actions: [
          // Mark all as read button
          if (_notifications.any((n) => !n.isRead))
            TextButton(
              onPressed: _markAllAsRead,
              child: const Text(
                'Mark all read',
                style: TextStyle(color: Colors.white),
              ),
            ),
        ],
      ),
      body: _notifications.isEmpty
          ? _buildEmptyState()
          : ListView.builder(
              padding: const EdgeInsets.all(16),
              itemCount: _notifications.length,
              itemBuilder: (context, index) {
                return _buildNotificationCard(_notifications[index]);
              },
            ),
    );
  }

  /// Build notification card
  Widget _buildNotificationCard(NotificationItem notification) {
    IconData icon;
    Color color;

    switch (notification.type) {
      case 'success':
        icon = Icons.check_circle;
        color = AppTheme.successGreen;
        break;
      case 'warning':
        icon = Icons.warning;
        color = AppTheme.secondaryOrange;
        break;
      case 'error':
        icon = Icons.error;
        color = AppTheme.errorRed;
        break;
      default:
        icon = Icons.info;
        color = Colors.blue;
    }

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      color: notification.isRead ? null : AppTheme.lightCream,
      child: ListTile(
        leading: CircleAvatar(
          backgroundColor: color.withOpacity(0.1),
          child: Icon(icon, color: color),
        ),
        title: Text(
          notification.title,
          style: TextStyle(
            fontWeight: notification.isRead ? FontWeight.normal : FontWeight.bold,
          ),
        ),
        subtitle: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            const SizedBox(height: 4),
            Text(notification.message),
            const SizedBox(height: 8),
            Text(
              _dateFormat.format(notification.timestamp),
              style: Theme.of(context).textTheme.bodySmall?.copyWith(
                    color: AppTheme.darkBrown.withOpacity(0.5),
                  ),
            ),
          ],
        ),
        isThreeLine: true,
        trailing: !notification.isRead
            ? Container(
                width: 10,
                height: 10,
                decoration: const BoxDecoration(
                  color: AppTheme.primaryBrown,
                  shape: BoxShape.circle,
                ),
              )
            : null,
        onTap: () => _markAsRead(notification),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.notifications_none,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No notifications',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'You\'re all caught up!',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Mark notification as read
  void _markAsRead(NotificationItem notification) {
    setState(() {
      notification.isRead = true;
    });
  }

  /// Mark all notifications as read
  void _markAllAsRead() {
    setState(() {
      for (var notification in _notifications) {
        notification.isRead = true;
      }
    });
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(
        content: Text('All notifications marked as read'),
        backgroundColor: AppTheme.successGreen,
        duration: Duration(seconds: 2),
      ),
    );
  }
}

/// Notification Item Model
class NotificationItem {
  final int id;
  final String type; // 'info', 'success', 'warning', 'error'
  final String title;
  final String message;
  final DateTime timestamp;
  bool isRead;

  NotificationItem({
    required this.id,
    required this.type,
    required this.title,
    required this.message,
    required this.timestamp,
    this.isRead = false,
  });
}

END OF CODE.

17. order_details_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/order_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:intl/intl.dart';

/// Order Details Screen
/// 
/// Shows complete order information including all items.

class OrderDetailsScreen extends StatefulWidget {
  final Order order;

  const OrderDetailsScreen({
    super.key,
    required this.order,
  });

  @override
  State<OrderDetailsScreen> createState() => _OrderDetailsScreenState();
}

class _OrderDetailsScreenState extends State<OrderDetailsScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<OrderItem> _orderItems = [];
  bool _isLoading = true;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy HH:mm');

  @override
  void initState() {
    super.initState();
    _loadOrderItems();
  }

  /// Load order items
  Future<void> _loadOrderItems() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final items = await _dbHelper.getOrderItems(widget.order.id!);
      setState(() {
        _orderItems = items;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Order Details'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : SingleChildScrollView(
              child: Column(
                children: [
                  // Order Header
                  _buildOrderHeader(),

                  // Order Items Section
                  _buildOrderItemsSection(),

                  // Total Section
                  _buildTotalSection(),

                  const SizedBox(height: 16),
                ],
              ),
            ),
    );
  }

  /// Build order header
  Widget _buildOrderHeader() {
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        gradient: LinearGradient(
          colors: [
            AppTheme.primaryBrown,
            AppTheme.primaryBrown.withOpacity(0.8),
          ],
        ),
        borderRadius: BorderRadius.circular(16),
        boxShadow: [
          BoxShadow(
            color: AppTheme.primaryBrown.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // Order For Label
          Row(
            children: [
              Icon(
                widget.order.isDriverOrder ? Icons.person : Icons.local_shipping,
                color: Colors.white,
                size: 20,
              ),
              const SizedBox(width: 8),
              Text(
                widget.order.isDriverOrder ? 'Driver:' : 'Vehicle:',
                style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                      color: Colors.white.withOpacity(0.9),
                    ),
              ),
            ],
          ),
          const SizedBox(height: 4),
          Text(
            widget.order.displayName,
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
          const SizedBox(height: 16),

          // Date
          Row(
            children: [
              const Icon(
                Icons.calendar_today,
                color: Colors.white,
                size: 16,
              ),
              const SizedBox(width: 8),
              Text(
                _dateFormat.format(widget.order.createdAt),
                style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                      color: Colors.white.withOpacity(0.9),
                    ),
              ),
            ],
          ),
        ],
      ),
    );
  }

  /// Build order items section
  Widget _buildOrderItemsSection() {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            'Order Items',
            style: Theme.of(context).textTheme.titleMedium?.copyWith(
                  fontWeight: FontWeight.bold,
                ),
          ),
          const SizedBox(height: 12),

          // Order items list
          ListView.builder(
            shrinkWrap: true,
            physics: const NeverScrollableScrollPhysics(),
            itemCount: _orderItems.length,
            itemBuilder: (context, index) {
              return _buildOrderItemCard(_orderItems[index], index);
            },
          ),
        ],
      ),
    );
  }

  /// Build order item card
  Widget _buildOrderItemCard(OrderItem item, int index) {
    final isBiscuits = item.itemType == OrderItemTypes.bucketBiscuits;
    
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Item header
            Row(
              children: [
                Container(
                  padding: const EdgeInsets.all(8),
                  decoration: BoxDecoration(
                    color: AppTheme.primaryBrown.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                  ),
                  child: Text(
                    '${index + 1}',
                    style: Theme.of(context).textTheme.titleMedium?.copyWith(
                          color: AppTheme.primaryBrown,
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                ),
                const SizedBox(width: 12),
                Expanded(
                  child: Text(
                    item.itemType,
                    style: Theme.of(context).textTheme.titleMedium?.copyWith(
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                ),
              ],
            ),
            const Divider(height: 24),

            // Item details
            _buildDetailRow(
              isBiscuits ? 'Quantity' : 'Trollies',
              item.trolliesOrQty.toString(),
            ),
            const SizedBox(height: 8),
            _buildDetailRow(
              'Total Quantity',
              item.quantity.toString(),
              isHighlight: true,
            ),
          ],
        ),
      ),
    );
  }

  /// Build detail row
  Widget _buildDetailRow(String label, String value, {bool isHighlight = false}) {
    return Row(
      mainAxisAlignment: MainAxisAlignment.spaceBetween,
      children: [
        Text(
          label,
          style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                color: AppTheme.darkBrown.withOpacity(0.7),
              ),
        ),
        Text(
          value,
          style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                fontWeight: isHighlight ? FontWeight.bold : FontWeight.w600,
                color: isHighlight ? AppTheme.primaryBrown : null,
              ),
        ),
      ],
    );
  }

  /// Build total section
  Widget _buildTotalSection() {
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        color: AppTheme.primaryBrown,
        borderRadius: BorderRadius.circular(12),
        boxShadow: [
          BoxShadow(
            color: AppTheme.primaryBrown.withOpacity(0.3),
            blurRadius: 8,
            offset: const Offset(0, 4),
          ),
        ],
      ),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                'Order Total',
                style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                      color: Colors.white.withOpacity(0.9),
                    ),
              ),
              const SizedBox(height: 4),
              Text(
                '${_orderItems.length} ${_orderItems.length == 1 ? 'item' : 'items'}',
                style: Theme.of(context).textTheme.bodySmall?.copyWith(
                      color: Colors.white.withOpacity(0.7),
                    ),
              ),
            ],
          ),
          Text(
            widget.order.totalQuantity.toString(),
            style: Theme.of(context).textTheme.displaySmall?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
        ],
      ),
    );
  }
}

END OF CODE.

18. orders_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/order_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/screens/create_order_screen.dart';
import 'package:a_one_bakeries_app/screens/order_details_screen.dart';
import 'package:intl/intl.dart';

/// Orders Screen
/// 
/// Main screen for order management.
/// Displays all orders (no status filtering).

class OrdersScreen extends StatefulWidget {
  const OrdersScreen({super.key});

  @override
  State<OrdersScreen> createState() => _OrdersScreenState();
}

class _OrdersScreenState extends State<OrdersScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<Order> _orders = [];
  bool _isLoading = true;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy HH:mm');

  @override
  void initState() {
    super.initState();
    _loadOrders();
  }

  /// Load all orders from database
  Future<void> _loadOrders() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final orders = await _dbHelper.getAllOrders();
      setState(() {
        _orders = orders;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading orders: $e');
      }
    }
  }

  /// Navigate to create order screen
  void _navigateToCreateOrder() {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const CreateOrderScreen(),
      ),
    ).then((_) => _loadOrders());
  }

  /// Navigate to order details
  void _navigateToOrderDetails(Order order) async {
    await Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => OrderDetailsScreen(order: order),
      ),
    );
    _loadOrders();
  }

  /// Navigate to edit order
  Future<void> _editOrder(Order order) async {
    // Load order items first
    final items = await _dbHelper.getOrderItems(order.id!);
    
    if (mounted) {
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) => CreateOrderScreen(
            existingOrder: order,
            existingItems: items,
          ),
        ),
      ).then((_) => _loadOrders());
    }
  }

  /// Delete order
  Future<void> _deleteOrder(Order order) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Order'),
        content: Text('Are you sure you want to delete this order for ${order.displayName}?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteOrder(order.id!);
        _loadOrders();
        if (mounted) {
          _showSuccessSnackBar('Order deleted successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting order: $e');
        }
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Orders'),
      ),
      body: Column(
        children: [
          // Order Count
          Padding(
            padding: const EdgeInsets.all(16),
            child: Row(
              children: [
                Text(
                  '${_orders.length} ${_orders.length == 1 ? 'Order' : 'Orders'}',
                  style: Theme.of(context).textTheme.titleMedium?.copyWith(
                        fontWeight: FontWeight.w600,
                      ),
                ),
              ],
            ),
          ),

          // Orders List
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _orders.isEmpty
                    ? _buildEmptyState()
                    : RefreshIndicator(
                        onRefresh: _loadOrders,
                        color: AppTheme.primaryBrown,
                        child: ListView.builder(
                          padding: const EdgeInsets.symmetric(horizontal: 16),
                          itemCount: _orders.length,
                          itemBuilder: (context, index) {
                            return _buildOrderCard(_orders[index]);
                          },
                        ),
                      ),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _navigateToCreateOrder,
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build order card
  Widget _buildOrderCard(Order order) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: InkWell(
        onTap: () => _navigateToOrderDetails(order),
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // Header Row
              Row(
                children: [
                  // Order Icon
                  Container(
                    padding: const EdgeInsets.all(8),
                    decoration: BoxDecoration(
                      color: AppTheme.primaryBrown.withOpacity(0.1),
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: const Icon(
                      Icons.shopping_cart,
                      color: AppTheme.primaryBrown,
                      size: 24,
                    ),
                  ),
                  const SizedBox(width: 12),

                  // Order Info
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(
                          order.displayName,
                          style: Theme.of(context).textTheme.titleMedium?.copyWith(
                                fontWeight: FontWeight.bold,
                              ),
                        ),
                        const SizedBox(height: 4),
                        Text(
                          _dateFormat.format(order.createdAt),
                          style: Theme.of(context).textTheme.bodySmall?.copyWith(
                                color: AppTheme.darkBrown.withOpacity(0.6),
                              ),
                        ),
                      ],
                    ),
                  ),

                  // Actions Menu
                  PopupMenuButton<String>(
                    onSelected: (value) {
                      if (value == 'edit') {
                        _editOrder(order);
                      } else if (value == 'delete') {
                        _deleteOrder(order);
                      }
                    },
                    itemBuilder: (context) => [
                      const PopupMenuItem(
                        value: 'edit',
                        child: Row(
                          children: [
                            Icon(Icons.edit, size: 20),
                            SizedBox(width: 8),
                            Text('Edit'),
                          ],
                        ),
                      ),
                      const PopupMenuItem(
                        value: 'delete',
                        child: Row(
                          children: [
                            Icon(Icons.delete, size: 20, color: AppTheme.errorRed),
                            SizedBox(width: 8),
                            Text('Delete', style: TextStyle(color: AppTheme.errorRed)),
                          ],
                        ),
                      ),
                    ],
                  ),
                ],
              ),

              const Divider(height: 24),

              // Total Quantity
              Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  Text(
                    'Total Quantity:',
                    style: Theme.of(context).textTheme.bodyMedium,
                  ),
                  Text(
                    order.totalQuantity.toString(),
                    style: Theme.of(context).textTheme.titleLarge?.copyWith(
                          color: AppTheme.primaryBrown,
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.shopping_cart_outlined,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No orders yet',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Tap + to create your first order',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Show success snackbar
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

19. stock_movement_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:intl/intl.dart';

/// Stock Movement Screen
/// 
/// Displays history of all stock movements (received and allocated).
/// Supports filtering by date range and sorting.

class StockMovementScreen extends StatefulWidget {
  const StockMovementScreen({super.key});

  @override
  State<StockMovementScreen> createState() => _StockMovementScreenState();
}

class _StockMovementScreenState extends State<StockMovementScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<StockMovement> _movements = [];
  List<StockMovement> _filteredMovements = [];
  bool _isLoading = true;
  bool _sortNewestFirst = true;
  String _filterType = 'ALL'; // ALL, RECEIVED, ALLOCATED

  final DateFormat _dateFormat = DateFormat('MMM dd, yyyy HH:mm');

  @override
  void initState() {
    super.initState();
    _loadMovements();
  }

  /// Load all stock movements
  Future<void> _loadMovements() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final movements = await _dbHelper.getAllStockMovements();
      setState(() {
        _movements = movements;
        _applyFilters();
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading movements: $e');
      }
    }
  }

  /// Apply filters and sorting
  void _applyFilters() {
    List<StockMovement> filtered = _movements;

    // Filter by type
    if (_filterType != 'ALL') {
      filtered = filtered.where((m) => m.movementType == _filterType).toList();
    }

    // Sort
    if (_sortNewestFirst) {
      filtered.sort((a, b) => b.createdAt.compareTo(a.createdAt));
    } else {
      filtered.sort((a, b) => a.createdAt.compareTo(b.createdAt));
    }

    setState(() {
      _filteredMovements = filtered;
    });
  }

  /// Toggle sort order
  void _toggleSortOrder() {
    setState(() {
      _sortNewestFirst = !_sortNewestFirst;
      _applyFilters();
    });
  }

  /// Change filter type
  void _changeFilterType(String type) {
    setState(() {
      _filterType = type;
      _applyFilters();
    });
  }

  /// Show date range picker (for custom filter - Phase 3 advanced)
  Future<void> _showDateRangePicker() async {
    final DateTimeRange? picked = await showDateRangePicker(
      context: context,
      firstDate: DateTime(2020),
      lastDate: DateTime.now(),
      builder: (context, child) {
        return Theme(
          data: Theme.of(context).copyWith(
            colorScheme: const ColorScheme.light(
              primary: AppTheme.primaryBrown,
              onPrimary: Colors.white,
              surface: AppTheme.lightCream,
              onSurface: AppTheme.darkBrown,
            ),
          ),
          child: child!,
        );
      },
    );

    if (picked != null) {
      try {
        final movements = await _dbHelper.getStockMovementsByDateRange(
          picked.start,
          picked.end.add(const Duration(days: 1)), // Include end date
        );
        setState(() {
          _movements = movements;
          _applyFilters();
        });
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error filtering by date: $e');
        }
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Stock Movements'),
        actions: [
          // Sort Button
          IconButton(
            icon: Icon(_sortNewestFirst ? Icons.arrow_downward : Icons.arrow_upward),
            onPressed: _toggleSortOrder,
            tooltip: _sortNewestFirst ? 'Newest First' : 'Oldest First',
          ),
          // Date Filter Button
          IconButton(
            icon: const Icon(Icons.date_range),
            onPressed: _showDateRangePicker,
            tooltip: 'Filter by Date',
          ),
        ],
      ),
      body: Column(
        children: [
          // Filter Chips
          _buildFilterChips(),

          // Movements List
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _filteredMovements.isEmpty
                    ? _buildEmptyState()
                    : RefreshIndicator(
                        onRefresh: _loadMovements,
                        color: AppTheme.primaryBrown,
                        child: ListView.builder(
                          padding: const EdgeInsets.all(16),
                          itemCount: _filteredMovements.length,
                          itemBuilder: (context, index) {
                            return _buildMovementCard(_filteredMovements[index]);
                          },
                        ),
                      ),
          ),
        ],
      ),
    );
  }

  /// Build filter chips
  Widget _buildFilterChips() {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
      color: Colors.white,
      child: Row(
        children: [
          Text(
            'Filter: ',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  fontWeight: FontWeight.w600,
                ),
          ),
          const SizedBox(width: 8),
          Expanded(
            child: SingleChildScrollView(
              scrollDirection: Axis.horizontal,
              child: Row(
                children: [
                  _buildFilterChip('ALL', 'All'),
                  const SizedBox(width: 8),
                  _buildFilterChip('RECEIVED', 'Received'),
                  const SizedBox(width: 8),
                  _buildFilterChip('ALLOCATED', 'Allocated'),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }

  /// Build single filter chip
  Widget _buildFilterChip(String value, String label) {
    final isSelected = _filterType == value;
    return FilterChip(
      label: Text(label),
      selected: isSelected,
      onSelected: (selected) {
        if (selected) _changeFilterType(value);
      },
      selectedColor: AppTheme.primaryBrown,
      checkmarkColor: Colors.white,
      labelStyle: TextStyle(
        color: isSelected ? Colors.white : AppTheme.darkBrown,
        fontWeight: isSelected ? FontWeight.w600 : FontWeight.w400,
      ),
    );
  }

  /// Build movement card
  Widget _buildMovementCard(StockMovement movement) {
    final isReceived = movement.movementType == 'RECEIVED';
    final color = isReceived ? AppTheme.successGreen : AppTheme.secondaryOrange;
    final icon = isReceived ? Icons.add_circle : Icons.remove_circle;

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Header Row
            Row(
              children: [
                // Movement Icon
                Container(
                  padding: const EdgeInsets.all(8),
                  decoration: BoxDecoration(
                    color: color.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                  ),
                  child: Icon(
                    icon,
                    color: color,
                    size: 24,
                  ),
                ),
                const SizedBox(width: 12),

                // Stock Item Name
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        movement.stockItemName,
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                      Text(
                        movement.movementType,
                        style: Theme.of(context).textTheme.bodySmall?.copyWith(
                              color: color,
                              fontWeight: FontWeight.w600,
                            ),
                      ),
                    ],
                  ),
                ),

                // Quantity Badge
                Container(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 12,
                    vertical: 6,
                  ),
                  decoration: BoxDecoration(
                    color: color,
                    borderRadius: BorderRadius.circular(20),
                  ),
                  child: Text(
                    '${isReceived ? '+' : '-'}${movement.quantity.toStringAsFixed(2)}',
                    style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                          color: Colors.white,
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                ),
              ],
            ),

            const SizedBox(height: 12),

            // Date
            Row(
              children: [
                Icon(
                  Icons.access_time,
                  size: 16,
                  color: AppTheme.darkBrown.withOpacity(0.6),
                ),
                const SizedBox(width: 4),
                Text(
                  _dateFormat.format(movement.createdAt),
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.6),
                      ),
                ),
              ],
            ),

            // Employee Name (for allocations)
            if (movement.employeeName != null) ...[
              const SizedBox(height: 8),
              Row(
                children: [
                  Icon(
                    Icons.person,
                    size: 16,
                    color: AppTheme.darkBrown.withOpacity(0.6),
                  ),
                  const SizedBox(width: 4),
                  Text(
                    movement.employeeName!,
                    style: Theme.of(context).textTheme.bodySmall?.copyWith(
                          color: AppTheme.darkBrown.withOpacity(0.8),
                          fontWeight: FontWeight.w500,
                        ),
                  ),
                ],
              ),
            ],

            // Notes
            if (movement.notes != null && movement.notes!.isNotEmpty) ...[
              const SizedBox(height: 8),
              Container(
                padding: const EdgeInsets.all(8),
                decoration: BoxDecoration(
                  color: AppTheme.creamBackground,
                  borderRadius: BorderRadius.circular(6),
                ),
                child: Row(
                  children: [
                    Icon(
                      Icons.note,
                      size: 16,
                      color: AppTheme.darkBrown.withOpacity(0.6),
                    ),
                    const SizedBox(width: 4),
                    Expanded(
                      child: Text(
                        movement.notes!,
                        style: Theme.of(context).textTheme.bodySmall?.copyWith(
                              fontStyle: FontStyle.italic,
                            ),
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ],
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.history,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No movements yet',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Stock movements will appear here',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

20. stock_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/screens/stock_movement_screen.dart';
import 'package:a_one_bakeries_app/screens/multi_item_allocation_screen.dart';
import 'package:a_one_bakeries_app/screens/multi_item_receiving_screen.dart';
import 'package:a_one_bakeries_app/screens/supplier_screen.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_stock_dialog.dart';

/// Stock Screen
/// 
/// Main screen for stock management.
/// Enhanced with expandable FAB and multi-item operations.

class StockScreen extends StatefulWidget {
  const StockScreen({super.key});

  @override
  State<StockScreen> createState() => _StockScreenState();
}

class _StockScreenState extends State<StockScreen> with SingleTickerProviderStateMixin {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<StockItem> _stockItems = [];
  List<StockItem> _filteredStockItems = [];
  bool _isLoading = true;
  final TextEditingController _searchController = TextEditingController();

  // FAB expansion state
  bool _isFabExpanded = false;
  late AnimationController _animationController;
  late Animation<double> _expandAnimation;

  @override
  void initState() {
    super.initState();
    _loadStockItems();
    
    // Initialize animation controller
    _animationController = AnimationController(
      vsync: this,
      duration: const Duration(milliseconds: 300),
    );
    _expandAnimation = CurvedAnimation(
      parent: _animationController,
      curve: Curves.easeInOut,
    );
  }

  @override
  void dispose() {
    _searchController.dispose();
    _animationController.dispose();
    super.dispose();
  }

  /// Toggle FAB expansion
  void _toggleFab() {
    setState(() {
      _isFabExpanded = !_isFabExpanded;
      if (_isFabExpanded) {
        _animationController.forward();
      } else {
        _animationController.reverse();
      }
    });
  }

  /// Load all stock items
  Future<void> _loadStockItems() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final items = await _dbHelper.getAllStockItems();
      setState(() {
        _stockItems = items;
        _filteredStockItems = items;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading stock items: $e');
      }
    }
  }

  /// Filter stock items
  void _filterStockItems(String query) {
    setState(() {
      if (query.isEmpty) {
        _filteredStockItems = _stockItems;
      } else {
        _filteredStockItems = _stockItems
            .where((item) =>
                item.name.toLowerCase().contains(query.toLowerCase()))
            .toList();
      }
    });
  }

  /// Show add stock dialog
  Future<void> _showAddStockDialog() async {
    _toggleFab(); // Close FAB first
    
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditStockDialog(),
    );

    if (result == true) {
      _loadStockItems();
      if (mounted) {
        _showSuccessSnackBar('Stock item added successfully!');
      }
    }
  }

  /// Show edit stock dialog
  Future<void> _showEditStockDialog(StockItem item) async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AddEditStockDialog(stockItem: item),
    );

    if (result == true) {
      _loadStockItems();
      if (mounted) {
        _showSuccessSnackBar('Stock item updated successfully!');
      }
    }
  }

  /// Delete stock item
  Future<void> _deleteStockItem(StockItem item) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Stock Item'),
        content: Text('Are you sure you want to delete "${item.name}"?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteStockItem(item.id!);
        _loadStockItems();
        if (mounted) {
          _showSuccessSnackBar('Stock item deleted successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting stock item: $e');
        }
      }
    }
  }

  /// Navigate to multi-item allocation
  void _navigateToMultiItemAllocation() {
    _toggleFab(); // Close FAB first
    
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const MultiItemAllocationScreen(),
      ),
    ).then((result) {
      if (result == true) {
        _loadStockItems();
        _showSuccessSnackBar('Stock allocated successfully!');
      }
    });
  }

  /// Navigate to multi-item receiving
  void _navigateToMultiItemReceiving() {
    _toggleFab(); // Close FAB first
    
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const MultiItemReceivingScreen(),
      ),
    ).then((result) {
      if (result == true) {
        _loadStockItems();
        _showSuccessSnackBar('Stock received successfully!');
      }
    });
  }

  /// Navigate to stock movements
  void _navigateToStockMovements() {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const StockMovementScreen(),
      ),
    );
  }

  /// Navigate to suppliers
  void _navigateToSuppliers() {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => const SupplierScreen(),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Stock Management'),
        actions: [
          IconButton(
            icon: const Icon(Icons.business),
            onPressed: _navigateToSuppliers,
            tooltip: 'Suppliers',
          ),
          IconButton(
            icon: const Icon(Icons.history),
            onPressed: _navigateToStockMovements,
            tooltip: 'Stock Movements',
          ),
        ],
      ),
      body: Column(
        children: [
          // Search Bar
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: TextField(
              controller: _searchController,
              onChanged: _filterStockItems,
              decoration: InputDecoration(
                hintText: 'Search stock items...',
                prefixIcon: const Icon(Icons.search),
                suffixIcon: _searchController.text.isNotEmpty
                    ? IconButton(
                        icon: const Icon(Icons.clear),
                        onPressed: () {
                          _searchController.clear();
                          _filterStockItems('');
                        },
                      )
                    : null,
              ),
            ),
          ),

          // Stock Items List
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _filteredStockItems.isEmpty
                    ? _buildEmptyState()
                    : RefreshIndicator(
                        onRefresh: _loadStockItems,
                        color: AppTheme.primaryBrown,
                        child: ListView.builder(
                          padding: const EdgeInsets.symmetric(horizontal: 16),
                          itemCount: _filteredStockItems.length,
                          itemBuilder: (context, index) {
                            return _buildStockItemCard(
                                _filteredStockItems[index]);
                          },
                        ),
                      ),
          ),
        ],
      ),
      floatingActionButton: _buildExpandableFab(),
    );
  }

  /// Build stock item card (without receive/allocate buttons)
  Widget _buildStockItemCard(StockItem item) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Row(
          children: [
            // Item Icon
            Container(
              padding: const EdgeInsets.all(8),
              decoration: BoxDecoration(
                color: AppTheme.primaryBrown.withOpacity(0.1),
                borderRadius: BorderRadius.circular(8),
              ),
              child: const Icon(
                Icons.inventory_2,
                color: AppTheme.primaryBrown,
              ),
            ),
            const SizedBox(width: 12),

            // Item Info
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    item.name,
                    style: Theme.of(context).textTheme.headlineSmall,
                  ),
                  const SizedBox(height: 4),
                  Text(
                    '${item.quantityOnHand} ${item.unit}', // No decimals!
                    style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                          color: AppTheme.primaryBrown,
                          fontWeight: FontWeight.w600,
                        ),
                  ),
                ],
              ),
            ),

            // Edit and Delete Menu
            PopupMenuButton<String>(
              onSelected: (value) {
                if (value == 'edit') {
                  _showEditStockDialog(item);
                } else if (value == 'delete') {
                  _deleteStockItem(item);
                }
              },
              itemBuilder: (context) => [
                const PopupMenuItem(
                  value: 'edit',
                  child: Row(
                    children: [
                      Icon(Icons.edit, size: 20),
                      SizedBox(width: 8),
                      Text('Edit'),
                    ],
                  ),
                ),
                const PopupMenuItem(
                  value: 'delete',
                  child: Row(
                    children: [
                      Icon(Icons.delete, size: 20, color: AppTheme.errorRed),
                      SizedBox(width: 8),
                      Text('Delete', style: TextStyle(color: AppTheme.errorRed)),
                    ],
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  /// Build expandable FAB with speed dial
  Widget _buildExpandableFab() {
    return Column(
      mainAxisSize: MainAxisSize.min,
      crossAxisAlignment: CrossAxisAlignment.end,
      children: [
        // Backdrop
        if (_isFabExpanded)
          GestureDetector(
            onTap: _toggleFab,
            child: Container(
              color: Colors.black54,
              width: double.infinity,
              height: double.infinity,
            ),
          ),

        // Speed dial options
        ScaleTransition(
          scale: _expandAnimation,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            crossAxisAlignment: CrossAxisAlignment.end,
            children: [
              _buildSpeedDialOption(
                label: 'Allocate Stock',
                icon: Icons.remove_circle_outline,
                color: AppTheme.secondaryOrange,
                onTap: _navigateToMultiItemAllocation,
              ),
              const SizedBox(height: 16),
              _buildSpeedDialOption(
                label: 'Receive Stock',
                icon: Icons.add_circle_outline,
                color: AppTheme.successGreen,
                onTap: _navigateToMultiItemReceiving,
              ),
              const SizedBox(height: 16),
              _buildSpeedDialOption(
                label: 'Add Stock Item',
                icon: Icons.add,
                color: AppTheme.primaryBrown,
                onTap: _showAddStockDialog,
              ),
              const SizedBox(height: 16),
            ],
          ),
        ),

        // Main FAB
        FloatingActionButton(
          onPressed: _toggleFab,
          child: AnimatedIcon(
            icon: AnimatedIcons.menu_close,
            progress: _expandAnimation,
          ),
        ),
      ],
    );
  }

  /// Build speed dial option
  Widget _buildSpeedDialOption({
    required String label,
    required IconData icon,
    required Color color,
    required VoidCallback onTap,
  }) {
    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        Container(
          padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 8),
          decoration: BoxDecoration(
            color: Colors.white,
            borderRadius: BorderRadius.circular(8),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withOpacity(0.2),
                blurRadius: 4,
                offset: const Offset(0, 2),
              ),
            ],
          ),
          child: Text(
            label,
            style: const TextStyle(
              fontWeight: FontWeight.w600,
            ),
          ),
        ),
        const SizedBox(width: 12),
        FloatingActionButton(
          heroTag: label,
          onPressed: onTap,
          backgroundColor: color,
          mini: true,
          child: Icon(icon),
        ),
      ],
    );
  }

  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.inventory_2_outlined,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            _searchController.text.isEmpty
                ? 'No stock items yet'
                : 'No items found',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            _searchController.text.isEmpty
                ? 'Tap + to add your first item'
                : 'Try a different search',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

21. supplier_details_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/supplier_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:intl/intl.dart';

/// Supplier Details Screen
/// 
/// Shows supplier information, invoices, payments, and balance.

class SupplierDetailsScreen extends StatefulWidget {
  final Supplier supplier;

  const SupplierDetailsScreen({
    super.key,
    required this.supplier,
  });

  @override
  State<SupplierDetailsScreen> createState() => _SupplierDetailsScreenState();
}

class _SupplierDetailsScreenState extends State<SupplierDetailsScreen>
    with SingleTickerProviderStateMixin {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  late TabController _tabController;

  double _totalInvoices = 0.0;
  double _totalPayments = 0.0;
  double _balance = 0.0;
  List<SupplierInvoice> _invoices = [];
  List<SupplierPayment> _payments = [];
  bool _isLoading = true;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy');
  final NumberFormat _currencyFormat = NumberFormat.currency(symbol: 'R ');

  @override
  void initState() {
    super.initState();
    _tabController = TabController(length: 3, vsync: this);
    _loadData();
  }

  @override
  void dispose() {
    _tabController.dispose();
    super.dispose();
  }

  Future<void> _loadData() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final invoices = await _dbHelper.getSupplierInvoices(widget.supplier.id!);
      final payments = await _dbHelper.getSupplierPayments(widget.supplier.id!);
      final balance = await _dbHelper.getSupplierBalance(widget.supplier.id!);
      final totalInv = await _dbHelper.getTotalInvoices(widget.supplier.id!);
      final totalPay = await _dbHelper.getTotalPayments(widget.supplier.id!);

      setState(() {
        _invoices = invoices;
        _payments = payments;
        _balance = balance;
        _totalInvoices = totalInv;
        _totalPayments = totalPay;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
    }
  }

  /// Show add invoice dialog
  Future<void> _showAddInvoiceDialog() async {
    final invoiceNumberController = TextEditingController();
    final amountController = TextEditingController();
    final notesController = TextEditingController();
    DateTime selectedDate = DateTime.now();
    DateTime? dueDate;
    final formKey = GlobalKey<FormState>();

    final result = await showDialog<bool>(
      context: context,
      builder: (context) => StatefulBuilder(
        builder: (context, setState) => AlertDialog(
          title: const Text('Add Invoice'),
          content: SingleChildScrollView(
            child: Form(
              key: formKey,
              child: Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  TextFormField(
                    controller: invoiceNumberController,
                    decoration: const InputDecoration(
                      labelText: 'Invoice Number',
                      prefixIcon: Icon(Icons.receipt),
                    ),
                    validator: (value) {
                      if (value == null || value.trim().isEmpty) {
                        return 'Please enter invoice number';
                      }
                      return null;
                    },
                  ),
                  const SizedBox(height: 16),
                  TextFormField(
                    controller: amountController,
                    decoration: const InputDecoration(
                      labelText: 'Amount',
                      prefixText: 'R ',
                      prefixIcon: Icon(Icons.money),
                    ),
                    keyboardType: const TextInputType.numberWithOptions(decimal: true),
                    validator: (value) {
                      if (value == null || value.trim().isEmpty) {
                        return 'Please enter amount';
                      }
                      final amount = double.tryParse(value.trim());
                      if (amount == null || amount <= 0) {
                        return 'Please enter valid amount';
                      }
                      return null;
                    },
                  ),
                  const SizedBox(height: 16),
                  ListTile(
                    title: const Text('Invoice Date'),
                    subtitle: Text(_dateFormat.format(selectedDate)),
                    leading: const Icon(Icons.calendar_today),
                    onTap: () async {
                      final date = await showDatePicker(
                        context: context,
                        initialDate: selectedDate,
                        firstDate: DateTime(2020),
                        lastDate: DateTime.now(),
                      );
                      if (date != null) {
                        setState(() {
                          selectedDate = date;
                        });
                      }
                    },
                  ),
                  ListTile(
                    title: const Text('Due Date (Optional)'),
                    subtitle: Text(dueDate != null
                        ? _dateFormat.format(dueDate!)
                        : 'Not set'),
                    leading: const Icon(Icons.event),
                    onTap: () async {
                      final date = await showDatePicker(
                        context: context,
                        initialDate: DateTime.now().add(const Duration(days: 30)),
                        firstDate: DateTime.now(),
                        lastDate: DateTime.now().add(const Duration(days: 365)),
                      );
                      if (date != null) {
                        setState(() {
                          dueDate = date;
                        });
                      }
                    },
                  ),
                  const SizedBox(height: 16),
                  TextFormField(
                    controller: notesController,
                    decoration: const InputDecoration(
                      labelText: 'Notes (Optional)',
                      prefixIcon: Icon(Icons.note),
                    ),
                    maxLines: 2,
                  ),
                ],
              ),
            ),
          ),
          actions: [
            TextButton(
              onPressed: () => Navigator.pop(context, false),
              child: const Text('Cancel'),
            ),
            ElevatedButton(
              onPressed: () async {
                if (formKey.currentState!.validate()) {
                  try {
                    final invoice = SupplierInvoice(
                      supplierId: widget.supplier.id!,
                      supplierName: widget.supplier.name,
                      invoiceNumber: invoiceNumberController.text.trim(),
                      amount: double.parse(amountController.text.trim()),
                      invoiceDate: selectedDate,
                      dueDate: dueDate,
                      notes: notesController.text.trim().isEmpty
                          ? null
                          : notesController.text.trim(),
                    );

                    await _dbHelper.insertSupplierInvoice(invoice);
                    Navigator.pop(context, true);
                  } catch (e) {
                    ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(
                        content: Text('Error: $e'),
                        backgroundColor: AppTheme.errorRed,
                      ),
                    );
                  }
                }
              },
              child: const Text('Save'),
            ),
          ],
        ),
      ),
    );

    if (result == true) {
      _loadData();
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(
            content: Text('Invoice added successfully!'),
            backgroundColor: AppTheme.successGreen,
          ),
        );
      }
    }
  }

  /// Show add payment dialog
  Future<void> _showAddPaymentDialog() async {
    final amountController = TextEditingController();
    final referenceController = TextEditingController();
    final notesController = TextEditingController();
    DateTime selectedDate = DateTime.now();
    String selectedMethod = PaymentMethods.cash;
    final formKey = GlobalKey<FormState>();

    final result = await showDialog<bool>(
      context: context,
      builder: (context) => StatefulBuilder(
        builder: (context, setState) => AlertDialog(
          title: const Text('Record Payment'),
          content: SingleChildScrollView(
            child: Form(
              key: formKey,
              child: Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  TextFormField(
                    controller: amountController,
                    decoration: const InputDecoration(
                      labelText: 'Amount',
                      prefixText: 'R ',
                      prefixIcon: Icon(Icons.money),
                    ),
                    keyboardType: const TextInputType.numberWithOptions(decimal: true),
                    autofocus: true,
                    validator: (value) {
                      if (value == null || value.trim().isEmpty) {
                        return 'Please enter amount';
                      }
                      final amount = double.tryParse(value.trim());
                      if (amount == null || amount <= 0) {
                        return 'Please enter valid amount';
                      }
                      return null;
                    },
                  ),
                  const SizedBox(height: 16),
                  DropdownButtonFormField<String>(
                    value: selectedMethod,
                    decoration: const InputDecoration(
                      labelText: 'Payment Method',
                      prefixIcon: Icon(Icons.payment),
                    ),
                    items: PaymentMethods.allMethods
                        .map((method) => DropdownMenuItem(
                              value: method,
                              child: Text(method),
                            ))
                        .toList(),
                    onChanged: (value) {
                      setState(() {
                        selectedMethod = value!;
                      });
                    },
                  ),
                  const SizedBox(height: 16),
                  TextFormField(
                    controller: referenceController,
                    decoration: const InputDecoration(
                      labelText: 'Reference (Optional)',
                      hintText: 'e.g., Cheque number, EFT reference',
                      prefixIcon: Icon(Icons.confirmation_number),
                    ),
                  ),
                  const SizedBox(height: 16),
                  ListTile(
                    title: const Text('Payment Date'),
                    subtitle: Text(_dateFormat.format(selectedDate)),
                    leading: const Icon(Icons.calendar_today),
                    onTap: () async {
                      final date = await showDatePicker(
                        context: context,
                        initialDate: selectedDate,
                        firstDate: DateTime(2020),
                        lastDate: DateTime.now(),
                      );
                      if (date != null) {
                        setState(() {
                          selectedDate = date;
                        });
                      }
                    },
                  ),
                  const SizedBox(height: 16),
                  TextFormField(
                    controller: notesController,
                    decoration: const InputDecoration(
                      labelText: 'Notes (Optional)',
                      prefixIcon: Icon(Icons.note),
                    ),
                    maxLines: 2,
                  ),
                ],
              ),
            ),
          ),
          actions: [
            TextButton(
              onPressed: () => Navigator.pop(context, false),
              child: const Text('Cancel'),
            ),
            ElevatedButton(
              onPressed: () async {
                if (formKey.currentState!.validate()) {
                  try {
                    final payment = SupplierPayment(
                      supplierId: widget.supplier.id!,
                      supplierName: widget.supplier.name,
                      amount: double.parse(amountController.text.trim()),
                      paymentMethod: selectedMethod,
                      reference: referenceController.text.trim().isEmpty
                          ? null
                          : referenceController.text.trim(),
                      notes: notesController.text.trim().isEmpty
                          ? null
                          : notesController.text.trim(),
                      paymentDate: selectedDate,
                    );

                    await _dbHelper.insertSupplierPayment(payment);
                    Navigator.pop(context, true);
                  } catch (e) {
                    ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(
                        content: Text('Error: $e'),
                        backgroundColor: AppTheme.errorRed,
                      ),
                    );
                  }
                }
              },
              child: const Text('Save'),
            ),
          ],
        ),
      ),
    );

    if (result == true) {
      _loadData();
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(
            content: Text('Payment recorded successfully!'),
            backgroundColor: AppTheme.successGreen,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: Text(widget.supplier.name),
      ),
      body: Column(
        children: [
          // Supplier Header
          _buildSupplierHeader(),

          // Account Summary
          _buildAccountSummary(),

          // Tabs
          TabBar(
            controller: _tabController,
            labelColor: AppTheme.primaryBrown,
            unselectedLabelColor: AppTheme.darkBrown.withOpacity(0.5),
            indicatorColor: AppTheme.primaryBrown,
            tabs: const [
              Tab(text: 'Details'),
              Tab(text: 'Invoices'),
              Tab(text: 'Payments'),
            ],
          ),

          // Tab Views
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : TabBarView(
                    controller: _tabController,
                    children: [
                      _buildDetailsTab(),
                      _buildInvoicesTab(),
                      _buildPaymentsTab(),
                    ],
                  ),
          ),
        ],
      ),
      // FIXED: Show FAB based on current tab
      floatingActionButton: AnimatedBuilder(
        animation: _tabController,
        builder: (context, child) {
          // Hide FAB on Details tab (index 0)
          if (_tabController.index == 0) {
            return const SizedBox.shrink();
          }
          
          // Show appropriate FAB for Invoices or Payments tab
          return FloatingActionButton.extended(
            onPressed: _tabController.index == 1
                ? _showAddInvoiceDialog
                : _showAddPaymentDialog,
            icon: const Icon(Icons.add),
            label: Text(_tabController.index == 1 ? 'Add Invoice' : 'Add Payment'),
          );
        },
      ),
    );
  }

  Widget _buildSupplierHeader() {
    return Container(
      padding: const EdgeInsets.all(20),
      color: Colors.white,
      child: Row(
        children: [
          Container(
            padding: const EdgeInsets.all(16),
            decoration: BoxDecoration(
              color: AppTheme.primaryBrown.withOpacity(0.1),
              borderRadius: BorderRadius.circular(12),
            ),
            child: const Icon(
              Icons.business,
              size: 32,
              color: AppTheme.primaryBrown,
            ),
          ),
          const SizedBox(width: 16),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  widget.supplier.name,
                  style: Theme.of(context).textTheme.titleLarge?.copyWith(
                        fontWeight: FontWeight.bold,
                      ),
                ),
                const SizedBox(height: 4),
                Text(
                  widget.supplier.contactPerson,
                  style: Theme.of(context).textTheme.bodyMedium,
                ),
                const SizedBox(height: 4),
                Text(
                  widget.supplier.phoneNumber,
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.6),
                      ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildAccountSummary() {
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(20),
      decoration: BoxDecoration(
        gradient: LinearGradient(
          colors: _balance > 0
              ? [AppTheme.errorRed, AppTheme.errorRed.withOpacity(0.8)]
              : [AppTheme.successGreen, AppTheme.successGreen.withOpacity(0.8)],
        ),
        borderRadius: BorderRadius.circular(16),
      ),
      child: Column(
        children: [
          Text(
            'Balance Owed',
            style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                  color: Colors.white.withOpacity(0.9),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            _currencyFormat.format(_balance),
            style: Theme.of(context).textTheme.displayMedium?.copyWith(
                  color: Colors.white,
                  fontWeight: FontWeight.bold,
                ),
          ),
          const Divider(height: 32, color: Colors.white24),
          Row(
            children: [
              Expanded(
                child: Column(
                  children: [
                    Text(
                      'Total Invoices',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: Colors.white.withOpacity(0.8),
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      _currencyFormat.format(_totalInvoices),
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            color: Colors.white,
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
              ),
              Container(height: 40, width: 1, color: Colors.white24),
              Expanded(
                child: Column(
                  children: [
                    Text(
                      'Total Payments',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: Colors.white.withOpacity(0.8),
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      _currencyFormat.format(_totalPayments),
                      style: Theme.of(context).textTheme.titleLarge?.copyWith(
                            color: Colors.white,
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildDetailsTab() {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          _buildDetailRow('Contact Person', widget.supplier.contactPerson),
          _buildDetailRow('Phone', widget.supplier.phoneNumber),
          if (widget.supplier.email != null)
            _buildDetailRow('Email', widget.supplier.email!),
          if (widget.supplier.address != null)
            _buildDetailRow('Address', widget.supplier.address!),
        ],
      ),
    );
  }

  Widget _buildDetailRow(String label, String value) {
    return Container(
      margin: const EdgeInsets.only(bottom: 16),
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: AppTheme.lightCream,
        borderRadius: BorderRadius.circular(12),
      ),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(
            label,
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.7),
                ),
          ),
          Flexible(
            child: Text(
              value,
              textAlign: TextAlign.end,
              style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                    fontWeight: FontWeight.w600,
                  ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildInvoicesTab() {
    return _invoices.isEmpty
        ? Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                Icon(
                  Icons.receipt_outlined,
                  size: 80,
                  color: AppTheme.darkBrown.withOpacity(0.3),
                ),
                const SizedBox(height: 16),
                Text(
                  'No invoices yet',
                  style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.5),
                      ),
                ),
                const SizedBox(height: 8),
                Text(
                  'Tap "Add Invoice" to get started',
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.5),
                      ),
                ),
              ],
            ),
          )
        : ListView.builder(
            padding: const EdgeInsets.all(16),
            itemCount: _invoices.length,
            itemBuilder: (context, index) {
              return _buildInvoiceCard(_invoices[index]);
            },
          );
  }

  Widget _buildInvoiceCard(SupplierInvoice invoice) {
    final isOverdue = invoice.dueDate != null && 
        invoice.dueDate!.isBefore(DateTime.now());

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Header row with invoice number and amount
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Expanded(
                  child: Text(
                    'Invoice #${invoice.invoiceNumber}',
                    style: Theme.of(context).textTheme.titleMedium?.copyWith(
                          fontWeight: FontWeight.bold,
                        ),
                  ),
                ),
                Text(
                  _currencyFormat.format(invoice.amount),
                  style: Theme.of(context).textTheme.titleLarge?.copyWith(
                        color: AppTheme.errorRed,
                        fontWeight: FontWeight.bold,
                      ),
                ),
              ],
            ),
            const SizedBox(height: 12),

            // Invoice date
            Row(
              children: [
                const Icon(Icons.calendar_today, size: 16),
                const SizedBox(width: 4),
                Text(
                  'Date: ${_dateFormat.format(invoice.invoiceDate)}',
                  style: Theme.of(context).textTheme.bodySmall,
                ),
              ],
            ),

            // Due date (if set)
            if (invoice.dueDate != null) ...[
              const SizedBox(height: 4),
              Row(
                children: [
                  Icon(
                    isOverdue ? Icons.warning : Icons.event,
                    size: 16,
                    color: isOverdue ? AppTheme.errorRed : null,
                  ),
                  const SizedBox(width: 4),
                  Text(
                    'Due: ${_dateFormat.format(invoice.dueDate!)}',
                    style: Theme.of(context).textTheme.bodySmall?.copyWith(
                          color: isOverdue ? AppTheme.errorRed : null,
                          fontWeight: isOverdue ? FontWeight.bold : null,
                        ),
                  ),
                  if (isOverdue) ...[
                    const SizedBox(width: 8),
                    Container(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 8,
                        vertical: 2,
                      ),
                      decoration: BoxDecoration(
                        color: AppTheme.errorRed,
                        borderRadius: BorderRadius.circular(12),
                      ),
                      child: Text(
                        'OVERDUE',
                        style: Theme.of(context).textTheme.labelSmall?.copyWith(
                              color: Colors.white,
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                    ),
                  ],
                ],
              ),
            ],

            // Notes (if present)
            if (invoice.notes != null && invoice.notes!.isNotEmpty) ...[
              const SizedBox(height: 12),
              Container(
                padding: const EdgeInsets.all(8),
                decoration: BoxDecoration(
                  color: AppTheme.creamBackground,
                  borderRadius: BorderRadius.circular(6),
                ),
                child: Row(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Icon(Icons.note, size: 16),
                    const SizedBox(width: 4),
                    Expanded(
                      child: Text(
                        invoice.notes!,
                        style: Theme.of(context).textTheme.bodySmall,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ],
        ),
      ),
    );
  }

  Widget _buildPaymentsTab() {
    return _payments.isEmpty
        ? Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                Icon(
                  Icons.payment_outlined,
                  size: 80,
                  color: AppTheme.darkBrown.withOpacity(0.3),
                ),
                const SizedBox(height: 16),
                Text(
                  'No payments yet',
                  style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.5),
                      ),
                ),
                const SizedBox(height: 8),
                Text(
                  'Tap "Add Payment" to get started',
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.5),
                      ),
                ),
              ],
            ),
          )
        : ListView.builder(
            padding: const EdgeInsets.all(16),
            itemCount: _payments.length,
            itemBuilder: (context, index) {
              return _buildPaymentCard(_payments[index]);
            },
          );
  }

  Widget _buildPaymentCard(SupplierPayment payment) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Header row with payment method and amount
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Row(
                  children: [
                    Icon(
                      _getPaymentMethodIcon(payment.paymentMethod),
                      size: 20,
                      color: AppTheme.successGreen,
                    ),
                    const SizedBox(width: 8),
                    Text(
                      payment.paymentMethod,
                      style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                  ],
                ),
                Text(
                  _currencyFormat.format(payment.amount),
                  style: Theme.of(context).textTheme.titleLarge?.copyWith(
                        color: AppTheme.successGreen,
                        fontWeight: FontWeight.bold,
                      ),
                ),
              ],
            ),
            const SizedBox(height: 12),

            // Payment date
            Row(
              children: [
                const Icon(Icons.calendar_today, size: 16),
                const SizedBox(width: 4),
                Text(
                  _dateFormat.format(payment.paymentDate),
                  style: Theme.of(context).textTheme.bodySmall,
                ),
              ],
            ),

            // Reference (if present)
            if (payment.reference != null && payment.reference!.isNotEmpty) ...[
              const SizedBox(height: 8),
              Row(
                children: [
                  const Icon(Icons.confirmation_number, size: 16),
                  const SizedBox(width: 4),
                  Text(
                    'Ref: ${payment.reference}',
                    style: Theme.of(context).textTheme.bodySmall?.copyWith(
                          fontWeight: FontWeight.w500,
                        ),
                  ),
                ],
              ),
            ],

            // Notes (if present)
            if (payment.notes != null && payment.notes!.isNotEmpty) ...[
              const SizedBox(height: 12),
              Container(
                padding: const EdgeInsets.all(8),
                decoration: BoxDecoration(
                  color: AppTheme.creamBackground,
                  borderRadius: BorderRadius.circular(6),
                ),
                child: Row(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Icon(Icons.note, size: 16),
                    const SizedBox(width: 4),
                    Expanded(
                      child: Text(
                        payment.notes!,
                        style: Theme.of(context).textTheme.bodySmall,
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ],
        ),
      ),
    );
  }

  IconData _getPaymentMethodIcon(String method) {
    switch (method) {
      case PaymentMethods.cash:
        return Icons.money;
      case PaymentMethods.eft:
        return Icons.account_balance;
      case PaymentMethods.cheque:
        return Icons.check_circle;
      default:
        return Icons.payment;
    }
  }
}

END OF CODE.

22. supplier_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/supplier_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/screens/supplier_details_screen.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_supplier_dialog.dart';

/// Supplier Screen
/// 
/// Main screen for supplier management.
/// Displays all suppliers with their account balances.

class SupplierScreen extends StatefulWidget {
  const SupplierScreen({super.key});

  @override
  State<SupplierScreen> createState() => _SupplierScreenState();
}

class _SupplierScreenState extends State<SupplierScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<Supplier> _suppliers = [];
  Map<int, double> _balances = {};
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    _loadSuppliers();
  }

  /// Load all suppliers and their balances
  Future<void> _loadSuppliers() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final suppliers = await _dbHelper.getAllSuppliers();
      
      // Load balance for each supplier
      Map<int, double> balances = {};
      for (var supplier in suppliers) {
        final balance = await _dbHelper.getSupplierBalance(supplier.id!);
        balances[supplier.id!] = balance;
      }

      setState(() {
        _suppliers = suppliers;
        _balances = balances;
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading suppliers: $e');
      }
    }
  }

  /// Show add supplier dialog
  Future<void> _showAddSupplierDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditSupplierDialog(),
    );

    if (result == true) {
      _loadSuppliers();
      if (mounted) {
        _showSuccessSnackBar('Supplier added successfully!');
      }
    }
  }

  /// Show edit supplier dialog
  Future<void> _showEditSupplierDialog(Supplier supplier) async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AddEditSupplierDialog(supplier: supplier),
    );

    if (result == true) {
      _loadSuppliers();
      if (mounted) {
        _showSuccessSnackBar('Supplier updated successfully!');
      }
    }
  }

  /// Delete supplier
  Future<void> _deleteSupplier(Supplier supplier) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Supplier'),
        content: Text(
            'Are you sure you want to delete ${supplier.name}? This will also delete all related invoices and payments.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteSupplier(supplier.id!);
        _loadSuppliers();
        if (mounted) {
          _showSuccessSnackBar('Supplier deleted successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting supplier: $e');
        }
      }
    }
  }

  /// Navigate to supplier details
  void _navigateToSupplierDetails(Supplier supplier) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => SupplierDetailsScreen(supplier: supplier),
      ),
    ).then((_) => _loadSuppliers());
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Suppliers'),
      ),
      body: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : _suppliers.isEmpty
              ? _buildEmptyState()
              : RefreshIndicator(
                  onRefresh: _loadSuppliers,
                  color: AppTheme.primaryBrown,
                  child: ListView.builder(
                    padding: const EdgeInsets.all(16),
                    itemCount: _suppliers.length,
                    itemBuilder: (context, index) {
                      return _buildSupplierCard(_suppliers[index]);
                    },
                  ),
                ),
      floatingActionButton: FloatingActionButton(
        onPressed: _showAddSupplierDialog,
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build supplier card
  Widget _buildSupplierCard(Supplier supplier) {
    final balance = _balances[supplier.id] ?? 0.0;
    final hasBalance = balance > 0;

    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: InkWell(
        onTap: () => _navigateToSupplierDetails(supplier),
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: const EdgeInsets.all(16),
          child: Row(
            children: [
              // Supplier Icon
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.primaryBrown.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                ),
                child: const Icon(
                  Icons.business,
                  color: AppTheme.primaryBrown,
                  size: 28,
                ),
              ),
              const SizedBox(width: 16),

              // Supplier Info
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      supplier.name,
                      style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            fontWeight: FontWeight.bold,
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      supplier.contactPerson,
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: AppTheme.darkBrown.withOpacity(0.6),
                          ),
                    ),
                    const SizedBox(height: 4),
                    Text(
                      supplier.phoneNumber,
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: AppTheme.darkBrown.withOpacity(0.6),
                          ),
                    ),
                    if (hasBalance) ...[
                      const SizedBox(height: 8),
                      Container(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 8,
                          vertical: 4,
                        ),
                        decoration: BoxDecoration(
                          color: AppTheme.errorRed.withOpacity(0.1),
                          borderRadius: BorderRadius.circular(4),
                        ),
                        child: Text(
                          'Balance Owed: R ${balance.toStringAsFixed(2)}',
                          style: Theme.of(context).textTheme.bodySmall?.copyWith(
                                color: AppTheme.errorRed,
                                fontWeight: FontWeight.w600,
                              ),
                        ),
                      ),
                    ],
                  ],
                ),
              ),

              // Actions Menu
              PopupMenuButton<String>(
                onSelected: (value) {
                  if (value == 'edit') {
                    _showEditSupplierDialog(supplier);
                  } else if (value == 'delete') {
                    _deleteSupplier(supplier);
                  } else if (value == 'details') {
                    _navigateToSupplierDetails(supplier);
                  }
                },
                itemBuilder: (context) => [
                  const PopupMenuItem(
                    value: 'details',
                    child: Row(
                      children: [
                        Icon(Icons.info, size: 20),
                        SizedBox(width: 8),
                        Text('View Details'),
                      ],
                    ),
                  ),
                  const PopupMenuItem(
                    value: 'edit',
                    child: Row(
                      children: [
                        Icon(Icons.edit, size: 20),
                        SizedBox(width: 8),
                        Text('Edit'),
                      ],
                    ),
                  ),
                  const PopupMenuItem(
                    value: 'delete',
                    child: Row(
                      children: [
                        Icon(Icons.delete, size: 20, color: AppTheme.errorRed),
                        SizedBox(width: 8),
                        Text('Delete', style: TextStyle(color: AppTheme.errorRed)),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.business_outlined,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            'No suppliers yet',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            'Tap + to add your first supplier',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}

END OF CODE.

23. vehicle_screen.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/vehicle_model.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:a_one_bakeries_app/widgets/add_edit_vehicle_dialog.dart';

/// Vehicle Screen
/// 
/// Main screen for vehicle management.
/// Displays all vehicles with their assignment status.
/// Allows adding, editing, deleting, and assigning vehicles to drivers.

class VehicleScreen extends StatefulWidget {
  const VehicleScreen({super.key});

  @override
  State<VehicleScreen> createState() => _VehicleScreenState();
}

class _VehicleScreenState extends State<VehicleScreen> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  List<Vehicle> _vehicles = [];
  List<Vehicle> _filteredVehicles = [];
  bool _isLoading = true;
  String _filterStatus = 'ALL'; // ALL, ASSIGNED, UNASSIGNED

  @override
  void initState() {
    super.initState();
    _loadVehicles();
  }

  /// Load all vehicles from database
  Future<void> _loadVehicles() async {
    setState(() {
      _isLoading = true;
    });

    try {
      final vehicles = await _dbHelper.getAllVehicles();
      setState(() {
        _vehicles = vehicles;
        _applyFilters();
        _isLoading = false;
      });
    } catch (e) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        _showErrorSnackBar('Error loading vehicles: $e');
      }
    }
  }

  /// Apply filters
  void _applyFilters() {
    List<Vehicle> filtered = _vehicles;

    if (_filterStatus == 'ASSIGNED') {
      filtered = filtered.where((v) => v.isAssigned).toList();
    } else if (_filterStatus == 'UNASSIGNED') {
      filtered = filtered.where((v) => !v.isAssigned).toList();
    }

    setState(() {
      _filteredVehicles = filtered;
    });
  }

  /// Show add vehicle dialog
  Future<void> _showAddVehicleDialog() async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => const AddEditVehicleDialog(),
    );

    if (result == true) {
      _loadVehicles();
      if (mounted) {
        _showSuccessSnackBar('Vehicle registered successfully!');
      }
    }
  }

  /// Show edit vehicle dialog
  Future<void> _showEditVehicleDialog(Vehicle vehicle) async {
    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AddEditVehicleDialog(vehicle: vehicle),
    );

    if (result == true) {
      _loadVehicles();
      if (mounted) {
        _showSuccessSnackBar('Vehicle updated successfully!');
      }
    }
  }

  /// Delete vehicle
  Future<void> _deleteVehicle(Vehicle vehicle) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Delete Vehicle'),
        content: Text(
            'Are you sure you want to delete ${vehicle.fullName} (${vehicle.registrationNumber})?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            style: ElevatedButton.styleFrom(
              backgroundColor: AppTheme.errorRed,
            ),
            child: const Text('Delete'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.deleteVehicle(vehicle.id!);
        _loadVehicles();
        if (mounted) {
          _showSuccessSnackBar('Vehicle deleted successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error deleting vehicle: $e');
        }
      }
    }
  }

  /// Show assign driver dialog
  Future<void> _showAssignDriverDialog(Vehicle vehicle) async {
    // Get all drivers (employees with role = Driver)
    final drivers = await _dbHelper.getEmployeesByRole(EmployeeRoles.driver);

    if (drivers.isEmpty) {
      if (mounted) {
        showDialog(
          context: context,
          builder: (context) => AlertDialog(
            title: const Text('No Drivers Available'),
            content: const Text(
                'Please register employees with the "Driver" role first.'),
            actions: [
              TextButton(
                onPressed: () => Navigator.pop(context),
                child: const Text('OK'),
              ),
            ],
          ),
        );
      }
      return;
    }

    Employee? selectedDriver;

    final result = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Assign Driver'),
        content: StatefulBuilder(
          builder: (context, setState) {
            return Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Text(
                  'Select driver for ${vehicle.fullName}',
                  style: Theme.of(context).textTheme.bodyMedium,
                ),
                const SizedBox(height: 16),
                DropdownButtonFormField<Employee>(
                  value: selectedDriver,
                  decoration: const InputDecoration(
                    labelText: 'Driver',
                    prefixIcon: Icon(Icons.person),
                  ),
                  items: drivers
                      .map((driver) => DropdownMenuItem(
                            value: driver,
                            child: Text(driver.fullName),
                          ))
                      .toList(),
                  onChanged: (value) {
                    setState(() {
                      selectedDriver = value;
                    });
                  },
                ),
              ],
            );
          },
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            child: const Text('Assign'),
          ),
        ],
      ),
    );

    if (result == true && selectedDriver != null) {
      try {
        await _dbHelper.assignVehicleToDriver(
          vehicle.id!,
          selectedDriver!.id!,
          selectedDriver!.fullName,
        );
        _loadVehicles();
        if (mounted) {
          _showSuccessSnackBar(
              'Vehicle assigned to ${selectedDriver!.fullName}');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error assigning vehicle: $e');
        }
      }
    }
  }

  /// Unassign vehicle
  Future<void> _unassignVehicle(Vehicle vehicle) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Unassign Vehicle'),
        content: Text(
            'Remove ${vehicle.assignedDriverName} from ${vehicle.fullName}?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('Cancel'),
          ),
          ElevatedButton(
            onPressed: () => Navigator.pop(context, true),
            child: const Text('Unassign'),
          ),
        ],
      ),
    );

    if (confirm == true) {
      try {
        await _dbHelper.unassignVehicle(vehicle.id!);
        _loadVehicles();
        if (mounted) {
          _showSuccessSnackBar('Vehicle unassigned successfully!');
        }
      } catch (e) {
        if (mounted) {
          _showErrorSnackBar('Error unassigning vehicle: $e');
        }
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTheme.creamBackground,
      appBar: AppBar(
        title: const Text('Vehicles'),
      ),
      body: Column(
        children: [
          // Filter Chips
          _buildFilterChips(),

          // Vehicle Count
          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
            child: Row(
              children: [
                Text(
                  '${_filteredVehicles.length} ${_filteredVehicles.length == 1 ? 'Vehicle' : 'Vehicles'}',
                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.7),
                        fontWeight: FontWeight.w600,
                      ),
                ),
              ],
            ),
          ),

          // Vehicles List
          Expanded(
            child: _isLoading
                ? const Center(child: CircularProgressIndicator())
                : _filteredVehicles.isEmpty
                    ? _buildEmptyState()
                    : RefreshIndicator(
                        onRefresh: _loadVehicles,
                        color: AppTheme.primaryBrown,
                        child: ListView.builder(
                          padding: const EdgeInsets.symmetric(horizontal: 16),
                          itemCount: _filteredVehicles.length,
                          itemBuilder: (context, index) {
                            return _buildVehicleCard(_filteredVehicles[index]);
                          },
                        ),
                      ),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _showAddVehicleDialog,
        child: const Icon(Icons.add),
      ),
    );
  }

  /// Build filter chips
  Widget _buildFilterChips() {
    return Container(
      padding: const EdgeInsets.all(16),
      child: Row(
        children: [
          Text(
            'Filter: ',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  fontWeight: FontWeight.w600,
                ),
          ),
          const SizedBox(width: 8),
          _buildFilterChip('ALL', 'All'),
          const SizedBox(width: 8),
          _buildFilterChip('ASSIGNED', 'Assigned'),
          const SizedBox(width: 8),
          _buildFilterChip('UNASSIGNED', 'Unassigned'),
        ],
      ),
    );
  }

  /// Build single filter chip
  Widget _buildFilterChip(String value, String label) {
    final isSelected = _filterStatus == value;
    return FilterChip(
      label: Text(label),
      selected: isSelected,
      onSelected: (selected) {
        setState(() {
          _filterStatus = value;
          _applyFilters();
        });
      },
      selectedColor: AppTheme.primaryBrown,
      checkmarkColor: Colors.white,
      labelStyle: TextStyle(
        color: isSelected ? Colors.white : AppTheme.darkBrown,
        fontWeight: isSelected ? FontWeight.w600 : FontWeight.w400,
      ),
    );
  }

  /// Build vehicle card
  Widget _buildVehicleCard(Vehicle vehicle) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      child: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Header Row
            Row(
              children: [
                // Vehicle Icon
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.secondaryOrange.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(12),
                  ),
                  child: const Icon(
                    Icons.local_shipping,
                    color: AppTheme.secondaryOrange,
                    size: 28,
                  ),
                ),
                const SizedBox(width: 16),

                // Vehicle Info
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        vehicle.fullName,
                        style:
                            Theme.of(context).textTheme.titleMedium?.copyWith(
                                  fontWeight: FontWeight.bold,
                                ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        vehicle.registrationNumber,
                        style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                              color: AppTheme.secondaryOrange,
                              fontWeight: FontWeight.w600,
                            ),
                      ),
                    ],
                  ),
                ),

                // Actions Menu
                PopupMenuButton<String>(
                  onSelected: (value) {
                    if (value == 'edit') {
                      _showEditVehicleDialog(vehicle);
                    } else if (value == 'delete') {
                      _deleteVehicle(vehicle);
                    }
                  },
                  itemBuilder: (context) => [
                    const PopupMenuItem(
                      value: 'edit',
                      child: Row(
                        children: [
                          Icon(Icons.edit, size: 20),
                          SizedBox(width: 8),
                          Text('Edit'),
                        ],
                      ),
                    ),
                    const PopupMenuItem(
                      value: 'delete',
                      child: Row(
                        children: [
                          Icon(Icons.delete,
                              size: 20, color: AppTheme.errorRed),
                          SizedBox(width: 8),
                          Text('Delete',
                              style: TextStyle(color: AppTheme.errorRed)),
                        ],
                      ),
                    ),
                  ],
                ),
              ],
            ),

            // Assigned Driver Info
            if (vehicle.isAssigned) ...[
              const SizedBox(height: 12),
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.successGreen.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  children: [
                    const Icon(
                      Icons.person,
                      color: AppTheme.successGreen,
                      size: 20,
                    ),
                    const SizedBox(width: 8),
                    Expanded(
                      child: Text(
                        'Driver: ${vehicle.assignedDriverName}',
                        style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                              color: AppTheme.successGreen,
                              fontWeight: FontWeight.w600,
                            ),
                      ),
                    ),
                  ],
                ),
              ),
            ],

            const Divider(height: 24),

            // Action Buttons
            Row(
              children: [
                if (!vehicle.isAssigned)
                  Expanded(
                    child: ElevatedButton.icon(
                      onPressed: () => _showAssignDriverDialog(vehicle),
                      icon: const Icon(Icons.person_add, size: 20),
                      label: const Text('Assign Driver'),
                    ),
                  )
                else
                  Expanded(
                    child: OutlinedButton.icon(
                      onPressed: () => _unassignVehicle(vehicle),
                      icon: const Icon(Icons.person_remove, size: 20),
                      label: const Text('Unassign'),
                      style: OutlinedButton.styleFrom(
                        foregroundColor: AppTheme.errorRed,
                        side: const BorderSide(color: AppTheme.errorRed),
                      ),
                    ),
                  ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  /// Build empty state
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.local_shipping_outlined,
            size: 80,
            color: AppTheme.darkBrown.withOpacity(0.3),
          ),
          const SizedBox(height: 16),
          Text(
            _filterStatus == 'ALL'
                ? 'No vehicles yet'
                : 'No ${_filterStatus.toLowerCase()} vehicles',
            style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
          const SizedBox(height: 8),
          Text(
            _filterStatus == 'ALL'
                ? 'Tap + to register your first vehicle'
                : 'Try a different filter',
            style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                  color: AppTheme.darkBrown.withOpacity(0.5),
                ),
          ),
        ],
      ),
    );
  }

  /// Show success snackbar
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.successGreen,
        duration: const Duration(seconds: 2),
      ),
    );
  }

  /// Show error snackbar
  void _showErrorSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: AppTheme.errorRed,
        duration: const Duration(seconds: 3),
      ),
    );
  }
}


END OF CODE.

24. photo_picker_service.dart:
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import 'package:path_provider/path_provider.dart';
import 'package:path/path.dart' as path;
import 'package:a_one_bakeries_app/theme/app_theme.dart';

/// Photo Picker Service
/// 
/// Handles selecting photos from camera or gallery,
/// saving them to app directory, and managing photo files.

class PhotoPickerService {
  final ImagePicker _picker = ImagePicker();

  /// Show dialog to choose between camera or gallery
  Future<String?> pickEmployeePhoto(BuildContext context) async {
    final source = await showDialog<ImageSource>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Add Employee Photo'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ListTile(
              leading: const Icon(Icons.camera_alt, color: AppTheme.primaryBrown),
              title: const Text('Take Photo'),
              onTap: () => Navigator.pop(context, ImageSource.camera),
            ),
            ListTile(
              leading: const Icon(Icons.photo_library, color: AppTheme.primaryBrown),
              title: const Text('Choose from Gallery'),
              onTap: () => Navigator.pop(context, ImageSource.gallery),
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancel'),
          ),
        ],
      ),
    );

    if (source == null) return null;

    return await _pickAndSavePhoto(source);
  }

  /// Pick photo from source and save to app directory
  Future<String?> _pickAndSavePhoto(ImageSource source) async {
    try {
      // Pick image
      final XFile? image = await _picker.pickImage(
        source: source,
        maxWidth: 1024,
        maxHeight: 1024,
        imageQuality: 85,
      );

      if (image == null) return null;

      // Get app directory
      final appDir = await getApplicationDocumentsDirectory();
      final employeePhotosDir = Directory('${appDir.path}/employee_photos');
      
      // Create directory if doesn't exist
      if (!await employeePhotosDir.exists()) {
        await employeePhotosDir.create(recursive: true);
      }

      // Generate unique filename
      final fileName = 'employee_${DateTime.now().millisecondsSinceEpoch}${path.extension(image.path)}';
      final savedPath = '${employeePhotosDir.path}/$fileName';

      // Copy file to app directory
      final File imageFile = File(image.path);
      await imageFile.copy(savedPath);

      return savedPath;
    } catch (e) {
      print('Error picking/saving photo: $e');
      return null;
    }
  }

  /// Delete photo file
  Future<bool> deletePhoto(String? photoPath) async {
    if (photoPath == null || photoPath.isEmpty) return false;

    try {
      final file = File(photoPath);
      if (await file.exists()) {
        await file.delete();
        return true;
      }
      return false;
    } catch (e) {
      print('Error deleting photo: $e');
      return false;
    }
  }

  /// Update photo (delete old, save new)
  Future<String?> updateEmployeePhoto(
    BuildContext context,
    String? oldPhotoPath,
  ) async {
    // Delete old photo if exists
    if (oldPhotoPath != null && oldPhotoPath.isNotEmpty) {
      await deletePhoto(oldPhotoPath);
    }

    // Pick and save new photo
    return await pickEmployeePhoto(context);
  }

  /// Show options to update or remove photo
  Future<String?> showPhotoOptions(
    BuildContext context,
    String? currentPhotoPath,
  ) async {
    final action = await showDialog<String>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Employee Photo'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            if (currentPhotoPath != null && currentPhotoPath.isNotEmpty)
              ListTile(
                leading: const Icon(Icons.visibility, color: AppTheme.primaryBrown),
                title: const Text('View Photo'),
                onTap: () => Navigator.pop(context, 'view'),
              ),
            ListTile(
              leading: const Icon(Icons.edit, color: AppTheme.primaryBrown),
              title: Text(currentPhotoPath == null || currentPhotoPath.isEmpty
                  ? 'Add Photo'
                  : 'Change Photo'),
              onTap: () => Navigator.pop(context, 'change'),
            ),
            if (currentPhotoPath != null && currentPhotoPath.isNotEmpty)
              ListTile(
                leading: const Icon(Icons.delete, color: AppTheme.errorRed),
                title: const Text('Remove Photo'),
                onTap: () => Navigator.pop(context, 'remove'),
              ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancel'),
          ),
        ],
      ),
    );

    if (action == null) return null;

    switch (action) {
      case 'view':
        if (currentPhotoPath != null) {
          await _showPhotoViewer(context, currentPhotoPath);
        }
        return null;
      
      case 'change':
        return await updateEmployeePhoto(context, currentPhotoPath);
      
      case 'remove':
        await deletePhoto(currentPhotoPath);
        return ''; // Empty string means remove photo
      
      default:
        return null;
    }
  }

  /// Show full-screen photo viewer
  Future<void> _showPhotoViewer(BuildContext context, String photoPath) async {
    await showDialog(
      context: context,
      builder: (context) => Dialog(
        backgroundColor: Colors.transparent,
        child: Stack(
          children: [
            Center(
              child: Image.file(
                File(photoPath),
                fit: BoxFit.contain,
              ),
            ),
            Positioned(
              top: 40,
              right: 20,
              child: IconButton(
                icon: const Icon(Icons.close, color: Colors.white, size: 30),
                onPressed: () => Navigator.pop(context),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

END OF CODE.

25. app_theme.dart:
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';

/// App Theme Configuration
/// 
/// This file contains the complete theme for A-One Bakeries App.
/// We use a warm, bakery-inspired color palette:
/// - Warm Brown: Main brand color (like fresh baked bread)
/// - Cream: Background color (like flour/dough)
/// - Orange: Accent color (warm and inviting)
/// - Dark Brown: Text and emphasis

class AppTheme {
  // Color Palette - Bakery Inspired Colors
  static const Color primaryBrown = Color(0xFF8B4513);      // Saddle Brown - main color
  static const Color secondaryOrange = Color(0xFFFF8C42);   // Orange - accent color
  static const Color creamBackground = Color(0xFFFFF8E7);   // Cream - background
  static const Color darkBrown = Color(0xFF3E2723);         // Dark Brown - text
  static const Color lightCream = Color(0xFFFFFBF0);        // Light cream - cards
  static const Color errorRed = Color(0xFFD32F2F);          // Error color
  static const Color successGreen = Color(0xFF388E3C);      // Success color

  /// Main Light Theme
  static ThemeData lightTheme = ThemeData(
    // Brightness
    brightness: Brightness.light,
    
    // Primary Colors
    primaryColor: primaryBrown,
    scaffoldBackgroundColor: creamBackground,
    
    // Color Scheme
    colorScheme: const ColorScheme.light(
      primary: primaryBrown,
      secondary: secondaryOrange,
      surface: lightCream,
      error: errorRed,
      onPrimary: Colors.white,
      onSecondary: Colors.white,
      onSurface: darkBrown,
      onError: Colors.white,
    ),

    // AppBar Theme
    appBarTheme: AppBarTheme(
      backgroundColor: primaryBrown,
      foregroundColor: Colors.white,
      elevation: 0,
      centerTitle: true,
      titleTextStyle: GoogleFonts.poppins(
        fontSize: 20,
        fontWeight: FontWeight.w600,
        color: Colors.white,
      ),
      iconTheme: const IconThemeData(color: Colors.white),
    ),

    // Card Theme
    cardTheme: CardThemeData(
      color: lightCream,
      elevation: 2,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
    ),

    // Elevated Button Theme
    elevatedButtonTheme: ElevatedButtonThemeData(
      style: ElevatedButton.styleFrom(
        backgroundColor: primaryBrown,
        foregroundColor: Colors.white,
        elevation: 2,
        padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 12),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        textStyle: GoogleFonts.poppins(
          fontSize: 16,
          fontWeight: FontWeight.w600,
        ),
      ),
    ),

    // Text Button Theme
    textButtonTheme: TextButtonThemeData(
      style: TextButton.styleFrom(
        foregroundColor: primaryBrown,
        textStyle: GoogleFonts.poppins(
          fontSize: 14,
          fontWeight: FontWeight.w500,
        ),
      ),
    ),

    // Outlined Button Theme
    outlinedButtonTheme: OutlinedButtonThemeData(
      style: OutlinedButton.styleFrom(
        foregroundColor: primaryBrown,
        side: const BorderSide(color: primaryBrown, width: 1.5),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        textStyle: GoogleFonts.poppins(
          fontSize: 16,
          fontWeight: FontWeight.w600,
        ),
      ),
    ),

    // Floating Action Button Theme
    floatingActionButtonTheme: const FloatingActionButtonThemeData(
      backgroundColor: secondaryOrange,
      foregroundColor: Colors.white,
      elevation: 4,
    ),

    // Input Decoration Theme
    inputDecorationTheme: InputDecorationTheme(
      filled: true,
      fillColor: Colors.white,
      contentPadding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
      border: OutlineInputBorder(
        borderRadius: BorderRadius.circular(8),
        borderSide: const BorderSide(color: primaryBrown, width: 1),
      ),
      enabledBorder: OutlineInputBorder(
        borderRadius: BorderRadius.circular(8),
        borderSide: BorderSide(color: primaryBrown.withOpacity(0.3), width: 1),
      ),
      focusedBorder: OutlineInputBorder(
        borderRadius: BorderRadius.circular(8),
        borderSide: const BorderSide(color: primaryBrown, width: 2),
      ),
      errorBorder: OutlineInputBorder(
        borderRadius: BorderRadius.circular(8),
        borderSide: const BorderSide(color: errorRed, width: 1),
      ),
      focusedErrorBorder: OutlineInputBorder(
        borderRadius: BorderRadius.circular(8),
        borderSide: const BorderSide(color: errorRed, width: 2),
      ),
      labelStyle: GoogleFonts.poppins(
        color: darkBrown,
        fontSize: 14,
      ),
      hintStyle: GoogleFonts.poppins(
        color: darkBrown.withOpacity(0.5),
        fontSize: 14,
      ),
    ),

    // Icon Theme
    iconTheme: const IconThemeData(
      color: primaryBrown,
      size: 24,
    ),

    // Divider Theme
    dividerTheme: DividerThemeData(
      color: primaryBrown.withOpacity(0.2),
      thickness: 1,
      space: 1,
    ),

    // Bottom Navigation Bar Theme
    bottomNavigationBarTheme: BottomNavigationBarThemeData(
      backgroundColor: Colors.white,
      selectedItemColor: primaryBrown,
      unselectedItemColor: darkBrown.withOpacity(0.5),
      selectedLabelStyle: GoogleFonts.poppins(
        fontSize: 12,
        fontWeight: FontWeight.w600,
      ),
      unselectedLabelStyle: GoogleFonts.poppins(
        fontSize: 12,
        fontWeight: FontWeight.w400,
      ),
      elevation: 8,
      type: BottomNavigationBarType.fixed,
    ),

    // Text Theme
    textTheme: TextTheme(
      // Headings
      displayLarge: GoogleFonts.poppins(
        fontSize: 32,
        fontWeight: FontWeight.bold,
        color: darkBrown,
      ),
      displayMedium: GoogleFonts.poppins(
        fontSize: 28,
        fontWeight: FontWeight.bold,
        color: darkBrown,
      ),
      displaySmall: GoogleFonts.poppins(
        fontSize: 24,
        fontWeight: FontWeight.bold,
        color: darkBrown,
      ),
      
      // Titles
      headlineMedium: GoogleFonts.poppins(
        fontSize: 20,
        fontWeight: FontWeight.w600,
        color: darkBrown,
      ),
      headlineSmall: GoogleFonts.poppins(
        fontSize: 18,
        fontWeight: FontWeight.w600,
        color: darkBrown,
      ),
      
      // Body Text
      bodyLarge: GoogleFonts.poppins(
        fontSize: 16,
        fontWeight: FontWeight.w400,
        color: darkBrown,
      ),
      bodyMedium: GoogleFonts.poppins(
        fontSize: 14,
        fontWeight: FontWeight.w400,
        color: darkBrown,
      ),
      bodySmall: GoogleFonts.poppins(
        fontSize: 12,
        fontWeight: FontWeight.w400,
        color: darkBrown,
      ),
      
      // Labels
      labelLarge: GoogleFonts.poppins(
        fontSize: 14,
        fontWeight: FontWeight.w600,
        color: darkBrown,
      ),
    ),
  );
}

END OF CODE.

26. add_edit_employee_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:intl/intl.dart';

/// Add/Edit Employee Dialog
/// 
/// A dialog form to register a new employee or edit an existing one.
/// Collects: name, ID number, birth date, and role.

class AddEditEmployeeDialog extends StatefulWidget {
  final Employee? employee; // null = add new, not null = edit existing

  const AddEditEmployeeDialog({
    super.key,
    this.employee,
  });

  @override
  State<AddEditEmployeeDialog> createState() => _AddEditEmployeeDialogState();
}

class _AddEditEmployeeDialogState extends State<AddEditEmployeeDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();

  late TextEditingController _firstNameController;
  late TextEditingController _lastNameController;
  late TextEditingController _idNumberController;

  String _selectedIdType = 'ID';
  String _selectedRole = EmployeeRoles.baker;
  DateTime? _selectedBirthDate;

  bool _isSaving = false;

  final DateFormat _dateFormat = DateFormat('dd MMM yyyy');

  @override
  void initState() {
    super.initState();
    // Initialize controllers with existing values if editing
    _firstNameController =
        TextEditingController(text: widget.employee?.firstName ?? '');
    _lastNameController =
        TextEditingController(text: widget.employee?.lastName ?? '');
    _idNumberController =
        TextEditingController(text: widget.employee?.idNumber ?? '');

    if (widget.employee != null) {
      _selectedIdType = widget.employee!.idType;
      _selectedRole = widget.employee!.role;
      _selectedBirthDate = widget.employee!.birthDate;
    }
  }

  @override
  void dispose() {
    _firstNameController.dispose();
    _lastNameController.dispose();
    _idNumberController.dispose();
    super.dispose();
  }

  /// Save employee to database
  Future<void> _saveEmployee() async {
    if (!_formKey.currentState!.validate()) return;

    if (_selectedBirthDate == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text('Please select birth date'),
          backgroundColor: AppTheme.errorRed,
        ),
      );
      return;
    }

    setState(() {
      _isSaving = true;
    });

    try {
      final employee = Employee(
        id: widget.employee?.id,
        firstName: _firstNameController.text.trim(),
        lastName: _lastNameController.text.trim(),
        idNumber: _idNumberController.text.trim(),
        idType: _selectedIdType,
        birthDate: _selectedBirthDate!,
        role: _selectedRole,
        photoPath: widget.employee?.photoPath,
        createdAt: widget.employee?.createdAt,
      );

      if (widget.employee == null) {
        // Add new employee
        await _dbHelper.insertEmployee(employee);
      } else {
        // Update existing employee
        await _dbHelper.updateEmployee(employee);
      }

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error saving employee: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  /// Show date picker
  Future<void> _selectBirthDate() async {
    final DateTime? picked = await showDatePicker(
      context: context,
      initialDate: _selectedBirthDate ?? DateTime(2000),
      firstDate: DateTime(1950),
      lastDate: DateTime.now(),
      builder: (context, child) {
        return Theme(
          data: Theme.of(context).copyWith(
            colorScheme: const ColorScheme.light(
              primary: AppTheme.primaryBrown,
              onPrimary: Colors.white,
              surface: AppTheme.lightCream,
              onSurface: AppTheme.darkBrown,
            ),
          ),
          child: child!,
        );
      },
    );

    if (picked != null) {
      setState(() {
        _selectedBirthDate = picked;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    final isEditing = widget.employee != null;

    return AlertDialog(
      title: Text(isEditing ? 'Edit Employee' : 'Register Employee'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // First Name Field
              TextFormField(
                controller: _firstNameController,
                decoration: const InputDecoration(
                  labelText: 'First Name',
                  hintText: 'Enter first name',
                  prefixIcon: Icon(Icons.person),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter first name';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Last Name Field
              TextFormField(
                controller: _lastNameController,
                decoration: const InputDecoration(
                  labelText: 'Last Name',
                  hintText: 'Enter last name',
                  prefixIcon: Icon(Icons.person_outline),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter last name';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // ID Type Dropdown
              DropdownButtonFormField<String>(
                value: _selectedIdType,
                decoration: const InputDecoration(
                  labelText: 'ID Type',
                  prefixIcon: Icon(Icons.badge),
                ),
                items: const [
                  DropdownMenuItem(value: 'ID', child: Text('SA ID Number')),
                  DropdownMenuItem(
                      value: 'PASSPORT', child: Text('Passport Number')),
                ],
                onChanged: (value) {
                  setState(() {
                    _selectedIdType = value!;
                  });
                },
              ),
              const SizedBox(height: 16),

              // ID Number Field
              TextFormField(
                controller: _idNumberController,
                decoration: InputDecoration(
                  labelText: _selectedIdType == 'ID'
                      ? 'SA ID Number'
                      : 'Passport Number',
                  hintText: _selectedIdType == 'ID'
                      ? '0000000000000'
                      : 'A00000000',
                  prefixIcon: const Icon(Icons.credit_card),
                ),
                keyboardType: TextInputType.text,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter ID/Passport number';
                  }
                  if (_selectedIdType == 'ID' && value.trim().length != 13) {
                    return 'SA ID must be 13 digits';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Birth Date Field
              InkWell(
                onTap: _selectBirthDate,
                child: InputDecorator(
                  decoration: const InputDecoration(
                    labelText: 'Birth Date',
                    prefixIcon: Icon(Icons.calendar_today),
                    suffixIcon: Icon(Icons.arrow_drop_down),
                  ),
                  child: Text(
                    _selectedBirthDate == null
                        ? 'Select birth date'
                        : _dateFormat.format(_selectedBirthDate!),
                    style: Theme.of(context).textTheme.bodyLarge,
                  ),
                ),
              ),
              const SizedBox(height: 16),

              // Role Dropdown
              DropdownButtonFormField<String>(
                value: _selectedRole,
                decoration: const InputDecoration(
                  labelText: 'Role',
                  prefixIcon: Icon(Icons.work),
                ),
                items: EmployeeRoles.allRoles
                    .map((role) => DropdownMenuItem(
                          value: role,
                          child: Text(role),
                        ))
                    .toList(),
                onChanged: (value) {
                  setState(() {
                    _selectedRole = value!;
                  });
                },
              ),
              const SizedBox(height: 16),

              // Age Preview (if birth date selected)
              if (_selectedBirthDate != null)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.primaryBrown.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                  ),
                  child: Row(
                    children: [
                      const Icon(
                        Icons.cake,
                        color: AppTheme.primaryBrown,
                        size: 20,
                      ),
                      const SizedBox(width: 8),
                      Text(
                        'Age: ${_calculateAge(_selectedBirthDate!)} years old',
                        style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                              color: AppTheme.primaryBrown,
                              fontWeight: FontWeight.w600,
                            ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton(
          onPressed: _isSaving ? null : _saveEmployee,
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : Text(isEditing ? 'Update' : 'Register'),
        ),
      ],
    );
  }

  /// Calculate age from birth date
  int _calculateAge(DateTime birthDate) {
    final now = DateTime.now();
    int age = now.year - birthDate.year;
    if (now.month < birthDate.month ||
        (now.month == birthDate.month && now.day < birthDate.day)) {
      age--;
    }
    return age;
  }
}

END OF CODE.

27. add_edit_stock_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Add/Edit Stock Dialog
/// 
/// A dialog form to add a new stock item or edit an existing one.
/// Validates input and saves to database.

class AddEditStockDialog extends StatefulWidget {
  final StockItem? stockItem; // null = add new, not null = edit existing

  const AddEditStockDialog({
    super.key,
    this.stockItem,
  });

  @override
  State<AddEditStockDialog> createState() => _AddEditStockDialogState();
}

class _AddEditStockDialogState extends State<AddEditStockDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();
  
  late TextEditingController _nameController;
  late TextEditingController _unitController;
  late TextEditingController _quantityController;
  
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    // Initialize controllers with existing values if editing
    _nameController = TextEditingController(text: widget.stockItem?.name ?? '');
    _unitController = TextEditingController(text: widget.stockItem?.unit ?? '');
    _quantityController = TextEditingController(
      text: widget.stockItem?.quantityOnHand.toString() ?? '0',
    );
  }

  @override
  void dispose() {
    _nameController.dispose();
    _unitController.dispose();
    _quantityController.dispose();
    super.dispose();
  }

  /// Save stock item to database
  Future<void> _saveStockItem() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      final stockItem = StockItem(
        id: widget.stockItem?.id,
        name: _nameController.text.trim(),
        unit: _unitController.text.trim(),
        // StockItem.quantityOnHand is an int in the model, so parse as double then convert to int
        quantityOnHand: double.parse(_quantityController.text.trim()).toInt(),
        createdAt: widget.stockItem?.createdAt,
      );

      if (widget.stockItem == null) {
        // Add new item
        await _dbHelper.insertStockItem(stockItem);
      } else {
        // Update existing item
        await _dbHelper.updateStockItem(stockItem);
      }

      if (mounted) {
        Navigator.pop(context, true); // Return true to indicate success
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error saving stock item: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final isEditing = widget.stockItem != null;

    return AlertDialog(
      title: Text(isEditing ? 'Edit Stock Item' : 'Add Stock Item'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // Item Name Field
              TextFormField(
                controller: _nameController,
                decoration: const InputDecoration(
                  labelText: 'Item Name',
                  hintText: 'e.g., Flour, Sugar, Yeast',
                  prefixIcon: Icon(Icons.label),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter item name';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Unit Field
              TextFormField(
                controller: _unitController,
                decoration: const InputDecoration(
                  labelText: 'Unit of Measurement',
                  hintText: 'e.g., kg, L, bags, packets',
                  prefixIcon: Icon(Icons.straighten),
                ),
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter unit';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Initial Quantity Field (only for new items)
              if (!isEditing)
                TextFormField(
                  controller: _quantityController,
                  decoration: const InputDecoration(
                    labelText: 'Initial Quantity',
                    hintText: '0',
                    prefixIcon: Icon(Icons.numbers),
                  ),
                  keyboardType: const TextInputType.numberWithOptions(decimal: true),
                  validator: (value) {
                    if (value == null || value.trim().isEmpty) {
                      return 'Please enter quantity';
                    }
                    final quantity = double.tryParse(value.trim());
                    if (quantity == null || quantity < 0) {
                      return 'Please enter valid quantity';
                    }
                    return null;
                  },
                ),

              // Info message for editing
              if (isEditing)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.secondaryOrange.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                    border: Border.all(
                      color: AppTheme.secondaryOrange.withOpacity(0.3),
                    ),
                  ),
                  child: Row(
                    children: [
                      Icon(
                        Icons.info_outline,
                        size: 20,
                        color: AppTheme.secondaryOrange,
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: Text(
                          'Use "Receive" or "Allocate" to update quantity',
                          style: Theme.of(context).textTheme.bodySmall?.copyWith(
                                color: AppTheme.darkBrown.withOpacity(0.7),
                              ),
                        ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton(
          onPressed: _isSaving ? null : _saveStockItem,
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : Text(isEditing ? 'Update' : 'Add'),
        ),
      ],
    );
  }
}

END OF CODE.

28. add_edit_supplier_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/supplier_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Add/Edit Supplier Dialog
/// 
/// Dialog to add a new supplier or edit an existing one.

class AddEditSupplierDialog extends StatefulWidget {
  final Supplier? supplier;

  const AddEditSupplierDialog({
    super.key,
    this.supplier,
  });

  @override
  State<AddEditSupplierDialog> createState() => _AddEditSupplierDialogState();
}

class _AddEditSupplierDialogState extends State<AddEditSupplierDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();

  late TextEditingController _nameController;
  late TextEditingController _contactPersonController;
  late TextEditingController _phoneController;
  late TextEditingController _emailController;
  late TextEditingController _addressController;

  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _nameController = TextEditingController(text: widget.supplier?.name ?? '');
    _contactPersonController =
        TextEditingController(text: widget.supplier?.contactPerson ?? '');
    _phoneController =
        TextEditingController(text: widget.supplier?.phoneNumber ?? '');
    _emailController = TextEditingController(text: widget.supplier?.email ?? '');
    _addressController =
        TextEditingController(text: widget.supplier?.address ?? '');
  }

  @override
  void dispose() {
    _nameController.dispose();
    _contactPersonController.dispose();
    _phoneController.dispose();
    _emailController.dispose();
    _addressController.dispose();
    super.dispose();
  }

  Future<void> _saveSupplier() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      final supplier = Supplier(
        id: widget.supplier?.id,
        name: _nameController.text.trim(),
        contactPerson: _contactPersonController.text.trim(),
        phoneNumber: _phoneController.text.trim(),
        email: _emailController.text.trim().isEmpty
            ? null
            : _emailController.text.trim(),
        address: _addressController.text.trim().isEmpty
            ? null
            : _addressController.text.trim(),
        createdAt: widget.supplier?.createdAt,
      );

      if (widget.supplier == null) {
        await _dbHelper.insertSupplier(supplier);
      } else {
        await _dbHelper.updateSupplier(supplier);
      }

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error saving supplier: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final isEditing = widget.supplier != null;

    return AlertDialog(
      title: Text(isEditing ? 'Edit Supplier' : 'Add Supplier'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // Supplier Name
              TextFormField(
                controller: _nameController,
                decoration: const InputDecoration(
                  labelText: 'Supplier Name',
                  hintText: 'e.g., ABC Suppliers',
                  prefixIcon: Icon(Icons.business),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter supplier name';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Contact Person
              TextFormField(
                controller: _contactPersonController,
                decoration: const InputDecoration(
                  labelText: 'Contact Person',
                  hintText: 'e.g., John Doe',
                  prefixIcon: Icon(Icons.person),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter contact person';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Phone Number
              TextFormField(
                controller: _phoneController,
                decoration: const InputDecoration(
                  labelText: 'Phone Number',
                  hintText: 'e.g., 0123456789',
                  prefixIcon: Icon(Icons.phone),
                ),
                keyboardType: TextInputType.phone,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter phone number';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Email (Optional)
              TextFormField(
                controller: _emailController,
                decoration: const InputDecoration(
                  labelText: 'Email (Optional)',
                  hintText: 'e.g., supplier@example.com',
                  prefixIcon: Icon(Icons.email),
                ),
                keyboardType: TextInputType.emailAddress,
              ),
              const SizedBox(height: 16),

              // Address (Optional)
              TextFormField(
                controller: _addressController,
                decoration: const InputDecoration(
                  labelText: 'Address (Optional)',
                  hintText: 'e.g., 123 Main Street',
                  prefixIcon: Icon(Icons.location_on),
                ),
                textCapitalization: TextCapitalization.words,
                maxLines: 2,
              ),
            ],
          ),
        ),
      ),
      actions: [
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),
        ElevatedButton(
          onPressed: _isSaving ? null : _saveSupplier,
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : Text(isEditing ? 'Update' : 'Add'),
        ),
      ],
    );
  }
}

END OF CODE.

29. add_edit_vehicle_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/vehicle_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Add/Edit Vehicle Dialog
/// 
/// A dialog form to register a new vehicle or edit an existing one.
/// Collects: make, model, year, and registration number.

class AddEditVehicleDialog extends StatefulWidget {
  final Vehicle? vehicle; // null = add new, not null = edit existing

  const AddEditVehicleDialog({
    super.key,
    this.vehicle,
  });

  @override
  State<AddEditVehicleDialog> createState() => _AddEditVehicleDialogState();
}

class _AddEditVehicleDialogState extends State<AddEditVehicleDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();

  late TextEditingController _makeController;
  late TextEditingController _modelController;
  late TextEditingController _yearController;
  late TextEditingController _registrationController;

  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    // Initialize controllers with existing values if editing
    _makeController = TextEditingController(text: widget.vehicle?.make ?? '');
    _modelController = TextEditingController(text: widget.vehicle?.model ?? '');
    _yearController =
        TextEditingController(text: widget.vehicle?.year.toString() ?? '');
    _registrationController =
        TextEditingController(text: widget.vehicle?.registrationNumber ?? '');
  }

  @override
  void dispose() {
    _makeController.dispose();
    _modelController.dispose();
    _yearController.dispose();
    _registrationController.dispose();
    super.dispose();
  }

  /// Save vehicle to database
  Future<void> _saveVehicle() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      final vehicle = Vehicle(
        id: widget.vehicle?.id,
        make: _makeController.text.trim(),
        model: _modelController.text.trim(),
        year: int.parse(_yearController.text.trim()),
        registrationNumber: _registrationController.text.trim().toUpperCase(),
        assignedDriverId: widget.vehicle?.assignedDriverId,
        assignedDriverName: widget.vehicle?.assignedDriverName,
        createdAt: widget.vehicle?.createdAt,
      );

      if (widget.vehicle == null) {
        // Add new vehicle
        await _dbHelper.insertVehicle(vehicle);
      } else {
        // Update existing vehicle
        await _dbHelper.updateVehicle(vehicle);
      }

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error saving vehicle: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final isEditing = widget.vehicle != null;

    return AlertDialog(
      title: Text(isEditing ? 'Edit Vehicle' : 'Register Vehicle'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // Make Field
              TextFormField(
                controller: _makeController,
                decoration: const InputDecoration(
                  labelText: 'Make',
                  hintText: 'e.g., Toyota, Ford, Isuzu',
                  prefixIcon: Icon(Icons.business),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter vehicle make';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Model Field
              TextFormField(
                controller: _modelController,
                decoration: const InputDecoration(
                  labelText: 'Model',
                  hintText: 'e.g., Hilux, Ranger, NPR',
                  prefixIcon: Icon(Icons.directions_car),
                ),
                textCapitalization: TextCapitalization.words,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter vehicle model';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Year Field
              TextFormField(
                controller: _yearController,
                decoration: const InputDecoration(
                  labelText: 'Year',
                  hintText: 'e.g., 2020',
                  prefixIcon: Icon(Icons.calendar_today),
                ),
                keyboardType: TextInputType.number,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter year';
                  }
                  final year = int.tryParse(value.trim());
                  if (year == null) {
                    return 'Please enter valid year';
                  }
                  final currentYear = DateTime.now().year;
                  if (year < 1900 || year > currentYear + 1) {
                    return 'Please enter valid year (1900-${currentYear + 1})';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Registration Number Field
              TextFormField(
                controller: _registrationController,
                decoration: const InputDecoration(
                  labelText: 'Registration Number',
                  hintText: 'e.g., ABC 123 GP',
                  prefixIcon: Icon(Icons.pin),
                ),
                textCapitalization: TextCapitalization.characters,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter registration number';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Info about driver assignment
              if (!isEditing)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.primaryBrown.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                  ),
                  child: Row(
                    children: [
                      Icon(
                        Icons.info_outline,
                        size: 20,
                        color: AppTheme.primaryBrown,
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: Text(
                          'You can assign a driver after registering',
                          style:
                              Theme.of(context).textTheme.bodySmall?.copyWith(
                                    color: AppTheme.darkBrown.withOpacity(0.7),
                                  ),
                        ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton(
          onPressed: _isSaving ? null : _saveVehicle,
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : Text(isEditing ? 'Update' : 'Register'),
        ),
      ],
    );
  }
}

END OF CODE.

30. add_expense_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/finance_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Add Expense Dialog
/// 
/// Dialog to record daily expenses.

class AddExpenseDialog extends StatefulWidget {
  const AddExpenseDialog({super.key});

  @override
  State<AddExpenseDialog> createState() => _AddExpenseDialogState();
}

class _AddExpenseDialogState extends State<AddExpenseDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();

  final TextEditingController _descriptionController = TextEditingController();
  final TextEditingController _amountController = TextEditingController();

  bool _isSaving = false;

  @override
  void dispose() {
    _descriptionController.dispose();
    _amountController.dispose();
    super.dispose();
  }

  /// Save expense
  Future<void> _saveExpense() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      final expense = Expense(
        description: _descriptionController.text.trim(),
        amount: double.parse(_amountController.text.trim()),
      );

      await _dbHelper.insertExpense(expense);

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error recording expense: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('Record Expense'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // Description Field
              TextFormField(
                controller: _descriptionController,
                decoration: const InputDecoration(
                  labelText: 'Description',
                  hintText: 'e.g., Fuel, Supplies, Maintenance',
                  prefixIcon: Icon(Icons.description),
                ),
                textCapitalization: TextCapitalization.sentences,
                autofocus: true,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter description';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Amount Field
              TextFormField(
                controller: _amountController,
                decoration: const InputDecoration(
                  labelText: 'Amount',
                  hintText: '0.00',
                  prefixText: 'R ',
                  prefixIcon: Icon(Icons.money_off),
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter amount';
                  }
                  final amount = double.tryParse(value.trim());
                  if (amount == null || amount <= 0) {
                    return 'Please enter valid amount';
                  }
                  return null;
                },
              ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton(
          onPressed: _isSaving ? null : _saveExpense,
          style: ElevatedButton.styleFrom(
            backgroundColor: AppTheme.errorRed,
          ),
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : const Text('Record'),
        ),
      ],
    );
  }
}

END OF CODE.

31. add_income_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/finance_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'package:intl/intl.dart';

/// Add Income Dialog
/// 
/// Dialog to record daily income.
/// Separated into Notes (paper money) and Coins.

class AddIncomeDialog extends StatefulWidget {
  const AddIncomeDialog({super.key});

  @override
  State<AddIncomeDialog> createState() => _AddIncomeDialogState();
}

class _AddIncomeDialogState extends State<AddIncomeDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();

  final TextEditingController _descriptionController = TextEditingController();
  final TextEditingController _notesController = TextEditingController();
  final TextEditingController _coinsController = TextEditingController(text: '0');

  bool _isSaving = false;

  final NumberFormat _currencyFormat = NumberFormat.currency(symbol: 'R ');

  @override
  void dispose() {
    _descriptionController.dispose();
    _notesController.dispose();
    _coinsController.dispose();
    super.dispose();
  }

  /// Calculate total
  double _calculateTotal() {
    final notes = double.tryParse(_notesController.text.trim()) ?? 0.0;
    final coins = double.tryParse(_coinsController.text.trim()) ?? 0.0;
    return notes + coins;
  }

  /// Save income
  Future<void> _saveIncome() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      final income = Income(
        description: _descriptionController.text.trim().isEmpty 
            ? null 
            : _descriptionController.text.trim(),
        notes: double.parse(_notesController.text.trim()),
        coins: double.tryParse(_coinsController.text.trim()) ?? 0.0,
      );

      await _dbHelper.insertIncome(income);

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error recording income: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('Record Income'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // Description Field
              TextFormField(
                controller: _descriptionController,
                decoration: const InputDecoration(
                  labelText: 'Description (Optional)',
                  hintText: 'e.g., Daily sales, Cash payment',
                  prefixIcon: Icon(Icons.description),
                ),
                textCapitalization: TextCapitalization.sentences,
                autofocus: true,
              ),
              const SizedBox(height: 16),

              // Notes Field
              TextFormField(
                controller: _notesController,
                decoration: const InputDecoration(
                  labelText: 'Notes (Paper Money)',
                  hintText: '0.00',
                  prefixText: 'R ',
                  prefixIcon: Icon(Icons.money),
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                onChanged: (_) => setState(() {}),
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter notes amount';
                  }
                  final amount = double.tryParse(value.trim());
                  if (amount == null || amount < 0) {
                    return 'Please enter valid amount';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Coins Field (Optional)
              TextFormField(
                controller: _coinsController,
                decoration: const InputDecoration(
                  labelText: 'Coins (Optional)',
                  hintText: '0.00',
                  prefixText: 'R ',
                  prefixIcon: Icon(Icons.attach_money),
                  helperText: 'Leave as 0 if no coins',
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                onChanged: (_) => setState(() {}),
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return null; // Optional field
                  }
                  final amount = double.tryParse(value.trim());
                  if (amount == null || amount < 0) {
                    return 'Please enter valid amount';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Total Preview
              if (_notesController.text.isNotEmpty &&
                  double.tryParse(_notesController.text) != null)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.successGreen.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                    border: Border.all(
                      color: AppTheme.successGreen.withOpacity(0.3),
                    ),
                  ),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text(
                        'TOTAL:',
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                              color: AppTheme.successGreen,
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                      Text(
                        _currencyFormat.format(_calculateTotal()),
                        style: Theme.of(context).textTheme.titleLarge?.copyWith(
                              color: AppTheme.successGreen,
                              fontWeight: FontWeight.bold,
                            ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton(
          onPressed: _isSaving ? null : _saveIncome,
          child: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : const Text('Record'),
        ),
      ],
    );
  }
}

END OF CODE.

32. allocate_stock_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Allocate Stock Dialog - FIXED VERSION
/// 
/// Dialog to allocate stock to employees for orders.
/// Validates quantity doesn't exceed stock on hand.
/// Updates stock quantity and creates a movement record.
/// 
/// FIX: Properly handles int to double conversion

class AllocateStockDialog extends StatefulWidget {
  final StockItem stockItem;

  const AllocateStockDialog({
    super.key,
    required this.stockItem,
  });

  @override
  State<AllocateStockDialog> createState() => _AllocateStockDialogState();
}

class _AllocateStockDialogState extends State<AllocateStockDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();
  
  late TextEditingController _quantityController;
  late TextEditingController _employeeController;
  late TextEditingController _notesController;
  
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _quantityController = TextEditingController();
    _employeeController = TextEditingController();
    _notesController = TextEditingController();
  }

  @override
  void dispose() {
    _quantityController.dispose();
    _employeeController.dispose();
    _notesController.dispose();
    super.dispose();
  }

  /// Save allocated stock - FIXED VERSION
  Future<void> _saveAllocatedStock() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      // FIX: Parse as double to avoid type casting errors
      final quantityText = _quantityController.text.trim();
      final quantity = double.parse(quantityText);

      final movement = StockMovement(
        stockItemId: widget.stockItem.id!,
        stockItemName: widget.stockItem.name,
        movementType: 'ALLOCATED',
        quantity: quantity, // Now properly typed as double
        employeeName: _employeeController.text.trim(),
        notes: _notesController.text.trim().isEmpty 
            ? null 
            : _notesController.text.trim(),
      );

      await _dbHelper.insertStockMovement(movement);

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error allocating stock: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('Allocate Stock'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // Stock Item Info
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.primaryBrown.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  children: [
                    const Icon(
                      Icons.inventory_2,
                      color: AppTheme.primaryBrown,
                    ),
                    const SizedBox(width: 12),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Text(
                            widget.stockItem.name,
                            style: Theme.of(context).textTheme.titleMedium?.copyWith(
                                  fontWeight: FontWeight.bold,
                                ),
                          ),
                          Text(
                            'Available: ${widget.stockItem.quantityOnHand.toStringAsFixed(0)} ${widget.stockItem.unit}',
                            style: Theme.of(context).textTheme.bodySmall,
                          ),
                        ],
                      ),
                    ),
                  ],
                ),
              ),
              const SizedBox(height: 20),

              // Employee Name Field
              TextFormField(
                controller: _employeeController,
                decoration: const InputDecoration(
                  labelText: 'Employee Name',
                  hintText: 'Who is receiving this stock?',
                  prefixIcon: Icon(Icons.person),
                ),
                textCapitalization: TextCapitalization.words,
                autofocus: true,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter employee name';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Quantity Allocated Field
              TextFormField(
                controller: _quantityController,
                decoration: InputDecoration(
                  labelText: 'Quantity to Allocate',
                  hintText: 'Enter quantity',
                  prefixIcon: const Icon(Icons.remove_circle_outline),
                  suffixText: widget.stockItem.unit,
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter quantity';
                  }
                  // FIX: Try parsing as double
                  final quantity = double.tryParse(value.trim());
                  if (quantity == null || quantity <= 0) {
                    return 'Please enter valid quantity';
                  }
                  if (quantity > widget.stockItem.quantityOnHand) {
                    return 'Insufficient stock (Available: ${widget.stockItem.quantityOnHand.toStringAsFixed(0)})';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Notes Field (Optional)
              TextFormField(
                controller: _notesController,
                decoration: const InputDecoration(
                  labelText: 'Notes (Optional)',
                  hintText: 'e.g., Order details, driver name',
                  prefixIcon: Icon(Icons.note),
                ),
                maxLines: 2,
                textCapitalization: TextCapitalization.sentences,
              ),
              const SizedBox(height: 16),

              // Remaining Quantity Preview
              if (_quantityController.text.isNotEmpty && 
                  double.tryParse(_quantityController.text) != null &&
                  double.parse(_quantityController.text) <= widget.stockItem.quantityOnHand)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.secondaryOrange.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                    border: Border.all(
                      color: AppTheme.secondaryOrange.withOpacity(0.3),
                    ),
                  ),
                  child: Row(
                    children: [
                      const Icon(
                        Icons.trending_down,
                        color: AppTheme.secondaryOrange,
                        size: 20,
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: Text(
                          'Remaining: ${(widget.stockItem.quantityOnHand - double.parse(_quantityController.text)).toStringAsFixed(0)} ${widget.stockItem.unit}',
                          style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                                color: AppTheme.secondaryOrange,
                                fontWeight: FontWeight.w600,
                              ),
                        ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton.icon(
          onPressed: _isSaving ? null : _saveAllocatedStock,
          icon: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : const Icon(Icons.check),
          label: const Text('Allocate'),
        ),
      ],
    );
  }
}

END OF CODE.

33. employee__photo_widget.dart:
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';

/// Employee Photo Widget
/// 
/// Displays employee photo or default avatar icon.
/// Handles both file paths and shows default icon if no photo.

class EmployeePhotoWidget extends StatelessWidget {
  final String? photoPath;
  final double radius;
  final Color? backgroundColor;
  final IconData? defaultIcon;

  const EmployeePhotoWidget({
    super.key,
    this.photoPath,
    this.radius = 30,
    this.backgroundColor,
    this.defaultIcon,
  });

  @override
  Widget build(BuildContext context) {
    final bgColor = backgroundColor ?? AppTheme.primaryBrown.withOpacity(0.1);
    final icon = defaultIcon ?? Icons.person;

    return CircleAvatar(
      radius: radius,
      backgroundColor: bgColor,
      child: _buildPhotoContent(icon),
    );
  }

  Widget _buildPhotoContent(IconData icon) {
    // No photo - show default icon
    if (photoPath == null || photoPath!.isEmpty) {
      return Icon(
        icon,
        size: radius * 1.2,
        color: AppTheme.primaryBrown,
      );
    }

    // Check if it's a file path
    final file = File(photoPath!);
    
    return ClipOval(
      child: file.existsSync()
          ? Image.file(
              file,
              width: radius * 2,
              height: radius * 2,
              fit: BoxFit.cover,
              errorBuilder: (context, error, stackTrace) {
                // If file doesn't exist or error loading, show default icon
                return Icon(
                  icon,
                  size: radius * 1.2,
                  color: AppTheme.primaryBrown,
                );
              },
            )
          : Icon(
              icon,
              size: radius * 1.2,
              color: AppTheme.primaryBrown,
            ),
    );
  }
}

/// Employee Photo Picker Widget
/// 
/// Interactive widget that allows picking/changing employee photo.
/// Shows current photo with edit overlay on tap.

class EmployeePhotoPicker extends StatelessWidget {
  final String? photoPath;
  final double radius;
  final VoidCallback onTap;
  final bool showEditIcon;

  const EmployeePhotoPicker({
    super.key,
    this.photoPath,
    this.radius = 50,
    required this.onTap,
    this.showEditIcon = true,
  });

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap,
      child: Stack(
        children: [
          // Photo or default avatar
          EmployeePhotoWidget(
            photoPath: photoPath,
            radius: radius,
          ),

          // Edit icon overlay
          if (showEditIcon)
            Positioned(
              right: 0,
              bottom: 0,
              child: Container(
                padding: const EdgeInsets.all(6),
                decoration: BoxDecoration(
                  color: AppTheme.primaryBrown,
                  shape: BoxShape.circle,
                  border: Border.all(
                    color: Colors.white,
                    width: 2,
                  ),
                ),
                child: Icon(
                  photoPath == null || photoPath!.isEmpty
                      ? Icons.add_a_photo
                      : Icons.edit,
                  size: radius * 0.4,
                  color: Colors.white,
                ),
              ),
            ),
        ],
      ),
    );
  }
}

END OF CODE.

34. receive_stock_dialog.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/stock_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';

/// Receive Stock Dialog - FIXED VERSION
/// 
/// Dialog to record stock received from supplier.
/// Updates stock quantity and creates a movement record.
/// 
/// FIX: Properly handles int to double conversion

class ReceiveStockDialog extends StatefulWidget {
  final StockItem stockItem;

  const ReceiveStockDialog({
    super.key,
    required this.stockItem,
  });

  @override
  State<ReceiveStockDialog> createState() => _ReceiveStockDialogState();
}

class _ReceiveStockDialogState extends State<ReceiveStockDialog> {
  final _formKey = GlobalKey<FormState>();
  final DatabaseHelper _dbHelper = DatabaseHelper();
  
  late TextEditingController _quantityController;
  late TextEditingController _notesController;
  
  bool _isSaving = false;

  @override
  void initState() {
    super.initState();
    _quantityController = TextEditingController();
    _notesController = TextEditingController();
  }

  @override
  void dispose() {
    _quantityController.dispose();
    _notesController.dispose();
    super.dispose();
  }

  /// Save received stock - FIXED VERSION
  Future<void> _saveReceivedStock() async {
    if (!_formKey.currentState!.validate()) return;

    setState(() {
      _isSaving = true;
    });

    try {
      // FIX: Parse as double to avoid type casting errors
      final quantityText = _quantityController.text.trim();
      final quantity = double.parse(quantityText);

      final movement = StockMovement(
        stockItemId: widget.stockItem.id!,
        stockItemName: widget.stockItem.name,
        movementType: 'RECEIVED',
        quantity: quantity, // Now properly typed as double
        notes: _notesController.text.trim().isEmpty 
            ? null 
            : _notesController.text.trim(),
      );

      await _dbHelper.insertStockMovement(movement);

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isSaving = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error receiving stock: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('Receive Stock'),
      content: SingleChildScrollView(
        child: Form(
          key: _formKey,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // Stock Item Info
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.primaryBrown.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  children: [
                    const Icon(
                      Icons.inventory_2,
                      color: AppTheme.primaryBrown,
                    ),
                    const SizedBox(width: 12),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Text(
                            widget.stockItem.name,
                            style: Theme.of(context).textTheme.titleMedium?.copyWith(
                                  fontWeight: FontWeight.bold,
                                ),
                          ),
                          Text(
                            'Current: ${widget.stockItem.quantityOnHand.toStringAsFixed(0)} ${widget.stockItem.unit}',
                            style: Theme.of(context).textTheme.bodySmall,
                          ),
                        ],
                      ),
                    ),
                  ],
                ),
              ),
              const SizedBox(height: 20),

              // Quantity Received Field
              TextFormField(
                controller: _quantityController,
                decoration: InputDecoration(
                  labelText: 'Quantity Received',
                  hintText: 'Enter quantity',
                  prefixIcon: const Icon(Icons.add_circle_outline),
                  suffixText: widget.stockItem.unit,
                ),
                keyboardType: const TextInputType.numberWithOptions(decimal: true),
                autofocus: true,
                validator: (value) {
                  if (value == null || value.trim().isEmpty) {
                    return 'Please enter quantity';
                  }
                  // FIX: Try parsing as double
                  final quantity = double.tryParse(value.trim());
                  if (quantity == null || quantity <= 0) {
                    return 'Please enter valid quantity';
                  }
                  return null;
                },
              ),
              const SizedBox(height: 16),

              // Notes Field (Optional)
              TextFormField(
                controller: _notesController,
                decoration: const InputDecoration(
                  labelText: 'Notes (Optional)',
                  hintText: 'e.g., Supplier name, invoice number',
                  prefixIcon: Icon(Icons.note),
                ),
                maxLines: 2,
                textCapitalization: TextCapitalization.sentences,
              ),
              const SizedBox(height: 16),

              // New Quantity Preview
              if (_quantityController.text.isNotEmpty && 
                  double.tryParse(_quantityController.text) != null)
                Container(
                  padding: const EdgeInsets.all(12),
                  decoration: BoxDecoration(
                    color: AppTheme.successGreen.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(8),
                    border: Border.all(
                      color: AppTheme.successGreen.withOpacity(0.3),
                    ),
                  ),
                  child: Row(
                    children: [
                      const Icon(
                        Icons.trending_up,
                        color: AppTheme.successGreen,
                        size: 20,
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: Text(
                          'New quantity: ${(widget.stockItem.quantityOnHand + double.parse(_quantityController.text)).toStringAsFixed(0)} ${widget.stockItem.unit}',
                          style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                                color: AppTheme.successGreen,
                                fontWeight: FontWeight.w600,
                              ),
                        ),
                      ),
                    ],
                  ),
                ),
            ],
          ),
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isSaving ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Save Button
        ElevatedButton.icon(
          onPressed: _isSaving ? null : _saveReceivedStock,
          icon: _isSaving
              ? const SizedBox(
                  width: 20,
                  height: 20,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : const Icon(Icons.check),
          label: const Text('Receive'),
        ),
      ],
    );
  }
}

END OF CODE.

35. summary_card.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';

/// Summary Card Widget
/// 
/// A reusable card component used on the dashboard to display
/// summary information like stock count, order count, income, etc.
/// 
/// Features:
/// - Icon with custom color
/// - Title and value display
/// - Subtitle for additional context
/// - Tap functionality to navigate to detailed screens

class SummaryCard extends StatelessWidget {
  final String title;
  final String value;
  final String subtitle;
  final IconData icon;
  final Color color;
  final VoidCallback? onTap;

  const SummaryCard({
    super.key,
    required this.title,
    required this.value,
    required this.subtitle,
    required this.icon,
    required this.color,
    this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 3,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(16),
      ),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(16),
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Row(
            children: [
              // Icon Container with colored background
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: color.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                ),
                child: Icon(
                  icon,
                  size: 32,
                  color: color,
                ),
              ),
              const SizedBox(width: 16),
              
              // Text Information
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    // Title
                    Text(
                      title,
                      style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.7),
                        fontWeight: FontWeight.w500,
                      ),
                    ),
                    const SizedBox(height: 4),
                    
                    // Value
                    Text(
                      value,
                      style: Theme.of(context).textTheme.headlineMedium?.copyWith(
                        fontWeight: FontWeight.bold,
                        color: color,
                      ),
                    ),
                    const SizedBox(height: 4),
                    
                    // Subtitle
                    Text(
                      subtitle,
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                        color: AppTheme.darkBrown.withOpacity(0.5),
                      ),
                    ),
                  ],
                ),
              ),
              
              // Arrow Icon indicating it's tappable
              if (onTap != null)
                Icon(
                  Icons.arrow_forward_ios,
                  size: 16,
                  color: AppTheme.darkBrown.withOpacity(0.3),
                ),
            ],
          ),
        ),
      ),
    );
  }
}

END OF CODE.

36. upload_document_dialog.dart:
import 'package:flutter/material.dart';
import 'package:file_picker/file_picker.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/models/employee_model.dart';
import 'package:a_one_bakeries_app/database/database_helper.dart';
import 'dart:io';

/// Upload Document Dialog
/// 
/// Allows uploading PDF documents for employees.
/// Categories: Contract, Payslip, Disciplinary

class UploadDocumentDialog extends StatefulWidget {
  final int employeeId;

  const UploadDocumentDialog({
    super.key,
    required this.employeeId,
  });

  @override
  State<UploadDocumentDialog> createState() => _UploadDocumentDialogState();
}

class _UploadDocumentDialogState extends State<UploadDocumentDialog> {
  final DatabaseHelper _dbHelper = DatabaseHelper();
  
  String _selectedDocType = 'CONTRACT';
  String? _selectedFileName;
  String? _selectedFilePath;
  bool _isUploading = false;

  final List<String> _documentTypes = [
    'CONTRACT',
    'PAYSLIP',
    'DISCIPLINARY',
    'ID',
    'OTHER',
  ];

  /// Pick a PDF file
  Future<void> _pickFile() async {
    try {
      FilePickerResult? result = await FilePicker.platform.pickFiles(
        type: FileType.custom,
        allowedExtensions: ['pdf'],
        allowMultiple: false,
      );

      if (result != null && result.files.single.path != null) {
        setState(() {
          _selectedFileName = result.files.single.name;
          _selectedFilePath = result.files.single.path;
        });
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error picking file: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  /// Upload document to database
  Future<void> _uploadDocument() async {
    if (_selectedFilePath == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text('Please select a file first'),
          backgroundColor: AppTheme.errorRed,
        ),
      );
      return;
    }

    setState(() {
      _isUploading = true;
    });

    try {
      // Create document record
      final document = EmployeeDocument(
        employeeId: widget.employeeId,
        documentType: _selectedDocType,
        fileName: _selectedFileName!,
        filePath: _selectedFilePath!,
      );

      // Save to database
      await _dbHelper.insertEmployeeDocument(document);

      if (mounted) {
        Navigator.pop(context, true);
      }
    } catch (e) {
      setState(() {
        _isUploading = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error uploading document: $e'),
            backgroundColor: AppTheme.errorRed,
          ),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('Upload Document'),
      content: SingleChildScrollView(
        child: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // Document Type Dropdown
            Text(
              'Document Type',
              style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                    fontWeight: FontWeight.w600,
                  ),
            ),
            const SizedBox(height: 8),
            DropdownButtonFormField<String>(
              value: _selectedDocType,
              decoration: const InputDecoration(
                prefixIcon: Icon(Icons.description),
                isDense: true,
              ),
              items: _documentTypes
                  .map((type) => DropdownMenuItem(
                        value: type,
                        child: Text(_formatDocumentType(type)),
                      ))
                  .toList(),
              onChanged: (value) {
                setState(() {
                  _selectedDocType = value!;
                });
              },
            ),
            const SizedBox(height: 24),

            // File Selection
            Text(
              'Select File',
              style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                    fontWeight: FontWeight.w600,
                  ),
            ),
            const SizedBox(height: 8),
            OutlinedButton.icon(
              onPressed: _isUploading ? null : _pickFile,
              icon: const Icon(Icons.attach_file),
              label: const Text('Choose PDF File'),
              style: OutlinedButton.styleFrom(
                minimumSize: const Size(double.infinity, 48),
              ),
            ),
            
            // Selected File Display
            if (_selectedFileName != null) ...[
              const SizedBox(height: 12),
              Container(
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(
                  color: AppTheme.successGreen.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                  border: Border.all(
                    color: AppTheme.successGreen.withOpacity(0.3),
                  ),
                ),
                child: Row(
                  children: [
                    const Icon(
                      Icons.check_circle,
                      color: AppTheme.successGreen,
                      size: 20,
                    ),
                    const SizedBox(width: 8),
                    Expanded(
                      child: Text(
                        _selectedFileName!,
                        style: Theme.of(context).textTheme.bodySmall,
                        maxLines: 2,
                        overflow: TextOverflow.ellipsis,
                      ),
                    ),
                  ],
                ),
              ),
            ],

            const SizedBox(height: 16),

            // Info message
            Container(
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: AppTheme.primaryBrown.withOpacity(0.1),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  Icon(
                    Icons.info_outline,
                    size: 20,
                    color: AppTheme.primaryBrown,
                  ),
                  const SizedBox(width: 8),
                  Expanded(
                    child: Text(
                      'Only PDF files are supported',
                      style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            color: AppTheme.darkBrown.withOpacity(0.7),
                          ),
                    ),
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
      actions: [
        // Cancel Button
        TextButton(
          onPressed: _isUploading ? null : () => Navigator.pop(context),
          child: const Text('Cancel'),
        ),

        // Upload Button
        ElevatedButton.icon(
          onPressed: _isUploading ? null : _uploadDocument,
          icon: _isUploading
              ? const SizedBox(
                  width: 16,
                  height: 16,
                  child: CircularProgressIndicator(
                    strokeWidth: 2,
                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                  ),
                )
              : const Icon(Icons.upload_file),
          label: Text(_isUploading ? 'Uploading...' : 'Upload'),
        ),
      ],
    );
  }

  /// Format document type for display
  String _formatDocumentType(String type) {
    switch (type) {
      case 'CONTRACT':
        return 'Contract';
      case 'PAYSLIP':
        return 'Payslip';
      case 'DISCIPLINARY':
        return 'Disciplinary Record';
      case 'ID':
        return 'ID Document';
      case 'OTHER':
        return 'Other';    
      default:
        return type;
    }
  }
}

END OF CODE.

37. main.dart:
import 'package:flutter/material.dart';
import 'package:a_one_bakeries_app/theme/app_theme.dart';
import 'package:a_one_bakeries_app/screens/main_navigation.dart';

/// Main Entry Point of A-One Bakeries App
/// 
/// This is where the app starts. We initialize the app with our custom theme
/// and set up the main navigation controller which manages the bottom nav bar.

void main() async {
  // Ensure Flutter bindings are initialized
  WidgetsFlutterBinding.ensureInitialized();
  
  runApp(const AOneBakeriesApp());
}

class AOneBakeriesApp extends StatelessWidget {
  const AOneBakeriesApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      // App Configuration
      title: 'A-One Bakeries',
      debugShowCheckedModeBanner: false, // Remove debug banner
      
      // Apply our custom theme
      theme: AppTheme.lightTheme,
      
      // Home screen - Main Navigation with Dashboard
      home: const MainNavigation(),
    );
  }
}

END OF CODE.

38. widget_test.dart:
// This is a basic Flutter widget test.
//
// To perform an interaction with a widget in your test, use the WidgetTester
// utility in the flutter_test package. For example, you can send tap and scroll
// gestures. You can also use WidgetTester to find child widgets in the widget
// tree, read text, and verify that the values of widget properties are correct.

import 'package:flutter_test/flutter_test.dart';
import 'package:a_one_bakeries_app/main.dart';

void main() {
  testWidgets('App smoke test - verify title', (WidgetTester tester) async {
    // Build our app and trigger a frame.
    await tester.pumpWidget(const AOneBakeriesApp());

    // Verify that our app title is present
    expect(find.text('A-One Bakeries'), findsOneWidget);
  });
}

END OF CODE.

39. pubspec.yaml:
name: a_one_bakeries_app
description: Business management app for A-One Bakeries - Stock, Orders, Employees & Financial tracking
publish_to: 'none'
version: 1.0.0+1

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  flutter:
    sdk: flutter

  # UI & Icons
  cupertino_icons: ^1.0.2
  google_fonts: ^6.1.0
  
  # Database
  sqflite: ^2.3.0
  sqflite_common_ffi: ^2.3.0 # For desktop support
  path_provider: ^2.1.1
  path: ^1.8.3
  
  # Date & Time
  intl: ^0.20.2
  
  # File Picker for documents
  file_picker: ^10.3.3
  
  # Image Picker for employee photos
  image_picker: ^1.0.4
  
  # PDF Viewer
  flutter_pdfview: ^1.3.2

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_launcher_icons: ^0.14.4
  flutter_lints: ^6.0.0

# App Icon Configuration (we'll customize this later)
flutter_icons:
  android: true
  ios: true
  image_path: "assets/icon/app_icon.png"

flutter:
  uses-material-design: true

  # Assets
  assets:
    - assets/images/
    - assets/icon/

  # We'll use Google Fonts, so no need to manually add fonts here

END OF CODE.